# Melodic CLI

A lightweight scaffolding and code generation tool for Melodic apps and monorepos.

## Install

```sh
npm install -g @melodicdev/cli
melodic --help
```

Local dev build:

```sh
npm --workspace @melodicdev/cli run build
node packages/cli/dist/index.js --help
```

## Quick Start

```sh
melodic init my-app
cd my-app
npm install
npm run dev
```

## Commands

### `melodic init <directory> [--monorepo] [--app-name <name>]`

Create a new Melodic project.

- Single app:
  ```sh
  melodic init my-app
  ```

- Monorepo with `apps/` and `libs/`:
  ```sh
  melodic init my-repo --monorepo --app-name web
  ```
  Uses `tsconfig.build.json` for `tsc -b` builds and keeps references updated when you run `melodic add app/lib`.

  Apps generated by the CLI set `build.target` to `es2022` in Vite so top-level await works in production builds.

`melodic create` is an alias of `melodic init`.

### `melodic add app <name> [--dir apps]`

Add a new app folder (useful inside a monorepo).

```sh
melodic add app admin
melodic add app marketing --dir apps
```

### `melodic add lib <name> [--dir packages]`

Add a new shared library folder.

```sh
melodic add lib shared
melodic add lib ui --dir packages
```

### `melodic add testing [--path .]`

Add a basic Vitest + happy-dom test setup to an existing project.

```sh
melodic add testing --path apps/web
```

### `melodic generate component <name> [--path src/components]`

Create a component with `.component.ts`, `.template.ts`, and `.styles.ts`.

```sh
melodic generate component user-card
melodic generate component user-card --path apps/web/src/components
```

### `melodic generate directive <name> [--path src/directives]`

Create a template directive.

```sh
melodic generate directive auto-focus
```

### `melodic generate attribute-directive <name> [--path src/directives]`

Create and register an attribute directive.

```sh
melodic generate attribute-directive tooltip
```

### `melodic generate service <name> [--path src/services]`

Create an injectable service.

```sh
melodic generate service auth
```

### `melodic generate interceptor <name> [--path src/http/interceptors]`

Create HTTP request/response interceptors.

```sh
melodic generate interceptor auth
```

### `melodic generate class <name> [--path src]`

Create a plain TypeScript class.

```sh
melodic generate class user
melodic generate class user --path src/models
```

## Templates

The CLI uses built-in templates and replaces placeholders automatically:

- `app-basic`: single app scaffold
- `monorepo-basic`: repo with `apps/` + `packages/` and a default app
- `lib-basic`: minimal shared library scaffold

Template notes:
- App templates include `vite-plugin-melodic-styles.ts`, `melodic-styles.config.ts` (shared attribute name), a `public/styles/global.css` sample, and a `<link melodic-styles>` entry in `index.html`.

Placeholders:

- `__APP_NAME__`
- `__REPO_NAME__`
- `__LIB_NAME__`

## Behavior Notes

- The CLI writes files only if the target directory is empty.
- Existing files are never overwritten.
- Use `--path` and `--dir` to target specific subfolders.
