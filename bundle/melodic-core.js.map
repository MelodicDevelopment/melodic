{"version":3,"file":"melodic-core.js","names":["token: Token<T>","cls: INewable<T>","options: IClassBindingOptions | undefined","instance: T","dependencies: unknown[]","errorHandlers: { type: string; handler: EventListener }[]","rootElement: HTMLElement | undefined","app: IMelodicApp","globalStylesAttribute: string","globalStyleSelector: string","cachedCssSheets: CSSStyleSheet[]","loadingPromise: Promise<void> | null","styleNode: HTMLStyleElement","properties: string[]","proto: object | null","current: object | null","attributes: Record<string, string>","dependencies: unknown[]","componentWithSelector: INewable<C> & { selector?: string }","config: IRequestConfig","code?: string","response: IHttpResponse","str: string","requestConfig: IRequestConfig","cancelledResponse: IHttpResponse<T>","httpResponse: IHttpResponse<T>","baseUrl: string","chunks: Uint8Array[]","i: number","param: Rule","value: string","params: RouteMatchParams","matches: RegExpMatchArray | null","re: RegExp","result: string","type: string","match: IRouteMatch","matches: IRouteMatch[]","params: Record<string, string>","pathParts: string[]","ancestorMatches: IRouteMatch[]","accumulatedParams: Record<string, string>","context: IRouteContext","merged: Record<string, unknown>","result: AsyncGuardResult","resolvedData: Record<string, unknown>","parts: ITemplatePart[]","activeAttributeName: string | null","activeAttributeQuote: string | null","attrKey: string","attrPrefix: string","partPaths: IPartPath[]","nodeParts: ITemplatePart[]","node: Node","strings: string[]","indices: number[]","match: RegExpExecArray | null","newKeys: unknown[]","renderedNodes: Node[]","keyedValues: Array<{ key: unknown; value: unknown }>","element: Element | null","options: INavigationOptions","isActive: boolean","options: IRouterLinkOptions","isActive: boolean","navOptions: INavigationOptions","activeEffect: SignalEffect | null","execute: () => void","state: State<S>","_initState: S","_reducerConfig: ReducerConfig<S, Action>","_debug: boolean","actionEffects: ActionEffect[]","action: TypedAction<T, P>","actionEffects: ActionEffect[]","keys: (keyof S)[]","effectService: ActionEffects","attrs: Array<{ name: string; valueIndex: number | null; staticValue?: string }>","textParts: Array<{ static: string } | { valueIndex: number }>","state: RepeatState","newEntries: {\n\t\titem: RepeatItem;\n\t\toldIndex: number;\n\t\tisNew: boolean;\n\t}[]","nextSibling: Node","nodes: Node[]","container: DocumentFragment","node: Node | null","nextNode: Node | null","oldIndexSequence: number[]","sequencePositions: number[]","state: RepeatRawState","state: WhenState","state: UnsafeHTMLState"],"sources":["../src/injection/function/get-token-key.function.ts","../src/injection/decorators/inject.decorator.ts","../src/injection/decorators/injectable.decorator.ts","../src/injection/classes/binding.class.ts","../src/injection/classes/injection-engine.class.ts","../src/injection/decorators/service.decorator.ts","../src/injection/function/create-token.function.ts","../src/bootstrap/functions/bootstrap.function.ts","../src/template/functions/render.function.ts","../src/signals/types/signal.type.ts","../src/signals/functions/is-signal.function.ts","../src/components/styles/apply-global-styles.function.ts","../src/components/classes/component-base.class.ts","../src/components/decorators/melodic-component.decorator.ts","../src/http/classes/http-error.class.ts","../src/http/classes/request-manager.class.ts","../src/http/classes/http-client.class.ts","../src/http/functions/provide-http.function.ts","../src/routing/functions/create-guard.function.ts","../src/routing/functions/create-deactivate-guard.function.ts","../src/routing/functions/create-resolver.function.ts","../src/routing/classes/route-matcher.class.ts","../src/routing/classes/route-context-event.class.ts","../src/routing/functions/match-route-level.function.ts","../src/routing/functions/match-route-tree.function.ts","../src/routing/functions/find-route-by-name.function.ts","../src/routing/functions/build-path-from-route.function.ts","../src/routing/services/route-context.service.ts","../src/routing/services/router.service.ts","../src/template/directives/functions/attribute-directive.functions.ts","../src/template/directives/functions/is-directive.function.ts","../src/template/classes/template-result.class.ts","../src/template/functions/html.function.ts","../src/routing/components/router-outlet/router-outlet.component.ts","../src/routing/components/router-link/router-link.component.ts","../src/routing/directives/router-link.directive.ts","../src/signals/functions/active-effect.functions.ts","../src/signals/classes/signal-effect.class.ts","../src/signals/functions/signal.function.ts","../src/signals/functions/computed.function.ts","../src/state/functions/create-action.function.ts","../src/state/functions/create-reducer.function.ts","../src/state/functions/create-state.function.ts","../src/state/functions/on-action.function.ts","../src/state/injection.tokens.ts","../src/state/services/effects.base.class.ts","../src/state/services/component-state-base.service.ts","../src/state/services/signal-store.service.ts","../src/state/functions/provide-rx.function.ts","../src/template/classes/compiled-template.class.ts","../src/template/directives/functions/directive.function.ts","../src/template/directives/builtin/repeat.directive.ts","../src/template/directives/builtin/repeat-raw.directive.ts","../src/template/directives/builtin/when.directive.ts","../src/template/directives/builtin/class-map.directive.ts","../src/template/directives/builtin/style-map.directive.ts","../src/template/directives/builtin/unsafe-html.directive.ts","../src/template/directives/builtin/portal.directive.ts","../src/template/directives/directive.class.ts"],"sourcesContent":["import type { Token } from '../types/token.type';\n\nexport const getTokenKey = <T>(token: Token<T>): string => {\n\tif (typeof token === 'string') {\n\t\treturn token;\n\t}\n\tif (typeof token === 'symbol') {\n\t\treturn token.toString();\n\t}\n\n\treturn (token as { name: string }).name;\n};\n","import { getTokenKey } from '../function/get-token-key.function';\nimport type { Token } from '../types/token.type';\n\nexport function Inject<T>(token: Token<T>): (target: any, _: string | undefined, index: number) => void {\n\treturn function (target: any, _: string | undefined, index: number): void {\n\t\tif (!target.params) {\n\t\t\ttarget.params = [];\n\t\t}\n\n\t\ttarget.params[index] = { __injectionToken: getTokenKey(token) };\n\t};\n}\n","import type { INewable } from '../../interfaces';\nimport { getTokenKey } from '../function/get-token-key.function';\nimport { Injector } from '../';\nimport type { IInjectableMeta } from '../interfaces/iinjectable-meta.interface';\n\nexport function Injectable<T>(meta: IInjectableMeta<T> = {}): (target: INewable<T>) => void {\n\treturn function (target: INewable<T>): void {\n\t\tconst token = meta.token ?? target;\n\t\tconst dependencies = meta.dependencies?.map((dep) => getTokenKey(dep));\n\n\t\tInjector.bind(token, target, {\n\t\t\tsingleton: meta.singleton,\n\t\t\tdependencies,\n\t\t\targs: meta.args\n\t\t});\n\t};\n}\n","import type { INewable } from '../../interfaces';\nimport type { BindingType } from '../types/binding-type.type';\nimport type { Token } from '../types/token.type';\nimport { getTokenKey } from '../function/get-token-key.function';\n\nexport class Binding<T> {\n\treadonly key: string;\n\treadonly token: Token<T>;\n\treadonly type: BindingType;\n\n\tprivate _class?: INewable<T>;\n\tprivate _factory?: () => T;\n\tprivate _instance?: T;\n\tprivate _singleton: boolean = true;\n\tprivate _dependencies: string[] = [];\n\tprivate _args: unknown[] = [];\n\tprivate _resolved: boolean = false;\n\n\tconstructor(key: string, token: Token<T>, type: BindingType) {\n\t\tthis.key = key;\n\t\tthis.token = token;\n\t\tthis.type = type;\n\t}\n\n\tget isSingleton(): boolean {\n\t\treturn this._singleton;\n\t}\n\n\tget isResolved(): boolean {\n\t\treturn this._resolved;\n\t}\n\n\tget dependencies(): string[] {\n\t\treturn this._dependencies;\n\t}\n\n\tget args(): unknown[] {\n\t\treturn this._args;\n\t}\n\n\tget targetClass(): INewable<T> | undefined {\n\t\treturn this._class;\n\t}\n\n\tget factory(): (() => T) | undefined {\n\t\treturn this._factory;\n\t}\n\n\tsetClass(cls: INewable<T>): this {\n\t\tthis._class = cls;\n\t\treturn this;\n\t}\n\n\tsetFactory(factory: () => T): this {\n\t\tthis._factory = factory;\n\t\treturn this;\n\t}\n\n\tsetSingleton(value: boolean): this {\n\t\tthis._singleton = value;\n\t\treturn this;\n\t}\n\n\twithDependencies(deps: Token<unknown>[]): this {\n\t\tthis._dependencies = deps.map((dep) => getTokenKey(dep));\n\t\treturn this;\n\t}\n\n\twithArgs(args: unknown[]): this {\n\t\tthis._args = args;\n\t\treturn this;\n\t}\n\n\tgetInstance(): T | undefined {\n\t\treturn this._instance;\n\t}\n\n\tsetInstance(instance: T): this {\n\t\tthis._instance = instance;\n\t\tthis._resolved = true;\n\t\treturn this;\n\t}\n\n\tclearInstance(): this {\n\t\tthis._instance = undefined;\n\t\tthis._resolved = false;\n\t\treturn this;\n\t}\n}\n","import type { INewable } from '../../interfaces';\nimport type { Token } from '../types/token.type';\nimport { Binding } from './binding.class';\nimport { getTokenKey } from '../function/get-token-key.function';\nimport type { IClassBindingOptions } from '../interfaces/iclass-binding-options.interface';\nimport type { IFactoryBindingOptions } from '../interfaces/ifactory-binding-options.interface';\n\nexport class InjectionEngine {\n\tprivate _bindings: Map<string, Binding<unknown>> = new Map();\n\tprivate _constructionStack: Set<string> = new Set();\n\n\t/**\n\t * Bind a class to the injector\n\t * @overload bind(cls) - Use class as its own token\n\t * @overload bind(cls, options) - Use class as token with options\n\t * @overload bind(token, cls) - Use custom token with class\n\t * @overload bind(token, cls, options) - Use custom token with class and options\n\t */\n\tbind<T>(cls: INewable<T>, options?: IClassBindingOptions): Binding<T>;\n\tbind<T>(token: Token<T>, cls: INewable<T>, options?: IClassBindingOptions): Binding<T>;\n\tbind<T>(tokenOrClass: Token<T> | INewable<T>, clsOrOptions?: INewable<T> | IClassBindingOptions, maybeOptions?: IClassBindingOptions): Binding<T> {\n\t\tlet token: Token<T>;\n\t\tlet cls: INewable<T>;\n\t\tlet options: IClassBindingOptions | undefined;\n\n\t\tif (typeof clsOrOptions === 'function') {\n\t\t\t// bind(token, cls) or bind(token, cls, options)\n\t\t\ttoken = tokenOrClass as Token<T>;\n\t\t\tcls = clsOrOptions as INewable<T>;\n\t\t\toptions = maybeOptions;\n\t\t} else {\n\t\t\t// bind(cls) or bind(cls, options)\n\t\t\ttoken = tokenOrClass as INewable<T>;\n\t\t\tcls = tokenOrClass as INewable<T>;\n\t\t\toptions = clsOrOptions as IClassBindingOptions | undefined;\n\t\t}\n\n\t\tconst key = getTokenKey(token);\n\t\tconst binding = new Binding<T>(key, token, 'class');\n\t\tbinding.setClass(cls);\n\n\t\tif (options?.singleton !== undefined) {\n\t\t\tbinding.setSingleton(options.singleton);\n\t\t}\n\t\tif (options?.dependencies) {\n\t\t\tbinding.withDependencies(options.dependencies);\n\t\t}\n\t\tif (options?.args) {\n\t\t\tbinding.withArgs(options.args);\n\t\t}\n\n\t\tthis._bindings.set(key, binding as Binding<unknown>);\n\t\treturn binding;\n\t}\n\n\tbindValue<T>(token: Token<T>, value: T): Binding<T>;\n\tbindValue<T, V>(token: Token<T>, value: V): Binding<T>;\n\tbindValue<T>(token: Token<T>, value: unknown): Binding<T> {\n\t\tconst key = getTokenKey(token);\n\t\tconst binding = new Binding<T>(key, token, 'value');\n\n\t\tbinding.setInstance(value as T);\n\t\tbinding.setSingleton(true);\n\n\t\tthis._bindings.set(key, binding as Binding<unknown>);\n\n\t\treturn binding;\n\t}\n\n\tbindFactory<T>(token: Token<T>, factory: () => T, options?: IFactoryBindingOptions): Binding<T> {\n\t\tconst key = getTokenKey(token);\n\t\tconst binding = new Binding<T>(key, token, 'factory');\n\t\tbinding.setFactory(factory);\n\n\t\tif (options?.singleton !== undefined) {\n\t\t\tbinding.setSingleton(options.singleton);\n\t\t}\n\n\t\tthis._bindings.set(key, binding as Binding<unknown>);\n\n\t\treturn binding;\n\t}\n\n\tget<T>(token: Token<T>): T {\n\t\tconst key = getTokenKey(token);\n\t\tconst binding = this._bindings.get(key) as Binding<T> | undefined;\n\n\t\tif (!binding) {\n\t\t\tthrow new Error(`Dependency could not be found: ${key}`);\n\t\t}\n\n\t\treturn this.resolve(binding, key);\n\t}\n\n\thas<T>(token: Token<T>): boolean {\n\t\tconst key = getTokenKey(token);\n\t\treturn this._bindings.has(key);\n\t}\n\n\tgetBinding<T>(token: Token<T>): Binding<T> | undefined {\n\t\tconst key = getTokenKey(token);\n\t\treturn this._bindings.get(key) as Binding<T> | undefined;\n\t}\n\n\tunbind<T>(token: Token<T>): boolean {\n\t\tconst key = getTokenKey(token);\n\t\treturn this._bindings.delete(key);\n\t}\n\n\tclear(): void {\n\t\tthis._bindings.clear();\n\t}\n\n\tprivate resolve<T>(binding: Binding<T>, key: string): T {\n\t\tif (binding.type === 'value') {\n\t\t\treturn binding.getInstance()!;\n\t\t}\n\n\t\tconst existing = binding.getInstance();\n\t\tif (existing !== undefined && binding.isSingleton) {\n\t\t\treturn existing;\n\t\t}\n\n\t\t// Circular dependency detection\n\t\tif (this._constructionStack.has(key)) {\n\t\t\tconst chain = Array.from(this._constructionStack).join(' -> ') + ` -> ${key}`;\n\t\t\tthrow new Error(`Circular dependency detected: ${chain}`);\n\t\t}\n\n\t\tthis._constructionStack.add(key);\n\n\t\ttry {\n\t\t\tlet instance: T;\n\n\t\t\tif (binding.type === 'factory') {\n\t\t\t\tinstance = binding.factory!();\n\t\t\t} else {\n\t\t\t\tinstance = this.construct(binding, key);\n\t\t\t}\n\n\t\t\tif (binding.isSingleton) {\n\t\t\t\tbinding.setInstance(instance);\n\t\t\t}\n\n\t\t\treturn instance;\n\t\t} finally {\n\t\t\tthis._constructionStack.delete(key);\n\t\t}\n\t}\n\n\tprivate construct<T>(binding: Binding<T>, currentToken: string): T {\n\t\tconst cls = binding.targetClass!;\n\t\tlet dependencies: unknown[] = [];\n\n\t\t// Check for @Inject decorated parameters\n\t\tconst paramTokens = (cls as any).params;\n\n\t\tif (paramTokens && Array.isArray(paramTokens)) {\n\t\t\tfor (let i = 0; i < paramTokens.length; i++) {\n\t\t\t\tconst param = paramTokens[i];\n\t\t\t\tif (param && typeof param === 'object' && param.__injectionToken) {\n\t\t\t\t\tconst depKey = param.__injectionToken;\n\t\t\t\t\tconst depBinding = this._bindings.get(depKey);\n\n\t\t\t\t\tif (!depBinding) {\n\t\t\t\t\t\tthrow new Error(`Dependency '${depKey}' not found (required by '${currentToken}')`);\n\t\t\t\t\t}\n\n\t\t\t\t\tdependencies.push(this.resolve(depBinding as Binding<unknown>, depKey));\n\t\t\t\t} else {\n\t\t\t\t\tdependencies.push(undefined);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (binding.dependencies.length > 0) {\n\t\t\t// Legacy token-based dependency resolution\n\t\t\tfor (const depKey of binding.dependencies) {\n\t\t\t\tconst depBinding = this._bindings.get(depKey);\n\n\t\t\t\tif (!depBinding) {\n\t\t\t\t\tthrow new Error(`Dependency '${depKey}' not found (required by '${currentToken}')`);\n\t\t\t\t}\n\n\t\t\t\tdependencies.push(this.resolve(depBinding as Binding<unknown>, depKey));\n\t\t\t}\n\t\t}\n\n\t\tif (binding.args.length > 0) {\n\t\t\tdependencies = dependencies.concat(binding.args);\n\t\t}\n\n\t\treturn Reflect.construct(cls, dependencies);\n\t}\n}\n\nexport const Injector = new InjectionEngine();\n","import { Injector } from '../classes/injection-engine.class';\nimport type { Token } from '../types/token.type';\n\nexport function Service<T>(token: Token<T>) {\n\treturn function (target: any, propertyKey: string | symbol): void {\n\t\tconst metadataKey = `__service_${String(propertyKey)}`;\n\t\ttarget[metadataKey] = token;\n\n\t\tObject.defineProperty(target, propertyKey, {\n\t\t\tget(): T {\n\t\t\t\tconst cacheKey = `__cached_${String(propertyKey)}`;\n\n\t\t\t\tif (!(this as any)[cacheKey]) {\n\t\t\t\t\t(this as any)[cacheKey] = Injector.get<T>(token);\n\t\t\t\t}\n\n\t\t\t\treturn (this as any)[cacheKey];\n\t\t\t},\n\t\t\tenumerable: true,\n\t\t\tconfigurable: true\n\t\t});\n\t};\n}\n","import type { IInjectionToken } from '../interfaces/iinjection-token.interface';\n\nexport function createToken<T>(description: string): IInjectionToken<T> {\n\t// Symbol already has a built-in description property\n\treturn Symbol(description) as unknown as IInjectionToken<T>;\n}\n","import { Injector } from '../../injection';\nimport type { IAppConfig } from '../interfaces/iapp-config.interface';\nimport type { IMelodicApp } from '../interfaces/imelodic-app.interface';\nimport type { Token } from '../../injection';\n\nexport async function bootstrap(config: IAppConfig = {}): Promise<IMelodicApp> {\n\tconst devMode = config.devMode ?? false;\n\tconst errorHandlers: { type: string; handler: EventListener }[] = [];\n\n\tif (devMode) {\n\t\tconsole.log('[Melodic] Bootstrap starting...');\n\t}\n\n\tif (config.onError) {\n\t\tconst errorHandler = (event: ErrorEvent) => {\n\t\t\tconfig.onError!(event.error, 'error');\n\t\t};\n\t\tconst rejectionHandler = (event: PromiseRejectionEvent) => {\n\t\t\tconfig.onError!(event.reason, 'unhandledrejection');\n\t\t};\n\n\t\twindow.addEventListener('error', errorHandler as EventListener);\n\t\twindow.addEventListener('unhandledrejection', rejectionHandler as EventListener);\n\n\t\terrorHandlers.push(\n\t\t\t{ type: 'error', handler: errorHandler as EventListener },\n\t\t\t{ type: 'unhandledrejection', handler: rejectionHandler as EventListener }\n\t\t);\n\t}\n\n\tif (config.onBefore) {\n\t\tif (devMode) {\n\t\t\tconsole.log('[Melodic] Running onBefore hook...');\n\t\t}\n\n\t\tawait config.onBefore();\n\t}\n\n\tif (config.providers) {\n\t\tfor (const provider of config.providers) {\n\t\t\tprovider(Injector);\n\t\t}\n\n\t\tif (devMode) {\n\t\t\tconsole.log('[Melodic] Custom providers registered');\n\t\t}\n\t}\n\n\tlet rootElement: HTMLElement | undefined;\n\tif (config.rootComponent && config.target) {\n\t\tconst targetEl = typeof config.target === 'string' ? document.querySelector<HTMLElement>(config.target) : config.target;\n\n\t\tif (!targetEl) {\n\t\t\tthrow new Error(`[Melodic] Target element not found: ${config.target}`);\n\t\t}\n\n\t\t// Check if component is registered\n\t\tif (!customElements.get(config.rootComponent)) {\n\t\t\tthrow new Error(\n\t\t\t\t`[Melodic] Component <${config.rootComponent}> is not registered. ` + `Make sure to import the component file before calling bootstrap().`\n\t\t\t);\n\t\t}\n\n\t\trootElement = document.createElement(config.rootComponent);\n\t\ttargetEl.appendChild(rootElement);\n\n\t\tif (devMode) {\n\t\t\tconsole.log('[Melodic] Mounted root component', {\n\t\t\t\tcomponent: config.rootComponent,\n\t\t\t\ttarget: config.target\n\t\t\t});\n\t\t}\n\t}\n\n\tconst app: IMelodicApp = {\n\t\tisDevMode: devMode,\n\t\trootElement,\n\n\t\tget<T>(token: Token<T>): T {\n\t\t\treturn Injector.get(token);\n\t\t},\n\n\t\tdestroy() {\n\t\t\tfor (const { type, handler } of errorHandlers) {\n\t\t\t\twindow.removeEventListener(type, handler);\n\t\t\t}\n\n\t\t\tif (rootElement?.parentNode) {\n\t\t\t\trootElement.parentNode.removeChild(rootElement);\n\t\t\t}\n\n\t\t\tif (devMode) {\n\t\t\t\tconsole.log('[Melodic] Application destroyed');\n\t\t\t}\n\t\t}\n\t};\n\n\tif (config.onReady) {\n\t\tconfig.onReady();\n\t}\n\n\tif (devMode) {\n\t\tconsole.log('[Melodic] Bootstrap complete');\n\t}\n\n\tInjector.bindValue('IMelodicApp', app);\n\n\treturn app;\n}\n","import type { TemplateResult } from '../classes/template-result.class';\n\nexport function render(result: TemplateResult, container: Element | DocumentFragment): void {\n\tresult.renderInto(container);\n}\n","import type { Subscriber } from './subscriber.type';\nimport type { Unsubscriber } from './unsubscriber.type';\n\nexport type Signal<T> = {\n\t(): T;\n\tset(value: T): void;\n\tupdate(updater: (current: T) => T): void;\n\tsubscribe(subscriber: Subscriber<T>): Unsubscriber;\n\tunsubscribe(subscriber: Subscriber<T>): void;\n\tdestroy(): void;\n};\n\nexport const SIGNAL_MARKER = Symbol('melodic.signal');\n","import { type Signal, SIGNAL_MARKER } from '../types/signal.type';\n\nexport const isSignal = <T = unknown>(value: unknown): value is Signal<T> => {\n\treturn typeof value === 'function' && SIGNAL_MARKER in value;\n};\n","const globalStylesAttribute: string = 'melodic-styles';\nconst globalStyleSelector: string = `style[${globalStylesAttribute}], link[rel=\"stylesheet\"][${globalStylesAttribute}]`;\n\nconst cachedCssSheets: CSSStyleSheet[] = [];\nlet loadingPromise: Promise<void> | null = null;\n\nexport const applyGlobalStyles = (root: ShadowRoot): void => {\n\tif (hasCachedSheets()) {\n\t\tapplyAdoptedSheets(root);\n\t\treturn;\n\t}\n\n\tif (!loadingPromise) {\n\t\tloadingPromise = loadStyles();\n\t}\n\n\tloadingPromise.then(() => applyAdoptedSheets(root));\n};\n\nconst loadStyles = async (): Promise<void> => {\n\tconst globalStyleElements = document.querySelectorAll(globalStyleSelector);\n\n\tif (globalStyleElements.length === 0) {\n\t\treturn;\n\t}\n\n\tfor (const element of globalStyleElements) {\n\t\tif (element instanceof HTMLStyleElement) {\n\t\t\tcacheCssSheet(element.textContent ?? '');\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (element instanceof HTMLLinkElement) {\n\t\t\tif (!element.sheet) {\n\t\t\t\tawait new Promise<void>((resolve) => {\n\t\t\t\t\telement.addEventListener('load', () => resolve(), { once: true });\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcacheCssSheet(\n\t\t\t\tArray.from(element.sheet?.cssRules ?? [])\n\t\t\t\t\t.map((rule) => rule.cssText)\n\t\t\t\t\t.join('\\n')\n\t\t\t);\n\t\t}\n\t}\n};\n\nconst applyAdoptedSheets = (root: ShadowRoot): void => {\n\tconst adopted = root.adoptedStyleSheets ?? [];\n\tconst newSheets = cachedCssSheets.filter((sheet) => !adopted.includes(sheet));\n\n\tif (newSheets.length > 0) {\n\t\troot.adoptedStyleSheets = [...adopted, ...newSheets];\n\t}\n};\n\nconst cacheCssSheet = (text: string): void => {\n\tconst trimmedText = text.trim();\n\tif (trimmedText.length > 0) {\n\t\tconst sheet = new CSSStyleSheet();\n\t\tsheet.replaceSync(trimmedText);\n\t\tcachedCssSheets.push(sheet);\n\t}\n};\n\nconst hasCachedSheets = (): boolean => {\n\treturn cachedCssSheets.length > 0;\n};\n","import type { ComponentMeta } from '../types/component-meta.type';\nimport type { Component } from '../types/component.type';\nimport { render } from '../../template/functions/render.function';\nimport type { Unsubscriber } from '../../signals/types/unsubscriber.type';\nimport type { Signal } from '../../signals/types/signal.type';\nimport { isSignal } from '../../signals/functions/is-signal.function';\nimport type { ITemplatePart } from '../../template/interfaces/itemplate-part.interface';\nimport { applyGlobalStyles } from '../styles/apply-global-styles.function';\n\nexport abstract class ComponentBase extends HTMLElement {\n\tprivate readonly _meta: ComponentMeta;\n\tprivate readonly _component: Component;\n\tprivate readonly _root: ShadowRoot;\n\tprivate readonly _style: HTMLStyleElement;\n\tprivate _unsubscribers: Array<Unsubscriber> = [];\n\tprivate _renderScheduled = false;\n\tprivate readonly _booleanProperties: Set<string> = new Set();\n\n\tconstructor(meta: ComponentMeta, component: Component) {\n\t\tsuper();\n\n\t\tthis._meta = meta;\n\t\tthis._component = component;\n\t\tthis._component.elementRef = this;\n\t\tthis._root = this.attachShadow({ mode: 'open' });\n\t\tapplyGlobalStyles(this._root);\n\t\tthis._style = this.renderStyles();\n\n\t\tthis.observe();\n\n\t\tif (this._component.onInit) {\n\t\t\tthis._component.onInit();\n\t\t}\n\t}\n\n\tget component(): Component {\n\t\treturn this._component;\n\t}\n\n\tasync connectedCallback(): Promise<void> {\n\t\tthis.render();\n\n\t\tif (this._component.onCreate !== undefined) {\n\t\t\tthis._component.onCreate();\n\t\t}\n\t}\n\n\tdisconnectedCallback(): void {\n\t\tthis._unsubscribers.forEach((unsubscribe) => unsubscribe());\n\t\tthis._unsubscribers = [];\n\n\t\tconst parts = (this._root as any).__parts as ITemplatePart[] | undefined;\n\t\tif (parts) {\n\t\t\tfor (const part of parts) {\n\t\t\t\tif (part.actionCleanup) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tpart.actionCleanup();\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error('Action directive cleanup failed:', error);\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tpart.actionCleanup = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this._component.onDestroy !== undefined) {\n\t\t\tthis._component.onDestroy();\n\t\t}\n\t}\n\n\tattributeChangedCallback(attribute: string, oldVal: unknown, newVal: unknown): void {\n\t\tconst prop = attribute.replace(/-([a-z])/g, (_, ch: string) => ch.toUpperCase());\n\n\t\tif ((this._component as any)[prop] !== undefined) {\n\t\t\tlet value = newVal;\n\n\t\t\t// Convert boolean attributes: present (any value including \"\") = true, null/absent = false\n\t\t\tif (this._booleanProperties.has(prop)) {\n\t\t\t\tvalue = newVal !== null && newVal !== 'false';\n\t\t\t}\n\n\t\t\t(this._component as any)[prop] = value;\n\t\t}\n\n\t\tthis.scheduleRender();\n\n\t\tif (this._component.onAttributeChange !== undefined) {\n\t\t\tthis._component.onAttributeChange(attribute, oldVal, newVal);\n\t\t}\n\t}\n\n\tprivate renderStyles(): HTMLStyleElement {\n\t\tconst styleNode: HTMLStyleElement = document.createElement('style');\n\n\t\tif (this._meta.styles) {\n\t\t\tconst stylesResult = this._meta.styles();\n\t\t\trender(stylesResult, styleNode);\n\t\t}\n\n\t\treturn this._root.appendChild(styleNode);\n\t}\n\n\tprivate render(): void {\n\t\tif (this._meta.template) {\n\t\t\tconst templateResult = this._meta.template(this._component, this.getAttributeValues());\n\t\t\trender(templateResult, this._root);\n\n\t\t\tif (this._style.parentNode !== this._root) {\n\t\t\t\tthis._root.appendChild(this._style);\n\t\t\t}\n\t\t}\n\n\t\tif (this._component.onRender !== undefined) {\n\t\t\tthis._component.onRender();\n\t\t}\n\t}\n\n\tprivate scheduleRender(): void {\n\t\tif (this._renderScheduled) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._renderScheduled = true;\n\t\tqueueMicrotask(() => {\n\t\t\tthis._renderScheduled = false;\n\t\t\tif (this.isConnected) {\n\t\t\t\tthis.render();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate observe(): void {\n\t\tconst properties: string[] = [];\n\t\tconst seen = new Set<string>();\n\t\tlet proto: object | null = this._component;\n\n\t\twhile (proto && proto !== Object.prototype) {\n\t\t\tfor (const prop of Object.getOwnPropertyNames(proto)) {\n\t\t\t\tif (!seen.has(prop)) {\n\t\t\t\t\tseen.add(prop);\n\t\t\t\t\tproperties.push(prop);\n\t\t\t\t}\n\t\t\t}\n\t\t\tproto = Object.getPrototypeOf(proto);\n\t\t}\n\n\t\tconst filtered = properties.filter((prop) => {\n\t\t\tconst value = (this._component as any)[prop];\n\n\t\t\t// Skip private properties (convention)\n\t\t\tif (prop.startsWith('_')) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (isSignal(value)) {\n\t\t\t\tthis.subscribeToSignal(value);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (typeof value === 'function') {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn prop !== 'elementRef' && prop !== 'constructor';\n\t\t});\n\n\t\tfor (const prop of filtered) {\n\t\t\tconst descriptor = this.getPropertyDescriptor(this._component, prop);\n\n\t\t\t// Check if wrapper already has a value set (from property binding before observe ran)\n\t\t\tconst wrapperValue = Object.getOwnPropertyDescriptor(this, prop)?.value;\n\t\t\tlet value = wrapperValue === undefined ? (this._component as any)[prop] : wrapperValue;\n\n\t\t\t// Track boolean properties for attribute conversion\n\t\t\tif (typeof value === 'boolean') {\n\t\t\t\tthis._booleanProperties.add(prop);\n\t\t\t}\n\n\t\t\t// Build getter/setter for the component's property\n\t\t\tlet componentGetter = () => value;\n\t\t\tlet componentSetter = (newVal: unknown) => {\n\t\t\t\tif (value !== newVal) {\n\t\t\t\t\tthis._component.onPropertyChange?.(prop, value, newVal);\n\t\t\t\t\tvalue = newVal;\n\t\t\t\t\tthis.scheduleRender();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Preserve existing getters\n\t\t\tif (descriptor?.get) {\n\t\t\t\tconst originalGetter = descriptor.get;\n\t\t\t\tcomponentGetter = () => originalGetter.call(this._component) ?? value;\n\t\t\t}\n\n\t\t\t// Preserve existing setters\n\t\t\tif (descriptor?.set) {\n\t\t\t\tconst originalSetter = descriptor.set;\n\t\t\t\tconst baseSetter = componentSetter;\n\t\t\t\tcomponentSetter = (newVal) => {\n\t\t\t\t\toriginalSetter.call(this._component, newVal);\n\t\t\t\t\tbaseSetter(newVal);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Make the component's property reactive\n\t\t\tObject.defineProperty(this._component, prop, {\n\t\t\t\tget: componentGetter,\n\t\t\t\tset: componentSetter,\n\t\t\t\tenumerable: true,\n\t\t\t\tconfigurable: true\n\t\t\t});\n\n\t\t\t// Expose on wrapper for property binding (.prop=${value})\n\t\t\tObject.defineProperty(this, prop, {\n\t\t\t\tget: componentGetter,\n\t\t\t\tset: componentSetter,\n\t\t\t\tenumerable: true,\n\t\t\t\tconfigurable: true\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate getPropertyDescriptor(target: object, prop: string): PropertyDescriptor | undefined {\n\t\tlet current: object | null = target;\n\n\t\twhile (current && current !== Object.prototype) {\n\t\t\tconst descriptor = Object.getOwnPropertyDescriptor(current, prop);\n\t\t\tif (descriptor) {\n\t\t\t\treturn descriptor;\n\t\t\t}\n\t\t\tcurrent = Object.getPrototypeOf(current);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate getAttributeValues(): Record<string, string> {\n\t\tconst attributes: Record<string, string> = {};\n\t\tthis.getAttributeNames().forEach((attrName: string) => {\n\t\t\tattributes[attrName] = this.getAttribute(attrName) ?? '';\n\t\t});\n\n\t\treturn attributes;\n\t}\n\n\tprivate subscribeToSignal<T>(signal: Signal<T>): void {\n\t\tconst unsubscriber = signal.subscribe(() => this.scheduleRender());\n\t\tthis._unsubscribers.push(unsubscriber);\n\t}\n}\n","import type { INewable } from '../../interfaces/inewable.interface';\nimport { ComponentBase } from '../classes/component-base.class';\nimport type { TypedComponentMeta } from '../types/component-meta.type';\nimport type { Component } from '../types/component.type';\nimport { Injector } from '../../injection/classes/injection-engine.class';\n\nexport function MelodicComponent<C extends Component>(meta: TypedComponentMeta<C>): (component: INewable<C>) => void {\n\treturn function (component: INewable<C>): void {\n\t\tif (customElements.get(meta.selector) === undefined) {\n\t\t\tconst webComponent = class extends ComponentBase {\n\t\t\t\tconstructor() {\n\t\t\t\t\tconst dependencies: unknown[] = [];\n\t\t\t\t\tconst paramTokens = (component as any).params;\n\n\t\t\t\t\tif (paramTokens && Array.isArray(paramTokens)) {\n\t\t\t\t\t\tfor (const i of paramTokens) {\n\t\t\t\t\t\t\tconst param = paramTokens[i];\n\t\t\t\t\t\t\tif (param && typeof param === 'object' && param.__injectionToken) {\n\t\t\t\t\t\t\t\tdependencies.push(Injector.get(param.__injectionToken));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdependencies.push(undefined);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tsuper(meta, Reflect.construct(component, dependencies));\n\t\t\t\t}\n\n\t\t\t\tstatic readonly observedAttributes: string[] = meta.attributes ?? [];\n\t\t\t};\n\n\t\t\tconst componentWithSelector: INewable<C> & { selector?: string } = component as INewable<C> & { selector?: string };\n\t\t\tcomponentWithSelector.selector = meta.selector;\n\n\t\t\tcustomElements.define(meta.selector, webComponent);\n\t\t}\n\t};\n}\n","import type { IHttpResponse } from '../interfaces/ihttp-response.interface';\nimport type { IRequestConfig } from '../interfaces/irequest-config.interface';\n\nexport abstract class HttpBaseError extends Error {\n\tconstructor(message: string, public readonly config: IRequestConfig, public readonly code?: string) {\n\t\tsuper(message);\n\t\tthis.name = 'HttpBaseError';\n\t\tObject.setPrototypeOf(this, HttpBaseError.prototype);\n\t}\n}\n\nexport class HttpError extends HttpBaseError {\n\tconstructor(message: string, public readonly response: IHttpResponse, config: IRequestConfig) {\n\t\tsuper(message, config, `HTTP_${response.status}`);\n\t\tthis.name = 'HttpError';\n\t\tObject.setPrototypeOf(this, HttpError.prototype);\n\t}\n}\n\nexport class NetworkError extends HttpBaseError {\n\tconstructor(message: string, config: IRequestConfig) {\n\t\tsuper(message, config, 'NETWORK_ERROR');\n\t\tthis.name = 'NetworkError';\n\t\tObject.setPrototypeOf(this, NetworkError.prototype);\n\t}\n}\n\nexport class AbortError extends HttpBaseError {\n\tconstructor(message: string, config: IRequestConfig) {\n\t\tsuper(message, config, 'ABORTED');\n\t\tthis.name = 'AbortError';\n\t\tObject.setPrototypeOf(this, AbortError.prototype);\n\t}\n}\n","import type { IRequestConfig } from '../interfaces';\nimport type { IHttpResponse } from '../interfaces/ihttp-response.interface';\nimport type { HttpRequestBody } from '../types/http-request-body.type';\n\ninterface IPendingRequest<T = any> {\n\tpromise: Promise<IHttpResponse<T>>;\n\tabortController: AbortController;\n}\n\nexport class RequestManager {\n\tprivate _pendingRequests = new Map<string, IPendingRequest>();\n\n\tgenerateRequestKey(method: string, url: string, body?: HttpRequestBody): string {\n\t\tlet key = `${method}:${url}`;\n\n\t\tif (body) {\n\t\t\tkey += `:${this.hashBody(body)}`;\n\t\t}\n\n\t\treturn key;\n\t}\n\n\thasPendingRequest(key: string): boolean {\n\t\treturn this._pendingRequests.has(key);\n\t}\n\n\tgetPendingRequest<T = any>(key: string): Promise<IHttpResponse<T>> | null {\n\t\tconst pending = this._pendingRequests.get(key);\n\n\t\tif (!pending) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn pending.promise;\n\t}\n\n\taddPendingRequest<T = any>(requestConfig: IRequestConfig, promise: Promise<IHttpResponse<T>>): void {\n\t\tconst key = this.generateRequestKey(requestConfig.method || 'GET', requestConfig.url || '', requestConfig.body as BodyInit | null);\n\n\t\tthis._pendingRequests.set(key, {\n\t\t\tpromise,\n\t\t\tabortController: requestConfig.abortController!\n\t\t});\n\n\t\tpromise.finally(() => {\n\t\t\tthis.removePendingRequest(key);\n\t\t});\n\t}\n\n\tcancelPendingRequest(key: string, reason?: string): void {\n\t\tconst pending = this._pendingRequests.get(key);\n\n\t\tif (pending) {\n\t\t\tpending.abortController.abort(reason);\n\t\t\tthis._pendingRequests.delete(key);\n\t\t}\n\t}\n\n\tcancelAllRequests(reason?: string): void {\n\t\tthis._pendingRequests.forEach((pending) => {\n\t\t\tpending.abortController.abort(reason);\n\t\t});\n\n\t\tthis._pendingRequests.clear();\n\t}\n\n\tprivate removePendingRequest(key: string): void {\n\t\tconst pending = this._pendingRequests.get(key);\n\n\t\tif (!pending) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._pendingRequests.delete(key);\n\t}\n\n\tprivate hashBody(body: HttpRequestBody): string {\n\t\tlet str: string;\n\n\t\tif (typeof body === 'string') {\n\t\t\tstr = body;\n\t\t} else if (body instanceof FormData) {\n\t\t\tstr = '[FormData]';\n\t\t} else if (body instanceof Blob) {\n\t\t\tstr = `[Blob:${body.size}]`;\n\t\t} else if (body instanceof ArrayBuffer) {\n\t\t\tstr = `[ArrayBuffer:${body.byteLength}]`;\n\t\t} else if (body instanceof URLSearchParams) {\n\t\t\tstr = body.toString();\n\t\t} else if (typeof body === 'object' && body !== null) {\n\t\t\tstr = JSON.stringify(body);\n\t\t} else {\n\t\t\tstr = String(body);\n\t\t}\n\n\t\treturn this.hashCode(str).toString();\n\t}\n\n\tprivate hashCode(str: string): number {\n\t\tlet hash = 0;\n\t\tfor (let i = 0; i < str.length; i++) {\n\t\t\tconst char = str.charCodeAt(i);\n\t\t\thash = (hash << 5) - hash + char;\n\t\t\thash = hash & hash;\n\t\t}\n\t\treturn hash;\n\t}\n}\n","import { AbortError, HttpError, NetworkError } from './http-error.class';\nimport type { IHttpClientConfig } from '../interfaces/ihttp-client-config.interface';\nimport type { IHttpRequestInterceptor } from '../interfaces/ihttp-request-interceptor.interface';\nimport type { IHttpResponseInterceptor } from '../interfaces/ihttp-response-interceptor.interface';\nimport type { IHttpResponse } from '../interfaces/ihttp-response.interface';\nimport type { IInterceptorApi } from '../interfaces/iinterceptor-api.interface';\nimport type { IProgressEvent } from '../interfaces/iprogress-event.interface';\nimport type { IRequestConfig } from '../interfaces/irequest-config.interface';\nimport type { HttpRequestBody } from '../types/http-request-body.type';\nimport { RequestManager } from './request-manager.class';\n\nexport class HttpClient {\n\tprivate _clientConfig: IHttpClientConfig;\n\tprivate _requestManager = new RequestManager();\n\tprivate _interceptors: {\n\t\trequest: IHttpRequestInterceptor[];\n\t\tresponse: IHttpResponseInterceptor[];\n\t} = {\n\t\trequest: [],\n\t\tresponse: []\n\t};\n\n\tpublic interceptors: IInterceptorApi = {\n\t\trequest: (interceptor: IHttpRequestInterceptor): void => {\n\t\t\tthis._interceptors.request.push(interceptor);\n\t\t},\n\t\tresponse: (interceptor: IHttpResponseInterceptor): void => {\n\t\t\tthis._interceptors.response.push(interceptor);\n\t\t}\n\t};\n\n\tconstructor(config?: IHttpClientConfig) {\n\t\tthis._clientConfig = {\n\t\t\tdefaultHeaders: {},\n\t\t\t...config\n\t\t};\n\t}\n\n\tpublic async get<T>(url: string, config?: IRequestConfig): Promise<IHttpResponse<T>> {\n\t\treturn this.internalRequest<T>({ method: 'GET', ...config, url, deduplicate: config?.deduplicate ?? true });\n\t}\n\n\tpublic async post<T>(url: string, body?: HttpRequestBody, config?: IRequestConfig): Promise<IHttpResponse<T>> {\n\t\treturn this.internalRequest<T>({ method: 'POST', ...config, url, body });\n\t}\n\n\tpublic async put<T>(url: string, body?: HttpRequestBody, config?: IRequestConfig): Promise<IHttpResponse<T>> {\n\t\treturn this.internalRequest<T>({ method: 'PUT', ...config, url, body });\n\t}\n\n\tpublic async patch<T>(url: string, body?: HttpRequestBody, config?: IRequestConfig): Promise<IHttpResponse<T>> {\n\t\treturn this.internalRequest<T>({ method: 'PATCH', ...config, url, body });\n\t}\n\n\tpublic async delete<T>(url: string, config?: IRequestConfig): Promise<IHttpResponse<T>> {\n\t\treturn this.internalRequest<T>({ method: 'DELETE', ...config, url });\n\t}\n\n\tprivate async internalRequest<T>(config: IRequestConfig): Promise<IHttpResponse<T>> {\n\t\tlet requestConfig: IRequestConfig = this.mergeConfig(config);\n\t\trequestConfig = await this.executeRequestInterceptors(requestConfig);\n\n\t\tif (requestConfig.cancel?.cancelled) {\n\t\t\tif (requestConfig.cancel.cancelReason) {\n\t\t\t\tconsole.log('[HttpClient] Request cancelled:', requestConfig.cancel.cancelReason);\n\t\t\t}\n\n\t\t\tlet cancelledResponse: IHttpResponse<T> = {\n\t\t\t\tdata: null as any,\n\t\t\t\tstatus: 0,\n\t\t\t\tstatusText: 'Request Cancelled',\n\t\t\t\theaders: new Headers(),\n\t\t\t\tconfig: requestConfig\n\t\t\t};\n\n\t\t\tif (requestConfig.cancel.cancelledResponse) {\n\t\t\t\tcancelledResponse = { ...cancelledResponse, ...(requestConfig.cancel.cancelledResponse as IHttpResponse<T>) };\n\t\t\t}\n\n\t\t\treturn Promise.resolve(cancelledResponse);\n\t\t}\n\n\t\tif (requestConfig.abortController === undefined) {\n\t\t\tconst abortController = new AbortController();\n\t\t\trequestConfig.abortController = abortController;\n\t\t}\n\n\t\tlet response = await this.executeRequest<T>(requestConfig);\n\t\tresponse = await this.executeResponseInterceptors(response);\n\n\t\treturn response;\n\t}\n\n\tprivate async executeRequest<T>(config: IRequestConfig): Promise<IHttpResponse<T>> {\n\t\tif (config.deduplicate === true) {\n\t\t\tconst requestKey = this._requestManager.generateRequestKey(config.method!, config.url!, config.body);\n\n\t\t\tif (this._requestManager.hasPendingRequest(requestKey)) {\n\t\t\t\treturn this._requestManager.getPendingRequest<T>(requestKey)!;\n\t\t\t}\n\t\t}\n\n\t\tconst fetchPromise = fetch(config.url!, {\n\t\t\tmethod: config.method,\n\t\t\theaders: config.headers,\n\t\t\tbody: this.prepareBody(config.body),\n\t\t\tcredentials: config.credentials,\n\t\t\tmode: config.mode,\n\t\t\tsignal: config.abortController?.signal\n\t\t})\n\t\t\t.then(async (response) => {\n\t\t\t\tconst data = await this.parseResponse<T>(response, config.onProgress);\n\n\t\t\t\tconst httpResponse: IHttpResponse<T> = {\n\t\t\t\t\tdata,\n\t\t\t\t\tstatus: response.status,\n\t\t\t\t\tstatusText: response.statusText,\n\t\t\t\t\theaders: response.headers,\n\t\t\t\t\tconfig\n\t\t\t\t};\n\n\t\t\t\tif (!response.ok) {\n\t\t\t\t\tthrow new HttpError(`HTTP Error: ${response.status} ${response.statusText}`, httpResponse, config);\n\t\t\t\t}\n\n\t\t\t\treturn httpResponse;\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tif (error instanceof Error && error.name === 'AbortError') {\n\t\t\t\t\tthrow new AbortError('Request aborted', config);\n\t\t\t\t}\n\t\t\t\tconst message = error instanceof Error ? error.message : 'Network error';\n\t\t\t\tthrow new NetworkError(message || 'Network error', config);\n\t\t\t});\n\n\t\tif (config.deduplicate === true) {\n\t\t\tthis._requestManager.addPendingRequest<T>(config, fetchPromise);\n\t\t}\n\n\t\treturn await fetchPromise;\n\t}\n\n\tprivate async executeRequestInterceptors(config: IRequestConfig): Promise<IRequestConfig> {\n\t\tfor (const interceptor of this._interceptors.request) {\n\t\t\ttry {\n\t\t\t\tconfig = await interceptor.intercept(config);\n\n\t\t\t\tif (config.cancel?.cancelled) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tif (interceptor.error) {\n\t\t\t\t\tawait interceptor.error(error as Error);\n\t\t\t\t}\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\n\t\treturn config;\n\t}\n\n\tprivate async executeResponseInterceptors<T>(response: IHttpResponse<T>): Promise<IHttpResponse<T>> {\n\t\tfor (const interceptor of this._interceptors.response) {\n\t\t\ttry {\n\t\t\t\tresponse = await interceptor.intercept(response);\n\t\t\t} catch (error) {\n\t\t\t\tif (interceptor.error) {\n\t\t\t\t\tawait interceptor.error(error as Error);\n\t\t\t\t}\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\n\t\treturn response;\n\t}\n\n\tprivate mergeConfig(config: IRequestConfig): IRequestConfig {\n\t\treturn {\n\t\t\t...this._clientConfig,\n\t\t\t...config,\n\t\t\theaders: {\n\t\t\t\t...this._clientConfig.defaultHeaders,\n\t\t\t\t...config.headers\n\t\t\t},\n\t\t\turl: this.buildUrl(config.url ?? '', config.params)\n\t\t};\n\t}\n\n\tprivate buildUrl(url: string, params?: Record<string, string | number | boolean>): string {\n\t\tconst baseUrl: string = this._clientConfig.baseURL || '';\n\t\tlet fullUrl = `${baseUrl}${url}`;\n\n\t\tif (params) {\n\t\t\tconst queryString = Object.entries(params)\n\t\t\t\t.map(([key, value]) => `${encodeURIComponent(key)}=${encodeURIComponent(String(value))}`)\n\t\t\t\t.join('&');\n\t\t\tfullUrl += `${fullUrl.includes('?') ? '&' : '?'}${queryString}`;\n\t\t}\n\n\t\treturn fullUrl;\n\t}\n\n\tprivate prepareBody(body?: HttpRequestBody): BodyInit | null {\n\t\tif (body === null || body === undefined) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (\n\t\t\tbody instanceof FormData ||\n\t\t\tbody instanceof Blob ||\n\t\t\tbody instanceof ArrayBuffer ||\n\t\t\tbody instanceof URLSearchParams ||\n\t\t\tbody instanceof ReadableStream ||\n\t\t\ttypeof body === 'string'\n\t\t) {\n\t\t\treturn body as BodyInit;\n\t\t}\n\n\t\t// Plain object - convert to JSON\n\t\treturn JSON.stringify(body);\n\t}\n\n\tprivate async parseResponse<T>(response: Response, onProgress?: (progress: IProgressEvent) => void): Promise<T> {\n\t\tconst contentType = response.headers.get('content-type') || '';\n\t\tconst contentLength = parseInt(response.headers.get('content-length') || '0', 10);\n\n\t\tif (onProgress && response.body && contentLength > 0) {\n\t\t\tconst reader = response.body.getReader();\n\t\t\tlet loaded = 0;\n\t\t\tconst chunks: Uint8Array[] = [];\n\n\t\t\twhile (true) {\n\t\t\t\tconst { done, value } = await reader.read();\n\n\t\t\t\tif (done) break;\n\n\t\t\t\tchunks.push(value);\n\t\t\t\tloaded += value.length;\n\n\t\t\t\tonProgress({\n\t\t\t\t\tloaded,\n\t\t\t\t\ttotal: contentLength,\n\t\t\t\t\tpercentage: (loaded / contentLength) * 100\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst blob = new Blob(chunks as BlobPart[]);\n\n\t\t\tif (contentType.includes('application/json')) {\n\t\t\t\tconst text = await blob.text();\n\t\t\t\treturn JSON.parse(text);\n\t\t\t}\n\n\t\t\treturn blob as T;\n\t\t}\n\n\t\tif (contentType.includes('application/json')) {\n\t\t\treturn (await response.json()) as T;\n\t\t}\n\n\t\tif (contentType.includes('text/')) {\n\t\t\treturn (await response.text()) as T;\n\t\t}\n\n\t\tif (contentType.includes('application/octet-stream') || contentType.includes('image/')) {\n\t\t\treturn (await response.blob()) as T;\n\t\t}\n\n\t\treturn (await response.text()) as T;\n\t}\n}\n","import type { Provider } from '../../bootstrap/types/provider.type';\nimport { HttpClient } from '../classes/http-client.class';\nimport type { IHttpClientConfig, IHttpRequestInterceptor, IHttpResponseInterceptor } from '../interfaces';\n\nexport function provideHttp(\n\thttpClientConfig: IHttpClientConfig,\n\tinterceptors?: { request?: IHttpRequestInterceptor[]; response?: IHttpResponseInterceptor[] }\n): Provider {\n\treturn (injector) => {\n\t\tconst httpClient = new HttpClient(httpClientConfig);\n\n\t\tinjector.bindValue(HttpClient, httpClient);\n\n\t\tif (interceptors?.request) {\n\t\t\tinterceptors.request.forEach((interceptor) => {\n\t\t\t\thttpClient.interceptors.request(interceptor);\n\t\t\t});\n\t\t}\n\n\t\tif (interceptors?.response) {\n\t\t\tinterceptors.response.forEach((interceptor) => {\n\t\t\t\thttpClient.interceptors.response(interceptor);\n\t\t\t});\n\t\t}\n\t};\n}\n","import type { IRouteGuard } from '../interfaces/iroute-guard.interface';\nimport type { GuardFunction } from '../types/guard-function.type';\n\nexport function createGuard(fn: GuardFunction): IRouteGuard {\n\treturn {\n\t\tcanActivate: fn\n\t};\n}\n","import type { IRouteGuard } from '../interfaces/iroute-guard.interface';\nimport type { GuardFunction } from '../types/guard-function.type';\n\nexport function createDeactivateGuard(fn: GuardFunction): IRouteGuard {\n\treturn {\n\t\tcanDeactivate: fn\n\t};\n}\n","import type { IRouteResolver } from '../interfaces/iroute-resolver.interface';\nimport type { ResolverFunction } from '../types/resolver-function.type';\n\nexport function createResolver<T>(fn: ResolverFunction<T>): IRouteResolver<T> {\n\treturn {\n\t\tresolve: fn\n\t};\n}\n","type RuleCheck = (value: string) => boolean;\ntype Rule = RegExp | RuleCheck | string;\ntype Rules = { [key: string]: Rule };\ntype RouteMatchParams = { [key: string]: string } | null;\n\nexport class RouteMatcher {\n\tprivate _reEscape: RegExp = /[-[\\]{}()+?.,\\\\^$|#\\s]/g;\n\tprivate _reParam: RegExp = /([:*])(\\w+)/g;\n\tprivate _names: string[] = [];\n\tprivate _route: string;\n\tprivate _routeRegex: RegExp;\n\tprivate _prefixRegex: RegExp;\n\tprivate _rules: Rules | undefined;\n\tprivate _isWildcard: boolean = false;\n\n\tconstructor(route: string, rules?: Rules) {\n\t\tthis._route = route;\n\t\tthis._rules = rules;\n\t\tthis._isWildcard = route.includes('*');\n\n\t\tlet escapedRoute = this._route.replace(this._reEscape, '\\\\$&');\n\t\tescapedRoute = escapedRoute.replace(this._reParam, (_, mode: string, name: string) => {\n\t\t\tthis._names.push(name);\n\t\t\treturn mode === ':' ? '([^/]*)' : '(.*)';\n\t\t});\n\n\t\tthis._routeRegex = new RegExp('^' + escapedRoute + '$');\n\t\tthis._prefixRegex = new RegExp('^' + escapedRoute + '(?:/|$)');\n\t}\n\n\tparse(url: string): RouteMatchParams {\n\t\tlet i: number = 0;\n\t\tlet param: Rule;\n\t\tlet value: string;\n\t\tconst params: RouteMatchParams = {};\n\t\tconst matches: RegExpMatchArray | null = url.match(this._routeRegex);\n\n\t\tif (!matches) {\n\t\t\treturn null;\n\t\t}\n\n\t\twhile (i < this._names.length) {\n\t\t\tparam = this._names[i++];\n\t\t\tvalue = matches[i];\n\n\t\t\tif (this._rules && param in this._rules && !this.validateRule(this._rules[param], value)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tparams[param] = value;\n\t\t}\n\n\t\treturn params;\n\t}\n\n\tparsePrefix(url: string): { params: RouteMatchParams; matchedPath: string; remainingPath: string } | null {\n\t\tif (this._route === '') {\n\t\t\treturn {\n\t\t\t\tparams: {},\n\t\t\t\tmatchedPath: '',\n\t\t\t\tremainingPath: url\n\t\t\t};\n\t\t}\n\n\t\tconst matches = url.match(this._prefixRegex);\n\t\tif (!matches) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst params: RouteMatchParams = {};\n\t\tfor (let i = 0; i < this._names.length; i++) {\n\t\t\tconst name = this._names[i];\n\t\t\tconst value = matches[i + 1];\n\n\t\t\tif (this._rules && name in this._rules && !this.validateRule(this._rules[name], value)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tparams[name] = value;\n\t\t}\n\n\t\tconst matchedPath = this.calculateMatchedPath(url);\n\t\tconst remainingPath = url.slice(matchedPath.length).replace(/^\\//, '');\n\n\t\treturn { params, matchedPath, remainingPath };\n\t}\n\n\tstringify(params: Record<string, string>): string {\n\t\tlet re: RegExp;\n\t\tlet result: string = this._route;\n\n\t\tfor (const param in params) {\n\t\t\tre = new RegExp('[:*]' + param + '\\\\b');\n\t\t\tresult = result.replace(re, params[param]);\n\t\t}\n\n\t\treturn result.replace(this._reParam, '');\n\t}\n\n\tprivate calculateMatchedPath(url: string): string {\n\t\tif (this._isWildcard) {\n\t\t\treturn url;\n\t\t}\n\n\t\tconst routeSegments = this._route.split('/').filter(Boolean);\n\t\tconst urlSegments = url.split('/').filter(Boolean);\n\n\t\tconst matchedSegments = urlSegments.slice(0, routeSegments.length);\n\t\treturn matchedSegments.join('/');\n\t}\n\n\tprivate validateRule(rule: Rule, value: string): boolean {\n\t\tconst type: string = Object.prototype.toString.call(rule).charAt(8);\n\t\treturn type === 'R' ? (rule as RegExp).test(value) : type === 'F' ? (rule as RuleCheck)(value) : rule === value;\n\t}\n}\n","import type { IRouteContext } from '../interfaces/iroute-context.interface';\n\nexport const ROUTE_CONTEXT_EVENT = 'melodic:route-context';\n\nexport class RouteContextEvent extends CustomEvent<IRouteContext> {\n\tconstructor(context: IRouteContext) {\n\t\tsuper(ROUTE_CONTEXT_EVENT, {\n\t\t\tbubbles: false,\n\t\t\tcomposed: true,\n\t\t\tdetail: context\n\t\t});\n\t}\n}\n","import { RouteMatcher } from '../classes/route-matcher.class';\nimport type { IRouteMatchResult } from '../interfaces/iroute-match-result.interface';\nimport type { IRouteMatch } from '../interfaces/iroute-match.interface';\nimport type { IRoute } from '../interfaces/iroute.interface';\n\nexport function matchRouteLevel(\n\troutes: IRoute[],\n\tremainingPath: string,\n\tbasePath: string,\n\taccumulatedMatches: IRouteMatch[],\n\taccumulatedParams: Record<string, string>\n): IRouteMatchResult {\n\tfor (const route of routes) {\n\t\tconst matcher = new RouteMatcher(route.path);\n\n\t\tif (route.redirectTo && route.path === remainingPath) {\n\t\t\treturn {\n\t\t\t\tmatches: accumulatedMatches,\n\t\t\t\tparams: accumulatedParams,\n\t\t\t\tisExactMatch: false,\n\t\t\t\tredirectTo: route.redirectTo\n\t\t\t};\n\t\t}\n\n\t\tconst exactMatch = matcher.parse(remainingPath);\n\n\t\tif (exactMatch !== null) {\n\t\t\tconst fullPath = basePath ? `${basePath}/${route.path}` : route.path;\n\t\t\tconst match: IRouteMatch = {\n\t\t\t\troute,\n\t\t\t\tparams: exactMatch,\n\t\t\t\tmatchedPath: route.path,\n\t\t\t\tremainingPath: '',\n\t\t\t\tfullPath,\n\t\t\t\tchildren: route.children\n\t\t\t};\n\n\t\t\tObject.assign(accumulatedParams, exactMatch);\n\t\t\taccumulatedMatches.push(match);\n\n\t\t\treturn {\n\t\t\t\tmatches: accumulatedMatches,\n\t\t\t\tparams: accumulatedParams,\n\t\t\t\tisExactMatch: true\n\t\t\t};\n\t\t}\n\n\t\tif (route.children || route.loadChildren) {\n\t\t\tconst prefixResult = matcher.parsePrefix(remainingPath);\n\n\t\t\tif (prefixResult && prefixResult.params !== null) {\n\t\t\t\tconst fullPath = basePath ? `${basePath}/${prefixResult.matchedPath}` : prefixResult.matchedPath;\n\n\t\t\t\tconst match: IRouteMatch = {\n\t\t\t\t\troute,\n\t\t\t\t\tparams: prefixResult.params,\n\t\t\t\t\tmatchedPath: prefixResult.matchedPath,\n\t\t\t\t\tremainingPath: prefixResult.remainingPath,\n\t\t\t\t\tfullPath,\n\t\t\t\t\tchildren: route.children\n\t\t\t\t};\n\n\t\t\t\tObject.assign(accumulatedParams, prefixResult.params);\n\t\t\t\taccumulatedMatches.push(match);\n\n\t\t\t\t// Recurse into children\n\t\t\t\tif (route.children && prefixResult.remainingPath) {\n\t\t\t\t\treturn matchRouteLevel(route.children, prefixResult.remainingPath, fullPath, accumulatedMatches, accumulatedParams);\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tmatches: accumulatedMatches,\n\t\t\t\t\tparams: accumulatedParams,\n\t\t\t\t\tisExactMatch: prefixResult.remainingPath === ''\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\treturn {\n\t\tmatches: accumulatedMatches,\n\t\tparams: accumulatedParams,\n\t\tisExactMatch: false\n\t};\n}\n","import type { IRouteMatchResult } from '../interfaces/iroute-match-result.interface';\nimport type { IRouteMatch } from '../interfaces/iroute-match.interface';\nimport type { IRoute } from '../interfaces/iroute.interface';\nimport { matchRouteLevel } from './match-route-level.function';\n\n/**\n * Match a URL path against a route tree, supporting nested routes.\n */\nexport function matchRouteTree(routes: IRoute[], path: string, basePath: string = ''): IRouteMatchResult {\n\tconst normalizedPath = path.startsWith('/') ? path.slice(1) : path;\n\tconst matches: IRouteMatch[] = [];\n\tconst params: Record<string, string> = {};\n\n\tconst result = matchRouteLevel(routes, normalizedPath, basePath, matches, params);\n\n\treturn {\n\t\tmatches: result.matches,\n\t\tparams: result.params,\n\t\tisExactMatch: result.isExactMatch,\n\t\tredirectTo: result.redirectTo\n\t};\n}\n","import type { IRoute } from '../interfaces/iroute.interface';\n\nexport function findRouteByName(routes: IRoute[], name: string): IRoute | null {\n\tfor (const route of routes) {\n\t\tif (route.name === name) {\n\t\t\treturn route;\n\t\t}\n\t\tif (route.children) {\n\t\t\tconst found = findRouteByName(route.children, name);\n\t\t\tif (found) return found;\n\t\t}\n\t}\n\treturn null;\n}\n","import { RouteMatcher } from '../classes/route-matcher.class';\nimport type { IRoute } from '../interfaces/iroute.interface';\n\nexport function buildPathFromRoute(routes: IRoute[], name: string, params: Record<string, string> = {}): string | null {\n\tconst pathParts: string[] = [];\n\n\tfunction findAndBuildPath(routeList: IRoute[], targetName: string): boolean {\n\t\tfor (const route of routeList) {\n\t\t\tif (route.name === targetName) {\n\t\t\t\tconst matcher = new RouteMatcher(route.path);\n\t\t\t\tpathParts.push(matcher.stringify(params));\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (route.children) {\n\t\t\t\tconst matcher = new RouteMatcher(route.path);\n\t\t\t\tconst segment = matcher.stringify(params);\n\n\t\t\t\tif (findAndBuildPath(route.children, targetName)) {\n\t\t\t\t\tpathParts.unshift(segment);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tif (findAndBuildPath(routes, name)) {\n\t\treturn '/' + pathParts.filter(Boolean).join('/');\n\t}\n\n\treturn null;\n}\n","import { Injectable } from '../../injection/decorators/injectable.decorator';\nimport type { IRoute } from '../interfaces/iroute.interface';\nimport type { IRouteMatch } from '../interfaces/iroute-match.interface';\nimport type { IRouteMatchResult } from '../interfaces/iroute-match-result.interface';\nimport type { IRouteContext } from '../interfaces/iroute-context.interface';\n\n@Injectable()\nexport class RouteContextService {\n\tprivate _matchStack: IRouteMatch[] = [];\n\tprivate _contexts: Map<number, IRouteContext> = new Map();\n\tprivate _currentMatchResult: IRouteMatchResult | null = null;\n\tprivate _resolvedData: Map<number, Record<string, unknown>> = new Map();\n\n\tsetMatchResult(result: IRouteMatchResult): void {\n\t\tthis._currentMatchResult = result;\n\t\tthis._matchStack = result.matches;\n\n\t\tthis._contexts.clear();\n\n\t\tlet basePath = '';\n\t\tconst ancestorMatches: IRouteMatch[] = [];\n\t\tconst accumulatedParams: Record<string, string> = {};\n\n\t\tfor (let i = 0; i < result.matches.length; i++) {\n\t\t\tconst match = result.matches[i];\n\t\t\tancestorMatches.push(match);\n\t\t\tObject.assign(accumulatedParams, match.params);\n\n\t\t\tconst context: IRouteContext = {\n\t\t\t\tdepth: i,\n\t\t\t\troutes: match.children ?? [],\n\t\t\t\tcurrentMatch: match,\n\t\t\t\tancestorMatches: [...ancestorMatches],\n\t\t\t\tparams: { ...accumulatedParams },\n\t\t\t\tremainingPath: match.remainingPath,\n\t\t\t\tbasePath: basePath,\n\t\t\t\tparent: i > 0 ? this._contexts.get(i - 1) : undefined\n\t\t\t};\n\n\t\t\tthis._contexts.set(i, context);\n\t\t\tbasePath = match.fullPath;\n\t\t}\n\t}\n\n\tsetResolvedData(depth: number, data: Record<string, unknown>): void {\n\t\tthis._resolvedData.set(depth, data);\n\t}\n\n\tclearResolvedData(): void {\n\t\tthis._resolvedData.clear();\n\t}\n\n\tgetContextForDepth(depth: number): IRouteContext | undefined {\n\t\treturn this._contexts.get(depth);\n\t}\n\n\tgetChildRoutesForDepth(depth: number): IRoute[] {\n\t\tconst parentContext = this._contexts.get(depth - 1);\n\n\t\tif (depth === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn parentContext?.currentMatch?.children ?? [];\n\t}\n\n\tgetRemainingPathForDepth(depth: number): string {\n\t\tif (depth === 0) {\n\t\t\treturn window.location.pathname;\n\t\t}\n\n\t\tconst parentContext = this._contexts.get(depth - 1);\n\n\t\treturn parentContext?.remainingPath ?? '';\n\t}\n\n\tgetParamsForDepth(depth: number): Record<string, string> {\n\t\tconst context = this._contexts.get(depth);\n\t\treturn context?.params ?? {};\n\t}\n\n\tgetCurrentParams(): Record<string, string> {\n\t\treturn this._currentMatchResult?.params ?? {};\n\t}\n\n\tgetMatchStack(): IRouteMatch[] {\n\t\treturn [...this._matchStack];\n\t}\n\n\tgetCurrentMatchResult(): IRouteMatchResult | null {\n\t\treturn this._currentMatchResult;\n\t}\n\n\tgetMergedRouteData(depth?: number): Record<string, unknown> {\n\t\tconst maxDepth = depth ?? this._matchStack.length - 1;\n\t\tconst merged: Record<string, unknown> = {};\n\n\t\tfor (let i = 0; i <= maxDepth && i < this._matchStack.length; i++) {\n\t\t\tconst match = this._matchStack[i];\n\t\t\tif (match.route.data) {\n\t\t\t\tObject.assign(merged, match.route.data);\n\t\t\t}\n\t\t}\n\n\t\treturn merged;\n\t}\n\n\tgetMergedResolvedData(depth?: number): Record<string, unknown> {\n\t\tconst maxDepth = depth ?? this._matchStack.length - 1;\n\t\tconst merged: Record<string, unknown> = {};\n\n\t\tfor (let i = 0; i <= maxDepth; i++) {\n\t\t\tconst data = this._resolvedData.get(i);\n\t\t\tif (data) {\n\t\t\t\tObject.assign(merged, data);\n\t\t\t}\n\t\t}\n\n\t\treturn merged;\n\t}\n\n\tgetResolvedDataForDepth(depth: number): Record<string, unknown> | undefined {\n\t\treturn this._resolvedData.get(depth);\n\t}\n}\n","import { Injectable } from '../../injection/decorators/injectable.decorator';\nimport type { IRouterEventState } from '../interfaces/irouter-event-state.interface';\nimport type { IRouteGuard } from '../interfaces/iroute-guard.interface';\nimport type { IRouteResolver } from '../interfaces/iroute-resolver.interface';\nimport type { RouterStateEvent } from '../types/router-state-event.type';\nimport { RouteContextService } from './route-context.service';\nimport type { IResolverContext } from '../interfaces/iresolver-context.interface';\nimport type { AsyncGuardResult } from '../types/guard-result.type';\nimport type { IGuardContext } from '../interfaces/iguard-context.interface';\nimport type { INavigationOptions } from '../interfaces/inavigation-options.interface';\nimport type { INavigationResult } from '../interfaces/inavigation-result.interface';\nimport type { IRoute } from '../interfaces/iroute.interface';\nimport type { IRouteMatch } from '../interfaces/iroute-match.interface';\nimport type { IRouteMatchResult } from '../interfaces/iroute-match-result.interface';\nimport { matchRouteTree } from '../functions/match-route-tree.function';\nimport { buildPathFromRoute } from '../functions/build-path-from-route.function';\n\nconst routerStateEvent = (type: RouterStateEvent, data: unknown, title: string, url: string): PopStateEvent => {\n\treturn new PopStateEvent('History', {\n\t\tstate: {\n\t\t\ttype: type,\n\t\t\tdata: data,\n\t\t\turl: url,\n\t\t\thost: window.location.host,\n\t\t\thostName: window.location.hostname,\n\t\t\thref: window.location.href,\n\t\t\tpathName: window.location.pathname,\n\t\t\tport: window.location.port,\n\t\t\tprotocol: window.location.protocol,\n\t\t\tparams: new URLSearchParams(window.location.search),\n\t\t\ttitle: title\n\t\t} as IRouterEventState\n\t});\n};\n\n// monkey-patch history methods to emit NavigationEvent\nconst pushState = history.pushState;\nhistory.pushState = (data: unknown, title: string, url?: string | URL | null): void => {\n\tpushState.apply(history, [data, title, url]);\n\n\tconst navigationEvent = new CustomEvent('NavigationEvent', {\n\t\tdetail: routerStateEvent('push', data, title, url as string)\n\t});\n\twindow.dispatchEvent(navigationEvent);\n};\n\nconst replaceState = history.replaceState;\nhistory.replaceState = (data: unknown, title: string, url?: string | URL | null): void => {\n\treplaceState.apply(history, [data, title, url]);\n\n\tconst navigationEvent = new CustomEvent('NavigationEvent', {\n\t\tdetail: routerStateEvent('replace', data, title, url as string)\n\t});\n\twindow.dispatchEvent(navigationEvent);\n};\n\n@Injectable()\nexport class RouterService {\n\tprivate _route: IRouterEventState | undefined;\n\tprivate _routes: IRoute[] = [];\n\tprivate _contextService: RouteContextService;\n\tprivate _currentMatches: IRouteMatch[] = [];\n\tprivate _resolversExecutedForPath: string | null = null;\n\tprivate _currentPath: string = `${window.location.pathname}${window.location.search}`;\n\n\tconstructor() {\n\t\tthis._contextService = new RouteContextService();\n\n\t\twindow.addEventListener('NavigationEvent', (event: Event) => {\n\t\t\tthis._route = ((event as CustomEvent).detail as PopStateEvent).state;\n\t\t});\n\n\t\twindow.addEventListener('popstate', (event: PopStateEvent) => {\n\t\t\tvoid this.handlePopState(event);\n\t\t});\n\t}\n\n\tsetRoutes(routes: IRoute[]): void {\n\t\tthis._routes = routes;\n\t}\n\n\tgetRoutes(): IRoute[] {\n\t\treturn this._routes;\n\t}\n\n\tgetContextService(): RouteContextService {\n\t\treturn this._contextService;\n\t}\n\n\tgetRoute(): IRouterEventState | undefined {\n\t\treturn this._route;\n\t}\n\n\tgetParams(): Record<string, string> {\n\t\treturn this._contextService.getCurrentParams();\n\t}\n\n\tgetParam(name: string): string | undefined {\n\t\treturn this._contextService.getCurrentParams()[name];\n\t}\n\n\tgetQueryParams(): URLSearchParams {\n\t\treturn new URLSearchParams(window.location.search);\n\t}\n\n\tgetCurrentMatches(): IRouteMatch[] {\n\t\treturn [...this._currentMatches];\n\t}\n\n\tgetRouteData(depth?: number): Record<string, unknown> {\n\t\treturn this._contextService.getMergedRouteData(depth);\n\t}\n\n\tgetResolvedData(depth?: number): Record<string, unknown> {\n\t\treturn this._contextService.getMergedResolvedData(depth);\n\t}\n\n\tmatchPath(path: string): IRouteMatchResult {\n\t\treturn matchRouteTree(this._routes, path);\n\t}\n\n\tsetCurrentMatches(result: IRouteMatchResult): void {\n\t\tthis._currentMatches = result.matches;\n\t\tthis._contextService.setMatchResult(result);\n\t}\n\n\tasync runResolvers(matchResult: IRouteMatchResult): Promise<{ success: boolean; error?: string }> {\n\t\tconst currentPath = `${window.location.pathname}${window.location.search}`;\n\n\t\tif (this._resolversExecutedForPath === currentPath) {\n\t\t\tthis._resolversExecutedForPath = null; // Clear for next navigation\n\t\t\treturn { success: true };\n\t\t}\n\n\t\tconst result = await this.runResolversInternal(matchResult);\n\t\tthis._resolversExecutedForPath = null; // Clear after execution\n\t\treturn result;\n\t}\n\n\tasync navigate(path: string, options: INavigationOptions = {}): Promise<INavigationResult> {\n\t\tconst { data, replace = false, queryParams, skipGuards = false, skipResolvers = false, scrollToTop = true } = options;\n\n\t\tlet fullPath = path;\n\t\tif (queryParams && Object.keys(queryParams).length > 0) {\n\t\t\tconst params = new URLSearchParams(queryParams);\n\t\t\tfullPath = `${path}?${params.toString()}`;\n\t\t}\n\n\t\tif (!skipGuards && this._currentMatches.length > 0) {\n\t\t\tconst deactivateResult = await this.runDeactivationGuards(fullPath);\n\t\t\tif (deactivateResult !== true) {\n\t\t\t\tif (typeof deactivateResult === 'string') {\n\t\t\t\t\treturn this.navigate(deactivateResult, { ...options, skipGuards: true });\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\terror: 'Navigation blocked by guard'\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tconst matchResult = this.matchPath(path);\n\n\t\tif (matchResult.redirectTo) {\n\t\t\treturn this.navigate(matchResult.redirectTo, { ...options, replace: true });\n\t\t}\n\n\t\tif (!skipGuards && matchResult.matches.length > 0) {\n\t\t\tconst guardResult = await this.runGuards(matchResult);\n\n\t\t\tif (guardResult !== true) {\n\t\t\t\tif (typeof guardResult === 'string') {\n\t\t\t\t\treturn this.navigate(guardResult, { ...options, skipGuards: true });\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\terror: 'Navigation blocked by guard'\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (!skipResolvers && matchResult.matches.length > 0) {\n\t\t\tconst resolverResult = await this.runResolversInternal(matchResult);\n\n\t\t\tif (!resolverResult.success) {\n\t\t\t\treturn {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\terror: resolverResult.error ?? 'Navigation blocked by resolver'\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis._resolversExecutedForPath = fullPath;\n\t\t}\n\n\t\tif (replace) {\n\t\t\thistory.replaceState(data, '', fullPath);\n\t\t} else {\n\t\t\thistory.pushState(data, '', fullPath);\n\t\t}\n\t\tthis._currentPath = fullPath;\n\n\t\tif (scrollToTop) {\n\t\t\tconst hash = fullPath.includes('#') ? fullPath.split('#')[1] : null;\n\t\t\tif (hash) {\n\t\t\t\tconst element = document.getElementById(hash);\n\t\t\t\tif (element) {\n\t\t\t\t\telement.scrollIntoView();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twindow.scrollTo(0, 0);\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t\turl: fullPath\n\t\t};\n\t}\n\n\tasync navigateByName(name: string, params: Record<string, string> = {}, options: INavigationOptions = {}): Promise<INavigationResult> {\n\t\tconst path = buildPathFromRoute(this._routes, name, params);\n\n\t\tif (!path) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: `Route with name '${name}' not found`\n\t\t\t};\n\t\t}\n\n\t\treturn this.navigate(path, options);\n\t}\n\n\treplace(path: string, data?: unknown): void {\n\t\thistory.replaceState(data, '', path);\n\t\tthis._currentPath = `${window.location.pathname}${window.location.search}`;\n\t}\n\n\tback(): void {\n\t\thistory.back();\n\t}\n\n\tforward(): void {\n\t\thistory.forward();\n\t}\n\n\tgo(delta: number): void {\n\t\thistory.go(delta);\n\t}\n\n\tasync runDeactivationGuards(targetPath: string): Promise<boolean | string> {\n\t\tfor (const match of this._currentMatches) {\n\t\t\tconst guards = match.route.canDeactivate ?? [];\n\n\t\t\tfor (const guard of guards) {\n\t\t\t\tconst context = this.createGuardContext(match, {\n\t\t\t\t\tmatches: this._currentMatches,\n\t\t\t\t\tparams: this._contextService.getCurrentParams(),\n\t\t\t\t\tisExactMatch: true\n\t\t\t\t});\n\t\t\t\tcontext.targetPath = targetPath;\n\n\t\t\t\tconst result = await this.executeGuard(guard, 'canDeactivate', context);\n\n\t\t\t\tif (result !== true) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate async runGuards(matchResult: IRouteMatchResult): Promise<boolean | string> {\n\t\tfor (const match of matchResult.matches) {\n\t\t\tconst guards = match.route.canActivate ?? [];\n\n\t\t\tfor (const guard of guards) {\n\t\t\t\tconst context = this.createGuardContext(match, matchResult);\n\t\t\t\tconst result = await this.executeGuard(guard, 'canActivate', context);\n\n\t\t\t\tif (result !== true) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate async executeGuard(guard: IRouteGuard, method: 'canActivate' | 'canDeactivate', context: IGuardContext): Promise<boolean | string> {\n\t\tconst fn = guard[method];\n\t\tif (!fn) {\n\t\t\treturn true;\n\t\t}\n\n\t\ttry {\n\t\t\tconst result: AsyncGuardResult = fn.call(guard, context);\n\t\t\treturn result instanceof Promise ? await result : result;\n\t\t} catch (error) {\n\t\t\tconsole.error(`Guard error:`, error);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tprivate createGuardContext(match: IRouteMatch, matchResult: IRouteMatchResult): IGuardContext {\n\t\treturn {\n\t\t\troute: match,\n\t\t\tmatchedRoutes: matchResult.matches,\n\t\t\tparams: matchResult.params,\n\t\t\tqueryParams: new URLSearchParams(window.location.search),\n\t\t\ttargetPath: window.location.pathname,\n\t\t\tcurrentPath: window.location.pathname,\n\t\t\tdata: match.route.data\n\t\t};\n\t}\n\n\tprivate async runResolversInternal(matchResult: IRouteMatchResult): Promise<{ success: boolean; error?: string }> {\n\t\tthis._contextService.clearResolvedData();\n\n\t\tfor (let depth = 0; depth < matchResult.matches.length; depth++) {\n\t\t\tconst match = matchResult.matches[depth];\n\t\t\tconst resolvers = match.route.resolve;\n\n\t\t\tif (!resolvers) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst resolvedData: Record<string, unknown> = {};\n\t\t\tconst context = this.createResolverContext(match, matchResult);\n\n\t\t\tfor (const [key, resolver] of Object.entries(resolvers)) {\n\t\t\t\ttry {\n\t\t\t\t\tconst result = await this.executeResolver(resolver, context);\n\t\t\t\t\tresolvedData[key] = result;\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error(`Resolver '${key}' failed:`, error);\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror: `Resolver '${key}' failed: ${error instanceof Error ? error.message : String(error)}`\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._contextService.setResolvedData(depth, resolvedData);\n\t\t}\n\n\t\treturn { success: true };\n\t}\n\n\tprivate async handlePopState(event: PopStateEvent): Promise<void> {\n\t\tconst targetPath = `${window.location.pathname}${window.location.search}`;\n\t\tconst guardResult = await this.runDeactivationGuards(targetPath);\n\n\t\tif (guardResult !== true) {\n\t\t\tif (typeof guardResult === 'string') {\n\t\t\t\tawait this.navigate(guardResult, { replace: true, skipGuards: true });\n\t\t\t} else {\n\t\t\t\thistory.replaceState(event.state, '', this._currentPath);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tthis._currentPath = targetPath;\n\t\tconst navigationEvent = new CustomEvent('NavigationEvent', {\n\t\t\tdetail: routerStateEvent('push', event.state, '', window.location.pathname)\n\t\t});\n\t\twindow.dispatchEvent(navigationEvent);\n\t}\n\n\tprivate async executeResolver(resolver: IRouteResolver, context: IResolverContext): Promise<unknown> {\n\t\tconst result = resolver.resolve(context);\n\t\treturn result instanceof Promise ? await result : result;\n\t}\n\n\tprivate createResolverContext(match: IRouteMatch, matchResult: IRouteMatchResult): IResolverContext {\n\t\treturn {\n\t\t\troute: match,\n\t\t\tmatchedRoutes: matchResult.matches,\n\t\t\tparams: matchResult.params,\n\t\t\tqueryParams: new URLSearchParams(window.location.search),\n\t\t\ttargetPath: window.location.pathname\n\t\t};\n\t}\n}\n","import type { AttributeDirectiveFunction } from '../types/attribute-directive-function.type';\n\nconst directiveRegistry = new Map<string, AttributeDirectiveFunction>();\n\nconst findAttributeDirective = (name: string): AttributeDirectiveFunction | undefined => {\n\tif (directiveRegistry.has(name)) {\n\t\treturn directiveRegistry.get(name);\n\t}\n\n\tconst lowerName = name.toLowerCase();\n\tfor (const [key, value] of directiveRegistry) {\n\t\tif (key.toLowerCase() === lowerName) {\n\t\t\treturn value;\n\t\t}\n\t}\n\n\treturn undefined;\n};\n\nexport function registerAttributeDirective(name: string, directive: AttributeDirectiveFunction): void {\n\tdirectiveRegistry.set(name, directive);\n}\n\nexport function getAttributeDirective(name: string): AttributeDirectiveFunction | undefined {\n\treturn findAttributeDirective(name);\n}\n\nexport function hasAttributeDirective(name: string): boolean {\n\treturn findAttributeDirective(name) !== undefined;\n}\n\nexport function unregisterAttributeDirective(name: string): boolean {\n\treturn directiveRegistry.delete(name);\n}\n\nexport function getRegisteredDirectives(): string[] {\n\treturn Array.from(directiveRegistry.keys());\n}\n","import type { IDirectiveResult } from '../interfaces/idirective-result.interface';\n\nexport function isDirective(value: unknown): value is IDirectiveResult {\n\treturn typeof value === 'object' && value !== null && '__directive' in value;\n}\n","import { getAttributeDirective } from '../directives/functions/attribute-directive.functions';\nimport type { ITemplatePart } from '../interfaces/itemplate-part.interface';\nimport type { ITemplateCache, IPartPath } from '../interfaces/itemplate-cache.interface';\nimport { isDirective } from '../directives/functions/is-directive.function';\n\n// Unique marker for identifying dynamic positions\nconst MARKER = `m${Math.random().toString(36).slice(2, 9)}`;\nconst COMMENT_NODE_MARKER = `<!--${MARKER}-->`;\nconst ATTRIBUTE_MARKER_PREFIX = `__${MARKER}_`;\nconst ATTRIBUTE_MARKER_REGEX = new RegExp(`${ATTRIBUTE_MARKER_PREFIX}(\\\\d+)__`, 'g');\n\nconst createAttributeMarker = (index: number): string => `${ATTRIBUTE_MARKER_PREFIX}${index}__`;\n\nconst templateCache = new Map<string, ITemplateCache>();\n\n// Cache template keys by TemplateStringsArray identity to avoid repeated string joins\nconst templateKeyCache = new WeakMap<TemplateStringsArray, string>();\n\n/**\n * Get or create a cache key for the template strings array.\n * Uses WeakMap to cache by object identity, avoiding expensive string joins on repeated renders.\n */\nfunction getTemplateKey(strings: TemplateStringsArray): string {\n\tlet key = templateKeyCache.get(strings);\n\tif (key === undefined) {\n\t\tkey = strings.join(MARKER);\n\t\ttemplateKeyCache.set(strings, key);\n\t}\n\treturn key;\n}\n\nexport class TemplateResult {\n\tstrings: TemplateStringsArray;\n\tvalues: unknown[];\n\n\tconstructor(strings: TemplateStringsArray, values: unknown[]) {\n\t\tthis.strings = strings;\n\t\tthis.values = values;\n\t}\n\n\t/**\n\t * Optimized render for single-use containers (like repeat items).\n\t * Returns the rendered nodes directly.\n\t */\n\trenderOnce(container: DocumentFragment): Node[] {\n\t\tconst templateKey = getTemplateKey(this.strings);\n\t\tconst cache = this.getTemplate(templateKey);\n\t\tconst clone = cache.element.content.cloneNode(true);\n\t\tconst parts = this.prepareParts(clone, cache);\n\n\t\tthis.commit(parts);\n\t\tcontainer.appendChild(clone);\n\n\t\t(container as any).__parts = parts;\n\t\t(container as any).__templateKey = templateKey;\n\n\t\treturn Array.from(container.childNodes);\n\t}\n\n\trenderInto(container: Element | DocumentFragment): void {\n\t\tconst templateKey = getTemplateKey(this.strings);\n\n\t\t// Get or create template\n\t\tconst { element: template } = this.getTemplate(templateKey);\n\n\t\t// First render - clone and prepare\n\t\tconst existingKey = (container as any).__templateKey as string | undefined;\n\t\tif (existingKey && existingKey !== templateKey) {\n\t\t\tconst existingParts = (container as any).__parts as ITemplatePart[] | undefined;\n\t\t\tif (existingParts) {\n\t\t\t\tthis.cleanupParts(existingParts);\n\t\t\t}\n\t\t\tdelete (container as any).__parts;\n\t\t}\n\n\t\tif (!(container as any).__parts) {\n\t\t\tconst clone = template.content.cloneNode(true);\n\t\t\tconst parts = this.prepareParts(clone, this.getTemplate(templateKey));\n\n\t\t\t(container as any).__parts = parts;\n\t\t\t(container as any).__templateKey = templateKey;\n\n\t\t\t// Commit values BEFORE appending to DOM so attributes are set\n\t\t\t// before connectedCallback fires on child custom elements\n\t\t\tthis.commit(parts);\n\n\t\t\tcontainer.textContent = '';\n\t\t\tcontainer.appendChild(clone);\n\t\t\treturn;\n\t\t}\n\n\t\t// Update values\n\t\tif (!(container as any).__templateKey) {\n\t\t\t(container as any).__templateKey = templateKey;\n\t\t}\n\t\tconst parts = (container as any).__parts as ITemplatePart[];\n\t\tthis.commit(parts);\n\t}\n\n\tprivate getTemplate(key: string): ITemplateCache {\n\t\tlet cached = templateCache.get(key);\n\n\t\tif (cached) {\n\t\t\treturn cached;\n\t\t}\n\n\t\tconst parts: ITemplatePart[] = [];\n\t\tlet html = this.strings[0];\n\n\t\tconst attrPreProcessor = this.getAttributePreProcessor(parts);\n\t\tlet activeAttributeName: string | null = null;\n\t\tlet activeAttributeQuote: string | null = null;\n\n\t\tfor (let i = 1; i < this.strings.length; i++) {\n\t\t\tconst s = this.strings[i];\n\t\t\tconst valueIndex = i - 1;\n\n\t\t\tconst match = /([@.:]?[\\w:-]+)\\s*=\\s*[\"']?$/.exec(html);\n\t\t\tconst quotedAttrMatch = /([@.:]?[\\w:-]+)\\s*=\\s*([\"'])([^\"']*)$/.exec(html);\n\t\t\tlet attrKey: string = '___';\n\n\t\t\tif (activeAttributeName) {\n\t\t\t\thtml += createAttributeMarker(valueIndex);\n\t\t\t} else {\n\t\t\t\tconst quotedName = quotedAttrMatch?.[1];\n\t\t\t\tconst quotedPrefix = quotedName?.charAt(0);\n\t\t\t\tconst hasSpecialPrefix = quotedPrefix !== undefined && Object.keys(attrPreProcessor).includes(quotedPrefix);\n\n\t\t\t\tif (quotedAttrMatch && !hasSpecialPrefix) {\n\t\t\t\t\thtml += createAttributeMarker(valueIndex);\n\t\t\t\t\tactiveAttributeName = quotedAttrMatch[1];\n\t\t\t\t\tactiveAttributeQuote = quotedAttrMatch[2];\n\t\t\t\t} else {\n\t\t\t\t\tif (match) {\n\t\t\t\t\t\tattrKey = '__';\n\t\t\t\t\t\tconst attrPrefix: string = match[1].charAt(0);\n\n\t\t\t\t\t\tif (Object.keys(attrPreProcessor).includes(attrPrefix)) {\n\t\t\t\t\t\t\tattrKey = attrPrefix;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (attrKey === '__' && match) {\n\t\t\t\t\t\thtml += createAttributeMarker(valueIndex);\n\t\t\t\t\t\tactiveAttributeName = match[1];\n\t\t\t\t\t\tconst quoteMatch = /([\"'])$/.exec(match[0]);\n\t\t\t\t\t\tactiveAttributeQuote = quoteMatch ? quoteMatch[1] : null;\n\t\t\t\t\t} else {\n\t\t\t\t\t\thtml = attrPreProcessor[attrKey](valueIndex, html, match ? match[1] : undefined, match);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\thtml += s;\n\n\t\t\tif (activeAttributeName) {\n\t\t\t\tif (activeAttributeQuote) {\n\t\t\t\t\tif (s.includes(activeAttributeQuote)) {\n\t\t\t\t\t\tactiveAttributeName = null;\n\t\t\t\t\t\tactiveAttributeQuote = null;\n\t\t\t\t\t}\n\t\t\t\t} else if (/[\\s>]/.test(s)) {\n\t\t\t\t\tactiveAttributeName = null;\n\t\t\t\t\tactiveAttributeQuote = null;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst element = document.createElement('template');\n\t\telement.innerHTML = html;\n\n\t\t// Pre-compute part paths by walking template DOM once\n\t\tconst partPaths: IPartPath[] = [];\n\t\tlet nodePartCursor = 0;\n\n\t\t// Build lookup for node parts by index order\n\t\tconst nodeParts: ITemplatePart[] = [];\n\t\tconst eventPartsByIndex = new Map<number, ITemplatePart>();\n\t\tconst propertyPartsByIndex = new Map<number, ITemplatePart>();\n\t\tconst actionPartsByIndex = new Map<number, ITemplatePart>();\n\n\t\tfor (const part of parts) {\n\t\t\tswitch (part.type) {\n\t\t\t\tcase 'event':\n\t\t\t\t\teventPartsByIndex.set(part.index, part);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'property':\n\t\t\t\t\tpropertyPartsByIndex.set(part.index, part);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'action':\n\t\t\t\t\tactionPartsByIndex.set(part.index, part);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'node':\n\t\t\t\t\tnodeParts.push(part);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// Walk template content once to record paths\n\t\tconst walkTemplate = (node: Node, path: number[]) => {\n\t\t\tif (node.nodeType === Node.COMMENT_NODE) {\n\t\t\t\tconst comment = node as Comment;\n\t\t\t\tif (comment.data === MARKER) {\n\t\t\t\t\tconst part = nodeParts[nodePartCursor++];\n\t\t\t\t\tif (part) {\n\t\t\t\t\t\tpartPaths.push({\n\t\t\t\t\t\t\tpath: [...path],\n\t\t\t\t\t\t\ttype: 'node',\n\t\t\t\t\t\t\tindex: part.index\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (node.nodeType === Node.ELEMENT_NODE) {\n\t\t\t\tconst el = node as Element;\n\n\t\t\t\t// Check attributes for markers\n\t\t\t\tfor (let i = el.attributes.length - 1; i >= 0; i--) {\n\t\t\t\t\tconst attr = el.attributes[i];\n\n\t\t\t\t\tif (attr.name.startsWith('__event-')) {\n\t\t\t\t\t\tconst index = parseInt(attr.name.match(/__event-(\\d+)__/)?.[1] || '0');\n\t\t\t\t\t\tconst part = eventPartsByIndex.get(index);\n\t\t\t\t\t\tif (part) {\n\t\t\t\t\t\t\tpartPaths.push({\n\t\t\t\t\t\t\t\tpath: [...path],\n\t\t\t\t\t\t\t\ttype: 'event',\n\t\t\t\t\t\t\t\tindex: part.index,\n\t\t\t\t\t\t\t\tname: part.name\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (attr.name.startsWith('__prop-')) {\n\t\t\t\t\t\tconst index = parseInt(attr.name.match(/__prop-(\\d+)__/)?.[1] || '0');\n\t\t\t\t\t\tconst part = propertyPartsByIndex.get(index);\n\t\t\t\t\t\tif (part) {\n\t\t\t\t\t\t\tpartPaths.push({\n\t\t\t\t\t\t\t\tpath: [...path],\n\t\t\t\t\t\t\t\ttype: 'property',\n\t\t\t\t\t\t\t\tindex: part.index,\n\t\t\t\t\t\t\t\tname: part.name\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (attr.name.startsWith('__action-')) {\n\t\t\t\t\t\tconst index = parseInt(attr.name.match(/__action-(\\d+)__/)?.[1] || '0');\n\t\t\t\t\t\tconst part = actionPartsByIndex.get(index);\n\t\t\t\t\t\tif (part) {\n\t\t\t\t\t\t\tpartPaths.push({\n\t\t\t\t\t\t\t\tpath: [...path],\n\t\t\t\t\t\t\t\ttype: 'action',\n\t\t\t\t\t\t\t\tindex: part.index,\n\t\t\t\t\t\t\t\tname: part.name\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (attr.name.startsWith(':')) {\n\t\t\t\t\t\t// Static action directive\n\t\t\t\t\t\tpartPaths.push({\n\t\t\t\t\t\t\tpath: [...path],\n\t\t\t\t\t\t\ttype: 'action',\n\t\t\t\t\t\t\tindex: -1,\n\t\t\t\t\t\t\tname: attr.name.slice(1),\n\t\t\t\t\t\t\tstaticValue: attr.value\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (attr.value.includes(ATTRIBUTE_MARKER_PREFIX)) {\n\t\t\t\t\t\tconst attributeInfo = this.parseAttributeValue(attr.value);\n\t\t\t\t\t\tif (attributeInfo) {\n\t\t\t\t\t\t\tconst isComposite = attributeInfo.indices.length > 1 || attributeInfo.strings.some((s) => s.length > 0);\n\t\t\t\t\t\t\tpartPaths.push({\n\t\t\t\t\t\t\t\tpath: [...path],\n\t\t\t\t\t\t\t\ttype: 'attribute',\n\t\t\t\t\t\t\t\tindex: attributeInfo.indices[0],\n\t\t\t\t\t\t\t\tname: attr.name,\n\t\t\t\t\t\t\t\tattributeStrings: isComposite ? attributeInfo.strings : undefined,\n\t\t\t\t\t\t\t\tattributeIndices: isComposite ? attributeInfo.indices : undefined\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Walk children\n\t\t\tconst children = node.childNodes;\n\t\t\tfor (let i = 0; i < children.length; i++) {\n\t\t\t\tpath.push(i);\n\t\t\t\twalkTemplate(children[i], path);\n\t\t\t\tpath.pop();\n\t\t\t}\n\t\t};\n\n\t\twalkTemplate(element.content, []);\n\n\t\tcached = { element, parts, partPaths };\n\t\tif (templateCache.size >= 500) {\n\t\t\tconst oldestKey = templateCache.keys().next().value;\n\t\t\tif (oldestKey) {\n\t\t\t\ttemplateCache.delete(oldestKey);\n\t\t\t}\n\t\t}\n\t\ttemplateCache.set(key, cached);\n\n\t\treturn cached;\n\t}\n\n\tprivate getAttributePreProcessor(\n\t\tparts: ITemplatePart[]\n\t): Record<string, (index: number, html: string, attrName?: string, match?: RegExpExecArray | null) => string> {\n\t\treturn {\n\t\t\t'@': (index: number, html: string, attrName?: string, match?: RegExpExecArray | null) => {\n\t\t\t\t// Event binding\n\t\t\t\tparts.push({\n\t\t\t\t\ttype: 'event',\n\t\t\t\t\tindex: index,\n\t\t\t\t\tname: attrName?.slice(1)\n\t\t\t\t});\n\t\t\t\treturn html.slice(0, -(match?.[0].length ?? 0)) + `__event-${index}__=\"\"`;\n\t\t\t},\n\t\t\t'.': (index: number, html: string, attrName?: string, match?: RegExpExecArray | null) => {\n\t\t\t\t// Property binding\n\t\t\t\tparts.push({\n\t\t\t\t\ttype: 'property',\n\t\t\t\t\tindex: index,\n\t\t\t\t\tname: attrName?.slice(1)\n\t\t\t\t});\n\t\t\t\treturn html.slice(0, -(match?.[0].length ?? 0)) + `__prop-${index}__=\"\"`;\n\t\t\t},\n\t\t\t':': (index: number, html: string, attrName?: string, match?: RegExpExecArray | null) => {\n\t\t\t\t// Action directive binding\n\t\t\t\tparts.push({\n\t\t\t\t\ttype: 'action',\n\t\t\t\t\tindex: index,\n\t\t\t\t\tname: attrName?.slice(1)\n\t\t\t\t});\n\t\t\t\treturn html.slice(0, -(match?.[0].length ?? 0)) + `__action-${index}__=\"\"`;\n\t\t\t},\n\t\t\t'__': (index: number, html: string, _?: string) => {\n\t\t\t\t// Regular attribute\n\t\t\t\treturn html + createAttributeMarker(index);\n\t\t\t},\n\t\t\t'___': (index: number, html: string) => {\n\t\t\t\t// Text position\n\t\t\t\tparts.push({\n\t\t\t\t\ttype: 'node',\n\t\t\t\t\tindex: index\n\t\t\t\t});\n\t\t\t\treturn html + COMMENT_NODE_MARKER;\n\t\t\t}\n\t\t};\n\t}\n\n\tprivate prepareParts(clone: Node, cache: ITemplateCache): ITemplatePart[] {\n\t\tconst parts: ITemplatePart[] = [];\n\t\tconst { partPaths } = cache;\n\n\t\t// Navigate directly to each part using pre-computed paths\n\t\tfor (const partPath of partPaths) {\n\t\t\t// Navigate to the node using the path\n\t\t\tlet node: Node = clone;\n\t\t\tfor (const index of partPath.path) {\n\t\t\t\tnode = node.childNodes[index];\n\t\t\t}\n\n\t\t\tif (partPath.type === 'node') {\n\t\t\t\t// Replace comment marker with text node\n\t\t\t\tconst textNode = document.createTextNode('');\n\t\t\t\tnode.parentNode!.replaceChild(textNode, node);\n\n\t\t\t\tparts.push({\n\t\t\t\t\ttype: 'node',\n\t\t\t\t\tindex: partPath.index,\n\t\t\t\t\tnode: textNode\n\t\t\t\t});\n\t\t\t} else if (partPath.type === 'event') {\n\t\t\t\tconst element = node as Element;\n\t\t\t\telement.removeAttribute(`__event-${partPath.index}__`);\n\n\t\t\t\tparts.push({\n\t\t\t\t\ttype: 'event',\n\t\t\t\t\tindex: partPath.index,\n\t\t\t\t\tname: partPath.name,\n\t\t\t\t\tnode: element\n\t\t\t\t});\n\t\t\t} else if (partPath.type === 'property') {\n\t\t\t\tconst element = node as Element;\n\t\t\t\telement.removeAttribute(`__prop-${partPath.index}__`);\n\n\t\t\t\tparts.push({\n\t\t\t\t\ttype: 'property',\n\t\t\t\t\tindex: partPath.index,\n\t\t\t\t\tname: partPath.name,\n\t\t\t\t\tnode: element\n\t\t\t\t});\n\t\t\t} else if (partPath.type === 'action') {\n\t\t\t\tconst element = node as Element;\n\n\t\t\t\tif (partPath.index >= 0) {\n\t\t\t\t\telement.removeAttribute(`__action-${partPath.index}__`);\n\t\t\t\t} else {\n\t\t\t\t\t// Static action directive\n\t\t\t\t\telement.removeAttribute(`:${partPath.name}`);\n\t\t\t\t}\n\n\t\t\t\tparts.push({\n\t\t\t\t\ttype: 'action',\n\t\t\t\t\tindex: partPath.index,\n\t\t\t\t\tname: partPath.name,\n\t\t\t\t\tnode: element,\n\t\t\t\t\tstaticValue: partPath.staticValue\n\t\t\t\t});\n\t\t\t} else if (partPath.type === 'attribute') {\n\t\t\t\tconst element = node as Element;\n\t\t\t\telement.removeAttribute(partPath.name!);\n\n\t\t\t\tparts.push({\n\t\t\t\t\ttype: 'attribute',\n\t\t\t\t\tindex: partPath.index,\n\t\t\t\t\tname: partPath.name,\n\t\t\t\t\tnode: element,\n\t\t\t\t\tattributeStrings: partPath.attributeStrings,\n\t\t\t\t\tattributeIndices: partPath.attributeIndices\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn parts;\n\t}\n\n\tprivate parseAttributeValue(value: string): { strings: string[]; indices: number[] } | null {\n\t\tconst strings: string[] = [];\n\t\tconst indices: number[] = [];\n\t\tlet lastIndex = 0;\n\t\tlet match: RegExpExecArray | null;\n\n\t\tATTRIBUTE_MARKER_REGEX.lastIndex = 0;\n\t\twhile ((match = ATTRIBUTE_MARKER_REGEX.exec(value)) !== null) {\n\t\t\tstrings.push(value.slice(lastIndex, match.index));\n\t\t\tindices.push(Number(match[1]));\n\t\t\tlastIndex = match.index + match[0].length;\n\t\t}\n\n\t\tif (indices.length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\tstrings.push(value.slice(lastIndex));\n\t\treturn { strings, indices };\n\t}\n\n\t/**\n\t * Sets up markers for a node part to enable complex content rendering\n\t */\n\tprivate ensureMarkers(part: ITemplatePart): void {\n\t\tif (part.startMarker) return; // Already set up\n\n\t\tconst parent = part.node!.parentNode;\n\t\tif (!parent) return;\n\n\t\tconst startMarker = document.createComment('part-start');\n\t\tconst endMarker = document.createComment('part-end');\n\n\t\tparent.insertBefore(startMarker, part.node!);\n\t\tparent.insertBefore(endMarker, part.node!.nextSibling);\n\n\t\tpart.startMarker = startMarker;\n\t\tpart.endMarker = endMarker;\n\t}\n\n\t/**\n\t * Clears previously rendered nodes between markers\n\t */\n\tprivate clearRenderedNodes(part: ITemplatePart): void {\n\t\tif (!part.renderedNodes || part.renderedNodes.length === 0) return;\n\n\t\tfor (const node of part.renderedNodes) {\n\t\t\tnode.parentNode?.removeChild(node);\n\t\t}\n\t\tpart.renderedNodes = [];\n\t\tpart.arrayState = undefined;\n\t}\n\n\tprivate cleanupParts(parts: ITemplatePart[]): void {\n\t\tfor (const part of parts) {\n\t\t\tif (part.actionCleanup) {\n\t\t\t\ttry {\n\t\t\t\t\tpart.actionCleanup();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('Action directive cleanup failed:', error);\n\t\t\t\t} finally {\n\t\t\t\t\tpart.actionCleanup = undefined;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (part.renderedNodes && part.renderedNodes.length > 0) {\n\t\t\t\tthis.clearRenderedNodes(part);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Renders a nested TemplateResult into a node part\n\t */\n\tprivate renderNestedTemplate(part: ITemplatePart, template: TemplateResult): void {\n\t\tthis.ensureMarkers(part);\n\t\tthis.clearRenderedNodes(part);\n\n\t\t// Hide the original text node\n\t\tpart.node!.textContent = '';\n\n\t\tconst fragment = document.createDocumentFragment();\n\t\ttemplate.renderInto(fragment);\n\n\t\tconst nodes = Array.from(fragment.childNodes);\n\t\tpart.renderedNodes = nodes;\n\n\t\tconst parent = part.endMarker!.parentNode!;\n\t\tparent.insertBefore(fragment, part.endMarker!);\n\t}\n\n\t/**\n\t * Renders a DOM Node into a node part\n\t */\n\tprivate renderNode(part: ITemplatePart, node: Node): void {\n\t\tthis.ensureMarkers(part);\n\t\tthis.clearRenderedNodes(part);\n\n\t\t// Hide the original text node\n\t\tpart.node!.textContent = '';\n\n\t\tpart.renderedNodes = [node];\n\n\t\tconst parent = part.endMarker!.parentNode!;\n\t\tparent.insertBefore(node, part.endMarker!);\n\t}\n\n\t/**\n\t * Renders an array of values into a node part\n\t */\n\tprivate renderArray(part: ITemplatePart, values: unknown[]): void {\n\t\tthis.ensureMarkers(part);\n\n\t\t// Hide the original text node\n\t\tpart.node!.textContent = '';\n\n\t\tconst parent = part.endMarker!.parentNode!;\n\t\tconst keyedValues = this.getKeyedValues(values);\n\n\t\tif (keyedValues) {\n\t\t\tconst state = part.arrayState ?? {\n\t\t\t\titems: new Map<unknown, { key: unknown; value: unknown; container: DocumentFragment; nodes: Node[] }>(),\n\t\t\t\tkeys: []\n\t\t\t};\n\n\t\t\tconst newItems = new Map<unknown, { key: unknown; value: unknown; container: DocumentFragment; nodes: Node[] }>();\n\t\t\tconst newKeys: unknown[] = [];\n\n\t\t\tfor (const item of keyedValues) {\n\t\t\t\tconst existing = state.items.get(item.key);\n\t\t\t\tif (existing) {\n\t\t\t\t\tthis.updateArrayItem(existing, item.value, parent, part.endMarker!);\n\t\t\t\t\tnewItems.set(item.key, existing);\n\t\t\t\t} else {\n\t\t\t\t\tconst created = this.createArrayItem(item.value, parent, part.endMarker!);\n\t\t\t\t\tnewItems.set(item.key, {\n\t\t\t\t\t\tkey: item.key,\n\t\t\t\t\t\tvalue: item.value,\n\t\t\t\t\t\tcontainer: created.container,\n\t\t\t\t\t\tnodes: created.nodes\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tnewKeys.push(item.key);\n\t\t\t}\n\n\t\t\tfor (const [key, oldItem] of state.items.entries()) {\n\t\t\t\tif (!newItems.has(key)) {\n\t\t\t\t\tfor (const node of oldItem.nodes) {\n\t\t\t\t\t\tnode.parentNode?.removeChild(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet referenceNode = part.startMarker!.nextSibling;\n\t\t\tfor (const key of newKeys) {\n\t\t\t\tconst item = newItems.get(key)!;\n\t\t\t\tfor (const node of item.nodes) {\n\t\t\t\t\tif (node === referenceNode) {\n\t\t\t\t\t\treferenceNode = referenceNode?.nextSibling ?? null;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tparent.insertBefore(node, referenceNode ?? part.endMarker!);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tpart.arrayState = {\n\t\t\t\titems: newItems,\n\t\t\t\tkeys: newKeys\n\t\t\t};\n\t\t\tpart.renderedNodes = newKeys.flatMap((key) => newItems.get(key)!.nodes);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.clearRenderedNodes(part);\n\t\tconst renderedNodes: Node[] = [];\n\n\t\tfor (const value of values) {\n\t\t\tif (value instanceof TemplateResult) {\n\t\t\t\tconst fragment = document.createDocumentFragment();\n\t\t\t\tvalue.renderInto(fragment);\n\t\t\t\tconst nodes = Array.from(fragment.childNodes);\n\t\t\t\trenderedNodes.push(...nodes);\n\t\t\t\tparent.insertBefore(fragment, part.endMarker!);\n\t\t\t} else if (value instanceof Node) {\n\t\t\t\trenderedNodes.push(value);\n\t\t\t\tparent.insertBefore(value, part.endMarker!);\n\t\t\t} else if (value !== null && value !== undefined) {\n\t\t\t\tconst textNode = document.createTextNode(String(value));\n\t\t\t\trenderedNodes.push(textNode);\n\t\t\t\tparent.insertBefore(textNode, part.endMarker!);\n\t\t\t}\n\t\t}\n\n\t\tpart.renderedNodes = renderedNodes;\n\t}\n\n\tprivate getKeyedValues(values: unknown[]): Array<{ key: unknown; value: unknown }> | null {\n\t\tif (values.length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst keyedValues: Array<{ key: unknown; value: unknown }> = [];\n\t\tfor (const value of values) {\n\t\t\tif (value && typeof value === 'object' && (value as { __keyed?: boolean }).__keyed === true) {\n\t\t\t\tconst keyed = value as { key: unknown; value: unknown };\n\t\t\t\tkeyedValues.push({ key: keyed.key, value: keyed.value });\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\treturn keyedValues;\n\t}\n\n\tprivate createArrayItem(value: unknown, parent: Node, endMarker: Comment): { container: DocumentFragment; nodes: Node[] } {\n\t\tconst container = document.createDocumentFragment();\n\t\tif (value instanceof TemplateResult) {\n\t\t\tvalue.renderInto(container);\n\t\t} else if (value instanceof Node) {\n\t\t\tcontainer.appendChild(value);\n\t\t} else if (value !== null && value !== undefined) {\n\t\t\tcontainer.appendChild(document.createTextNode(String(value)));\n\t\t}\n\n\t\tconst nodes = Array.from(container.childNodes);\n\t\tparent.insertBefore(container, endMarker);\n\t\treturn { container, nodes };\n\t}\n\n\tprivate updateArrayItem(\n\t\titem: { key: unknown; value: unknown; container: DocumentFragment; nodes: Node[] },\n\t\tvalue: unknown,\n\t\tparent: Node,\n\t\tendMarker: Comment\n\t): void {\n\t\tif (value instanceof TemplateResult) {\n\t\t\tvalue.renderInto(item.container);\n\t\t\titem.value = value;\n\t\t\titem.nodes = Array.from(item.container.childNodes);\n\t\t\treturn;\n\t\t}\n\n\t\tif (value === item.value) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const node of item.nodes) {\n\t\t\tnode.parentNode?.removeChild(node);\n\t\t}\n\n\t\titem.container = document.createDocumentFragment();\n\t\tif (value instanceof Node) {\n\t\t\titem.container.appendChild(value);\n\t\t} else if (value !== null && value !== undefined) {\n\t\t\titem.container.appendChild(document.createTextNode(String(value)));\n\t\t}\n\n\t\titem.nodes = Array.from(item.container.childNodes);\n\t\tparent.insertBefore(item.container, endMarker);\n\t\titem.value = value;\n\t}\n\n\tprivate commit(parts: ITemplatePart[]): void {\n\t\tfor (const part of parts) {\n\t\t\tconst value = this.values[part.index];\n\t\t\tconst isCompositeAttribute = part.type === 'attribute' && part.attributeIndices && part.attributeStrings;\n\n\t\t\t// Skip unchanged values (but not for directives or action parts - they manage their own state)\n\t\t\t// Action parts with index < 0 are static and have their own skip logic\n\t\t\tif (!isCompositeAttribute && !isDirective(value) && part.type !== 'action' && part.previousValue === value) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (part.type) {\n\t\t\t\tcase 'node':\n\t\t\t\t\tif (part.node) {\n\t\t\t\t\t\t// Handle directives\n\t\t\t\t\t\tif (isDirective(value)) {\n\t\t\t\t\t\t\tpart.directiveState = value.render(part.node, part.directiveState);\n\t\t\t\t\t\t} else if (value instanceof TemplateResult) {\n\t\t\t\t\t\t\t// Handle nested TemplateResult\n\t\t\t\t\t\t\tthis.renderNestedTemplate(part, value);\n\t\t\t\t\t\t} else if (value instanceof Node) {\n\t\t\t\t\t\t\t// Handle DOM Node\n\t\t\t\t\t\t\tthis.renderNode(part, value);\n\t\t\t\t\t\t} else if (Array.isArray(value)) {\n\t\t\t\t\t\t\t// Handle arrays of values\n\t\t\t\t\t\t\tthis.renderArray(part, value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Clear any previously rendered complex content\n\t\t\t\t\t\t\tthis.clearRenderedNodes(part);\n\t\t\t\t\t\t\tpart.node.textContent = String(value ?? '');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'attribute':\n\t\t\t\t\tif (part.node && part.name) {\n\t\t\t\t\t\tconst element = part.node as Element;\n\t\t\t\t\t\t// Handle directives\n\t\t\t\t\t\tif (isDirective(value)) {\n\t\t\t\t\t\t\tpart.directiveState = value.render(element, part.directiveState);\n\t\t\t\t\t\t} else if (isCompositeAttribute) {\n\t\t\t\t\t\t\tconst strings = part.attributeStrings as string[];\n\t\t\t\t\t\t\tconst indices = part.attributeIndices as number[];\n\t\t\t\t\t\t\tlet composed = strings[0] ?? '';\n\n\t\t\t\t\t\t\tfor (let i = 0; i < indices.length; i++) {\n\t\t\t\t\t\t\t\tconst segmentValue = this.values[indices[i]];\n\t\t\t\t\t\t\t\tcomposed += `${segmentValue ?? ''}${strings[i + 1] ?? ''}`;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (part.previousValue === composed) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (composed === '' && strings.every((segment) => segment === '')) {\n\t\t\t\t\t\t\t\telement.removeAttribute(part.name);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\telement.setAttribute(part.name, composed);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tpart.previousValue = composed;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t} else if (value === null || value === undefined || value === false) {\n\t\t\t\t\t\t\t// Remove attribute for null, undefined, or false (boolean attributes)\n\t\t\t\t\t\t\telement.removeAttribute(part.name);\n\t\t\t\t\t\t} else if (value === true) {\n\t\t\t\t\t\t\t// Boolean true sets empty attribute (e.g., disabled=\"\")\n\t\t\t\t\t\t\telement.setAttribute(part.name, '');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telement.setAttribute(part.name, String(value));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'property':\n\t\t\t\t\tif (part.node && part.name) {\n\t\t\t\t\t\t// Handle directives\n\t\t\t\t\t\tif (isDirective(value)) {\n\t\t\t\t\t\t\tpart.directiveState = value.render(part.node as Element, part.directiveState);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t(part.node as any)[part.name] = value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'event':\n\t\t\t\t\tif (part.node && part.name) {\n\t\t\t\t\t\tconst element = part.node as Element;\n\n\t\t\t\t\t\tif (part.previousValue === value) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Remove old listener\n\t\t\t\t\t\tif (part.previousValue && typeof part.previousValue === 'function') {\n\t\t\t\t\t\t\telement.removeEventListener(part.name, part.previousValue as EventListener);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Add new listener\n\t\t\t\t\t\tif (typeof value === 'function') {\n\t\t\t\t\t\t\telement.addEventListener(part.name, value as EventListener);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'action':\n\t\t\t\t\tif (part.node && part.name) {\n\t\t\t\t\t\tconst element = part.node as Element;\n\n\t\t\t\t\t\t// Get directive value: dynamic (from values array) or static (from attribute)\n\t\t\t\t\t\tconst directiveValue = part.index >= 0 ? value : part.staticValue;\n\n\t\t\t\t\t\t// Skip if value hasn't changed (for dynamic values)\n\t\t\t\t\t\tif (part.index >= 0 && part.previousValue === directiveValue) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// For static directives, only run once (when actionCleanup is undefined)\n\t\t\t\t\t\tif (part.index < 0 && part.actionCleanup !== undefined) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Call previous cleanup if exists\n\t\t\t\t\t\tif (part.actionCleanup) {\n\t\t\t\t\t\t\tpart.actionCleanup();\n\t\t\t\t\t\t\tpart.actionCleanup = undefined;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Look up directive from registry\n\t\t\t\t\t\tconst directive = getAttributeDirective(part.name);\n\t\t\t\t\t\tif (directive) {\n\t\t\t\t\t\t\tconst cleanup = directive(element, directiveValue, part.name);\n\t\t\t\t\t\t\tif (typeof cleanup === 'function') {\n\t\t\t\t\t\t\t\tpart.actionCleanup = cleanup;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Mark as initialized even without cleanup\n\t\t\t\t\t\t\t\tpart.actionCleanup = () => {};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.warn(`Attribute directive ':${part.name}' not found in registry`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tpart.previousValue = value;\n\t\t}\n\t}\n}\n","import { TemplateResult } from '../classes/template-result.class';\n\nexport function html(strings: TemplateStringsArray, ...values: unknown[]): TemplateResult {\n\treturn new TemplateResult(strings, values);\n}\n\nexport const css = html;\n","import { MelodicComponent } from '../../../components/decorators/melodic-component.decorator';\nimport { Service } from '../../../injection/decorators/service.decorator';\nimport { RouterService } from '../../services/router.service';\nimport type { IRoute } from '../../interfaces/iroute.interface';\nimport type { IRouteContext } from '../../interfaces/iroute-context.interface';\nimport { html } from '../../../template/functions/html.function';\nimport { matchRouteTree } from '../../functions/match-route-tree.function';\nimport type { IRouteMatch } from '../../interfaces/iroute-match.interface';\nimport type { IRouteMatchResult } from '../../interfaces/iroute-match-result.interface';\n\n/**\n * Custom event for child outlets to request their context from parent.\n */\nconst OUTLET_REGISTER_EVENT = 'melodic:outlet-register';\n\n/**\n * Data passed when an outlet registers with its parent.\n */\ninterface IOutletRegistration {\n\toutlet: RouterOutletComponent;\n\tcallback: (context: IRouteContext) => void;\n}\n\n@MelodicComponent({\n\tselector: 'router-outlet',\n\ttemplate: () => html`<slot></slot>`\n})\nexport class RouterOutletComponent {\n\t@Service(RouterService) private _router!: RouterService;\n\n\tprivate _depth: number = 0;\n\tprivate _context: IRouteContext | null = null;\n\tprivate _currentComponent: string | null = null;\n\tprivate _currentElement: HTMLElement | null = null;\n\tprivate _childOutlets: Map<string, RouterOutletComponent> = new Map();\n\tprivate _parentOutlet: RouterOutletComponent | null = null;\n\tprivate _initialized = false;\n\tprivate _navigationCleanup: (() => void) | null = null;\n\n\tpublic routes: IRoute[] = [];\n\tpublic name: string = 'primary';\n\tpublic elementRef!: HTMLElement;\n\n\tonInit(): void {\n\t\tconst handler = () => this.onNavigate();\n\t\twindow.addEventListener('NavigationEvent', handler);\n\t\tthis._navigationCleanup = () => window.removeEventListener('NavigationEvent', handler);\n\n\t\tthis.elementRef.addEventListener(OUTLET_REGISTER_EVENT, ((event: CustomEvent<IOutletRegistration>) => {\n\t\t\tif (event.detail.outlet === this) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tevent.stopPropagation();\n\t\t\tthis.registerChildOutlet(event.detail);\n\t\t}) as EventListener);\n\t}\n\n\tonCreate(): void {\n\t\tthis.findParentOutlet();\n\n\t\t// Defer initial render to allow property binding to complete\n\t\tqueueMicrotask(() => {\n\t\t\tthis._initialized = true;\n\n\t\t\t// If root outlet, register routes with router\n\t\t\tif (this._depth === 0 && this.routes.length > 0) {\n\t\t\t\tthis._router.setRoutes(this.routes);\n\t\t\t}\n\n\t\t\t// Register with parent if nested\n\t\t\tif (this._parentOutlet) {\n\t\t\t\tthis.requestContextFromParent();\n\t\t\t} else {\n\t\t\t\t// Root outlet - initiate routing\n\t\t\t\tthis.onNavigate();\n\t\t\t}\n\t\t});\n\t}\n\n\tonDestroy(): void {\n\t\tthis._navigationCleanup?.();\n\n\t\tif (this._parentOutlet) {\n\t\t\tthis._parentOutlet.unregisterChildOutlet(this.name);\n\t\t}\n\t}\n\n\tonPropertyChange(name: string): void {\n\t\tif (name === 'routes' && this._initialized) {\n\t\t\t// Routes changed - update router if root and re-render\n\t\t\tif (this._depth === 0) {\n\t\t\t\tthis._router.setRoutes(this.routes);\n\t\t\t}\n\t\t\tthis._currentComponent = null;\n\t\t\tthis.onNavigate();\n\t\t}\n\t}\n\n\tgetDepth(): number {\n\t\treturn this._depth;\n\t}\n\n\tgetContext(): IRouteContext | null {\n\t\treturn this._context;\n\t}\n\n\tprivate findParentOutlet(): void {\n\t\tlet element: Element | null = this.elementRef;\n\n\t\twhile (element) {\n\t\t\t// Check shadow DOM host\n\t\t\tconst root = element.getRootNode() as ShadowRoot;\n\t\t\tif (root instanceof ShadowRoot) {\n\t\t\t\telement = root.host;\n\n\t\t\t\t// Check if host contains a router-outlet (the parent)\n\t\t\t\tif (element.tagName.toLowerCase() !== 'router-outlet') {\n\t\t\t\t\tconst parentOutlet = element.shadowRoot?.querySelector('router-outlet');\n\t\t\t\t\tif (parentOutlet && parentOutlet !== this.elementRef) {\n\t\t\t\t\t\tthis._parentOutlet = (parentOutlet as any).component as RouterOutletComponent;\n\t\t\t\t\t\tthis._depth = (this._parentOutlet?._depth ?? -1) + 1;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Regular DOM - look for parent outlet\n\t\t\t\tconst parentOutlet = element.closest?.('router-outlet');\n\t\t\t\tif (parentOutlet && parentOutlet !== this.elementRef) {\n\t\t\t\t\tthis._parentOutlet = (parentOutlet as any).component as RouterOutletComponent;\n\t\t\t\t\tthis._depth = (this._parentOutlet?._depth ?? -1) + 1;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// No parent found - this is root\n\t\tthis._depth = 0;\n\t}\n\n\t/**\n\t * Request context from parent outlet.\n\t */\n\tprivate requestContextFromParent(): void {\n\t\tconst event = new CustomEvent<IOutletRegistration>(OUTLET_REGISTER_EVENT, {\n\t\t\tbubbles: true,\n\t\t\tcomposed: true,\n\t\t\tdetail: {\n\t\t\t\toutlet: this,\n\t\t\t\tcallback: (context: IRouteContext) => this.receiveContext(context)\n\t\t\t}\n\t\t});\n\n\t\tthis.elementRef.dispatchEvent(event);\n\t}\n\n\t/**\n\t * Register a child outlet.\n\t */\n\tprivate registerChildOutlet(registration: IOutletRegistration): void {\n\t\tthis._childOutlets.set(registration.outlet.name, registration.outlet);\n\n\t\t// Provide context to child if we have it\n\t\tif (this._context?.currentMatch?.children) {\n\t\t\tconst childContext = this.createChildContext();\n\t\t\tif (childContext) {\n\t\t\t\tregistration.callback(childContext);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate unregisterChildOutlet(name: string): void {\n\t\tthis._childOutlets.delete(name);\n\t}\n\n\tprivate receiveContext(context: IRouteContext): void {\n\t\tthis._context = context;\n\t\tthis.routes = context.routes;\n\t\tthis.renderFromContext();\n\t}\n\n\tprivate createChildContext(): IRouteContext | null {\n\t\tif (!this._context?.currentMatch) return null;\n\n\t\tconst match = this._context.currentMatch;\n\n\t\treturn {\n\t\t\tdepth: this._depth + 1,\n\t\t\troutes: match.children ?? [],\n\t\t\tcurrentMatch: undefined, // Will be set when child matches\n\t\t\tancestorMatches: [...this._context.ancestorMatches],\n\t\t\tparams: { ...this._context.params },\n\t\t\tremainingPath: match.remainingPath,\n\t\t\tbasePath: match.fullPath,\n\t\t\tparent: this._context\n\t\t};\n\t}\n\n\tprivate onNavigate(): void {\n\t\tif (!this._initialized) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._depth === 0) {\n\t\t\t// Root outlet - perform full route matching\n\t\t\tthis.matchAndRender(window.location.pathname);\n\t\t}\n\n\t\t// Nested outlets wait for context from parent\n\t}\n\n\t/**\n\t * Match the current path and render (root outlet only).\n\t */\n\tprivate async matchAndRender(fullPath: string): Promise<void> {\n\t\tconst routes = this.routes.length > 0 ? this.routes : this._router.getRoutes();\n\n\t\tif (routes.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst matchResult = matchRouteTree(routes, fullPath);\n\n\t\tif (matchResult.redirectTo) {\n\t\t\tif (window.location.pathname !== matchResult.redirectTo) {\n\t\t\t\tthis._router.navigate(matchResult.redirectTo, { replace: true });\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Run resolvers before rendering (for initial page load)\n\t\tif (matchResult.matches.length > 0) {\n\t\t\tconst resolverResult = await this._router.runResolvers(matchResult);\n\t\t\tif (!resolverResult.success) {\n\t\t\t\tconsole.error('Resolver failed:', resolverResult.error);\n\t\t\t\tawait this.render404();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis._router.setCurrentMatches(matchResult);\n\n\t\tif (matchResult.matches.length > 0) {\n\t\t\tconst match = matchResult.matches[0];\n\n\t\t\tthis._context = {\n\t\t\t\tdepth: 0,\n\t\t\t\troutes: routes,\n\t\t\t\tcurrentMatch: match,\n\t\t\t\tancestorMatches: [match],\n\t\t\t\tparams: match.params,\n\t\t\t\tremainingPath: match.remainingPath,\n\t\t\t\tbasePath: '',\n\t\t\t\tparent: undefined\n\t\t\t};\n\n\t\t\tawait this.renderMatch(match, matchResult);\n\t\t} else {\n\t\t\tawait this.render404();\n\t\t}\n\t}\n\n\tprivate async renderFromContext(): Promise<void> {\n\t\tif (!this._context || this.routes.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst remainingPath = this._context.remainingPath;\n\n\t\tconst matchResult = matchRouteTree(this.routes, remainingPath, this._context.basePath);\n\n\t\tif (matchResult.redirectTo) {\n\t\t\tconst fullRedirect = this._context.basePath ? `/${this._context.basePath}/${matchResult.redirectTo}`.replace(/\\/+/g, '/') : matchResult.redirectTo;\n\n\t\t\tif (window.location.pathname !== fullRedirect) {\n\t\t\t\tthis._router.navigate(fullRedirect, { replace: true });\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (matchResult.matches.length > 0) {\n\t\t\tconst match = matchResult.matches[0];\n\n\t\t\tthis._context = {\n\t\t\t\t...this._context,\n\t\t\t\tcurrentMatch: match,\n\t\t\t\tancestorMatches: [...this._context.ancestorMatches, match],\n\t\t\t\tparams: { ...this._context.params, ...match.params }\n\t\t\t};\n\n\t\t\tawait this.renderMatch(match, matchResult);\n\t\t} else {\n\t\t\tawait this.render404();\n\t\t}\n\t}\n\n\tprivate async renderMatch(match: IRouteMatch, _: IRouteMatchResult): Promise<void> {\n\t\tconst route = match.route;\n\n\t\tif (route.component === this._currentComponent) {\n\t\t\tthis.updateChildOutlets();\n\t\t\treturn;\n\t\t}\n\n\t\tif (route.loadChildren && !match.children) {\n\t\t\ttry {\n\t\t\t\tconst module = await route.loadChildren();\n\t\t\t\tmatch.children = module.routes;\n\t\t\t\troute.children = module.routes;\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Failed to load child routes:', error);\n\t\t\t\tawait this.render404();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (route.loadComponent) {\n\t\t\ttry {\n\t\t\t\tawait route.loadComponent();\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Failed to load component:', error);\n\t\t\t\tawait this.render404();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (route.component) {\n\t\t\tawait this.renderComponent(route.component);\n\t\t}\n\t}\n\n\tprivate async renderComponent(componentTag: string): Promise<void> {\n\t\tconst shadowRoot = this.elementRef.shadowRoot;\n\n\t\tif (!shadowRoot) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._currentElement) {\n\t\t\tthis._currentElement.remove();\n\t\t\tthis._currentElement = null;\n\t\t}\n\n\t\tthis._currentComponent = componentTag;\n\n\t\tconst component = document.createElement(componentTag);\n\n\t\t(component as any).__parentOutlet = this;\n\n\t\tshadowRoot.appendChild(component);\n\t\tthis._currentElement = component;\n\n\t\tqueueMicrotask(() => this.updateChildOutlets());\n\t}\n\n\tprivate updateChildOutlets(): void {\n\t\tconst childContext = this.createChildContext();\n\n\t\tif (!childContext) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const [, childOutlet] of this._childOutlets) {\n\t\t\tchildOutlet.receiveContext(childContext);\n\t\t}\n\t}\n\n\tprivate async render404(): Promise<void> {\n\t\tconst notFoundRoute = this.routes.find((r) => r.path === '404' || r.path === '**');\n\n\t\tif (notFoundRoute?.component) {\n\t\t\tawait this.renderComponent(notFoundRoute.component);\n\t\t} else if (this._depth === 0) {\n\t\t\tthis._router.navigate('/404', { replace: true });\n\t\t}\n\t}\n}\n","import { MelodicComponent } from '../../../components/decorators/melodic-component.decorator';\nimport { Service } from '../../../injection/decorators/service.decorator';\nimport { css, html } from '../../../template/functions/html.function';\nimport type { INavigationOptions } from '../../interfaces/inavigation-options.interface';\nimport { RouterService } from '../../services/router.service';\n\n@MelodicComponent({\n\tselector: 'router-link',\n\ttemplate: () => html`<a part=\"link\"><slot></slot></a>`,\n\tstyles: () => css`\n\t\t:host {\n\t\t\tdisplay: inline-block;\n\t\t\tcursor: pointer;\n\t\t}\n\t\ta {\n\t\t\tcolor: inherit;\n\t\t\ttext-decoration: inherit;\n\t\t\tfont: inherit;\n\t\t\tdisplay: block;\n\t\t}\n\t`,\n\tattributes: ['href', 'active-class']\n})\nexport class RouterLinkComponent {\n\t@Service(RouterService) private _router!: RouterService;\n\n\tprivate _anchorElement: HTMLAnchorElement | null = null;\n\tprivate _navigationCleanup: (() => void) | null = null;\n\n\tpublic href: string = '';\n\tpublic data: unknown = null;\n\tpublic queryParams: Record<string, string> = {};\n\tpublic activeClass: string = 'active';\n\tpublic exactMatch: boolean = false;\n\tpublic replace: boolean = false;\n\tpublic elementRef!: HTMLElement;\n\n\tonCreate(): void {\n\t\tthis._anchorElement = this.elementRef.shadowRoot?.querySelector('a') ?? null;\n\n\t\tconst initialHref = this.elementRef.getAttribute('href');\n\t\tif (initialHref) {\n\t\t\tthis.href = initialHref;\n\t\t}\n\n\t\tconst initialActiveClass = this.elementRef.getAttribute('active-class');\n\t\tif (initialActiveClass) {\n\t\t\tthis.activeClass = initialActiveClass;\n\t\t}\n\n\t\tthis.updateAnchorHref();\n\n\t\tthis.elementRef.addEventListener(\n\t\t\t'click',\n\t\t\t(e: MouseEvent) => {\n\t\t\t\te.preventDefault();\n\n\t\t\t\t// Don't navigate if modifier keys are pressed (allow new tab, etc.)\n\t\t\t\tif (e.ctrlKey || e.metaKey || e.shiftKey) {\n\t\t\t\t\twindow.open(this.buildFullPath(), '_blank');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.navigate();\n\t\t\t},\n\t\t\tfalse\n\t\t);\n\n\t\tconst handler = () => this.updateActiveState();\n\t\twindow.addEventListener('NavigationEvent', handler);\n\t\tthis._navigationCleanup = () => window.removeEventListener('NavigationEvent', handler);\n\n\t\tthis.updateActiveState();\n\t}\n\n\tonDestroy(): void {\n\t\tthis._navigationCleanup?.();\n\t}\n\n\tonAttributeChange(attribute: string, _: unknown, newVal: unknown): void {\n\t\tif (attribute === 'href') {\n\t\t\tthis.href = newVal as string;\n\t\t\tthis.updateAnchorHref();\n\t\t\tthis.updateActiveState();\n\t\t} else if (attribute === 'active-class') {\n\t\t\tthis.activeClass = newVal as string;\n\t\t\tthis.updateActiveState();\n\t\t}\n\t}\n\n\tonPropertyChange(name: string): void {\n\t\tif (name === 'href' || name === 'queryParams') {\n\t\t\tthis.updateAnchorHref();\n\t\t\tthis.updateActiveState();\n\t\t}\n\t}\n\n\tisActive(): boolean {\n\t\tconst currentPath = window.location.pathname;\n\t\tconst linkPath = this.href.startsWith('/') ? this.href : `/${this.href}`;\n\n\t\tif (this.exactMatch) {\n\t\t\treturn currentPath === linkPath;\n\t\t}\n\n\t\treturn currentPath.startsWith(linkPath);\n\t}\n\n\tprivate buildFullPath(): string {\n\t\tlet path = this.href;\n\n\t\tif (this.queryParams && Object.keys(this.queryParams).length > 0) {\n\t\t\tconst params = new URLSearchParams(this.queryParams);\n\t\t\tpath = `${path}?${params.toString()}`;\n\t\t}\n\n\t\treturn path;\n\t}\n\n\tprivate updateAnchorHref(): void {\n\t\tif (this._anchorElement) {\n\t\t\tthis._anchorElement.href = this.buildFullPath();\n\t\t}\n\t}\n\n\tprivate async navigate(): Promise<void> {\n\t\tconst options: INavigationOptions = {\n\t\t\tdata: this.data,\n\t\t\treplace: this.replace,\n\t\t\tqueryParams: this.queryParams\n\t\t};\n\n\t\tawait this._router.navigate(this.href, options);\n\t}\n\n\tprivate updateActiveState(): void {\n\t\tconst currentPath = window.location.pathname;\n\t\tconst linkPath = this.href.startsWith('/') ? this.href : `/${this.href}`;\n\t\tconst normalizedCurrentPath = currentPath.replace(/\\/$/, '') || '/';\n\t\tconst normalizedLinkPath = linkPath.replace(/\\/$/, '') || '/';\n\n\t\tlet isActive: boolean;\n\n\t\tif (this.exactMatch) {\n\t\t\tisActive = normalizedCurrentPath === normalizedLinkPath;\n\t\t} else {\n\t\t\tisActive = normalizedCurrentPath === normalizedLinkPath || normalizedCurrentPath.startsWith(normalizedLinkPath + '/');\n\t\t}\n\n\t\tif (isActive) {\n\t\t\tthis.elementRef.classList.add(this.activeClass);\n\t\t\tthis._anchorElement?.setAttribute('aria-current', 'page');\n\t\t} else {\n\t\t\tthis.elementRef.classList.remove(this.activeClass);\n\t\t\tthis._anchorElement?.removeAttribute('aria-current');\n\t\t}\n\t}\n}\n","import { Injector } from '../../injection';\nimport { registerAttributeDirective } from '../../template/directives/functions/attribute-directive.functions';\nimport type { AttributeDirectiveCleanupFunction } from '../../template/directives/types/attribute-directive-cleanup-function.type';\nimport { RouterService } from '../services/router.service';\nimport type { INavigationOptions } from '../interfaces/inavigation-options.interface';\n\n/**\n * Options for the routerLink directive when using object syntax.\n */\nexport interface IRouterLinkOptions {\n\t/** Target path for navigation */\n\thref: string;\n\n\t/** CSS class to apply when this link is active (default: 'active') */\n\tactiveClass?: string;\n\n\t/** Whether to match exact path or prefix (default: false) */\n\texactMatch?: boolean;\n\n\t/** Whether to replace history instead of push (default: false) */\n\treplace?: boolean;\n\n\t/** Custom data to pass with navigation */\n\tdata?: unknown;\n\n\t/** Query parameters to append */\n\tqueryParams?: Record<string, string>;\n}\n\n/**\n * Router link attribute directive.\n *\n * Usage:\n * ```html\n * <!-- Static string value -->\n * <a :routerLink=\"/home\">Home</a>\n * <button :routerLink=\"/admin\">Admin</button>\n *\n * <!-- Dynamic string value -->\n * <a :routerLink=${currentPath}>Dynamic</a>\n *\n * <!-- Object with options -->\n * <a :routerLink=${{ href: '/about', exactMatch: true }}>About</a>\n * ```\n *\n * The directive:\n * - Sets href attribute on anchor elements (for accessibility)\n * - Handles click events with preventDefault and navigation\n * - Supports modifier keys (ctrl/cmd opens in new tab)\n * - Manages active class based on current route\n * - Listens for navigation events to update active state\n */\nfunction routerLinkDirective(element: Element, value: unknown, _: string): (() => void) | void {\n\t// Parse value - can be string or options object\n\tlet options: IRouterLinkOptions;\n\n\tif (typeof value === 'string') {\n\t\toptions = { href: value };\n\t} else if (value && typeof value === 'object' && 'href' in value) {\n\t\toptions = value as IRouterLinkOptions;\n\t} else {\n\t\tconsole.warn('routerLink: Invalid value. Expected string or { href: string, ... }');\n\t\treturn;\n\t}\n\n\tconst { href, activeClass = 'active', exactMatch = false, replace = false, data = null, queryParams = {} } = options;\n\n\tconst router = Injector.get<RouterService>(RouterService);\n\n\t// Build full path with query params\n\tconst buildFullPath = (): string => {\n\t\tlet path = href;\n\t\tif (queryParams && Object.keys(queryParams).length > 0) {\n\t\t\tconst params = new URLSearchParams(queryParams);\n\t\t\tpath = `${path}?${params.toString()}`;\n\t\t}\n\t\treturn path;\n\t};\n\n\t// Set href on anchor elements for accessibility\n\tif (element.tagName.toLowerCase() === 'a') {\n\t\t(element as HTMLAnchorElement).href = buildFullPath();\n\t}\n\n\t// Update active state\n\tconst updateActiveState = (): void => {\n\t\tconst currentPath = window.location.pathname;\n\t\tconst linkPath = href.startsWith('/') ? href : `/${href}`;\n\t\tconst normalizedCurrentPath = currentPath.replace(/\\/$/, '') || '/';\n\t\tconst normalizedLinkPath = linkPath.replace(/\\/$/, '') || '/';\n\n\t\tlet isActive: boolean;\n\n\t\tif (exactMatch) {\n\t\t\tisActive = normalizedCurrentPath === normalizedLinkPath;\n\t\t} else {\n\t\t\tisActive = normalizedCurrentPath === normalizedLinkPath || normalizedCurrentPath.startsWith(normalizedLinkPath + '/');\n\t\t}\n\n\t\tif (isActive) {\n\t\t\telement.classList.add(activeClass);\n\t\t\tif (element.tagName.toLowerCase() === 'a') {\n\t\t\t\telement.setAttribute('aria-current', 'page');\n\t\t\t}\n\t\t} else {\n\t\t\telement.classList.remove(activeClass);\n\t\t\telement.removeAttribute('aria-current');\n\t\t}\n\n\t\telement.setAttribute('router-link', '');\n\t};\n\n\t// Click handler\n\tconst handleClick = (e: Event): void => {\n\t\tconst mouseEvent = e as MouseEvent;\n\n\t\t// Don't navigate if modifier keys are pressed (allow new tab, etc.)\n\t\tif (mouseEvent.ctrlKey || mouseEvent.metaKey || mouseEvent.shiftKey) {\n\t\t\tif (element.tagName.toLowerCase() === 'a') {\n\t\t\t\t// Let the browser handle it naturally for anchors\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// For non-anchor elements, open in new tab\n\t\t\twindow.open(buildFullPath(), '_blank');\n\t\t\treturn;\n\t\t}\n\n\t\te.preventDefault();\n\n\t\tconst navOptions: INavigationOptions = {\n\t\t\tdata,\n\t\t\treplace,\n\t\t\tqueryParams\n\t\t};\n\n\t\trouter.navigate(href, navOptions);\n\t};\n\n\t// Navigation event handler\n\tconst handleNavigation = (): void => {\n\t\tupdateActiveState();\n\t};\n\n\t// Add event listeners\n\telement.addEventListener('click', handleClick);\n\twindow.addEventListener('NavigationEvent', handleNavigation);\n\n\t// Initial active state\n\tupdateActiveState();\n\n\t// Return cleanup function\n\treturn (() => {\n\t\telement.removeEventListener('click', handleClick);\n\t\twindow.removeEventListener('NavigationEvent', handleNavigation);\n\t}) as AttributeDirectiveCleanupFunction;\n}\n\n// Auto-register the directive\nregisterAttributeDirective('routerLink', routerLinkDirective);\n\n// Export for manual registration if needed\nexport { routerLinkDirective };\n","import type { SignalEffect } from '../classes/signal-effect.class';\n\nlet activeEffect: SignalEffect | null = null;\n\nexport const setActiveEffect = (effect: SignalEffect | null): void => {\n\tactiveEffect = effect;\n};\n\nexport const getActiveEffect = (): SignalEffect | null => activeEffect;\n","import type { Signal } from '../types/signal.type';\nimport { getActiveEffect, setActiveEffect } from '../functions/active-effect.functions';\n\nexport class SignalEffect {\n\tprivate _dependencies = new Set<Signal<unknown>>();\n\tprivate _isRunning = false;\n\tprivate _needsRerun = false;\n\n\treadonly run: () => void;\n\n\tconstructor(public execute: () => void) {\n\t\tthis.run = () => {\n\t\t\tif (this._isRunning) {\n\t\t\t\tthis._needsRerun = true;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._isRunning = true;\n\n\t\t\tdo {\n\t\t\t\tthis._needsRerun = false;\n\n\t\t\t\tthis._dependencies.forEach((signal) => {\n\t\t\t\t\tsignal.unsubscribe(this.run);\n\t\t\t\t});\n\n\t\t\t\tthis._dependencies.clear();\n\n\t\t\t\tconst prevEffect = getActiveEffect();\n\t\t\t\tsetActiveEffect(this);\n\n\t\t\t\tthis.execute();\n\n\t\t\t\tsetActiveEffect(prevEffect);\n\t\t\t} while (this._needsRerun);\n\n\t\t\tthis._isRunning = false;\n\t\t};\n\t}\n\n\taddDependency<T>(signal: Signal<T>): void {\n\t\tthis._dependencies.add(signal);\n\t}\n\n\tdestroy(): void {\n\t\tthis._dependencies.forEach((signal) => {\n\t\t\tsignal.unsubscribe(this.run);\n\t\t});\n\n\t\tthis._dependencies.clear();\n\t}\n}\n","import { SIGNAL_MARKER, type Signal } from '../types/signal.type';\nimport type { Subscriber } from '../types/subscriber.type';\nimport { getActiveEffect } from './active-effect.functions';\n\nexport function signal<T>(initialValue: T): Signal<T>;\nexport function signal<T>(): Signal<T | undefined>;\nexport function signal<T>(initialValue?: T): Signal<T | undefined> {\n\tlet value = initialValue;\n\tconst subscribers = new Set<Subscriber<T | undefined>>();\n\n\tconst notify = (): void => {\n\t\tconst subscribersToNotify = [...subscribers];\n\t\tsubscribersToNotify.forEach((subscriber) => subscriber(value));\n\t};\n\n\tconst read = (() => {\n\t\tconst activeEffect = getActiveEffect();\n\t\tif (activeEffect) {\n\t\t\tactiveEffect.addDependency<T | undefined>(read);\n\t\t\tsubscribers.add(activeEffect.run);\n\t\t}\n\n\t\treturn value;\n\t}) as Signal<T | undefined>;\n\n\tread.set = (newValue: T | undefined): void => {\n\t\tif (value !== newValue) {\n\t\t\tvalue = newValue;\n\t\t\tnotify();\n\t\t}\n\t};\n\n\tread.update = (updater: (current: T | undefined) => T | undefined): void => {\n\t\tread.set(updater(value));\n\t};\n\n\tread.subscribe = (subscriber: Subscriber<T | undefined>): (() => void) => {\n\t\tsubscribers.add(subscriber);\n\t\treturn () => subscribers.delete(subscriber);\n\t};\n\n\tread.unsubscribe = (subscriber: Subscriber<T | undefined>): void => {\n\t\tsubscribers.delete(subscriber);\n\t};\n\n\tread.destroy = (): void => {\n\t\tsubscribers.clear();\n\t};\n\n\tObject.defineProperty(read, SIGNAL_MARKER, {\n\t\tvalue: true,\n\t\tenumerable: false,\n\t\tconfigurable: false\n\t});\n\n\treturn read;\n}\n","import { signal } from '../functions/signal.function';\nimport { SignalEffect } from '../classes/signal-effect.class';\nimport type { Signal } from '../types/signal.type';\n\nexport function computed<T>(computation: () => T): Signal<T> {\n\tconst computedSignal = signal<T>(undefined as T);\n\n\tconst effect = new SignalEffect(() => {\n\t\tcomputedSignal.set(computation());\n\t});\n\n\teffect.run();\n\n\tconst originalDestroy = computedSignal.destroy;\n\n\tcomputedSignal.destroy = () => {\n\t\teffect.destroy();\n\t\toriginalDestroy();\n\t};\n\n\treturn computedSignal;\n}\n","import type { ActionIdentifier, ActionIdentifierPattern, ActionPayload, TypedActionRef } from '../types/action.type';\n\nexport const props = <P extends ActionPayload>(): (() => P) => {\n\treturn () => ({} as P);\n};\n\nexport const createAction = <T extends ActionIdentifierPattern, P extends ActionPayload>(\n\ttype: ActionIdentifier<T>,\n\tpayloadFn?: () => P\n): TypedActionRef<T, P> => {\n\treturn ((payload?: P) => ({ type, payload: payload ?? (payloadFn ? payloadFn() : undefined) })) as TypedActionRef<T, P>;\n};\n","import type { ActionReducer, Action, ReducerConfig } from '../types';\n\n// Overload for flat state (component state)\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function createReducer<S>(...actionReducers: ActionReducer<S, any>[]): ReducerConfig<S, Action>;\n\n// Overload for sliced state (global state)\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function createReducer<S, K extends keyof S>(...actionReducers: ActionReducer<S[K], any>[]): ReducerConfig<S[K], Action>;\n\n// Implementation\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function createReducer<S, K extends keyof S = never>(...actionReducers: ActionReducer<S | S[K], any>[]): ReducerConfig<S | S[K], Action> {\n\treturn { reducers: actionReducers as ActionReducer<S | S[K], Action>[] };\n}\n","import { signal } from '../../signals';\nimport type { State } from '../types/state.type';\n\nexport const createState = <S>(initState: S): State<S> => {\n\tconst state: State<S> = {} as State<S>;\n\n\tObject.keys(initState as object).forEach((key) => {\n\t\tstate[key as keyof S] = signal(initState[key as keyof S]);\n\t});\n\n\treturn state;\n};\n","import type { ActionReducer, ActionPayload, TypedAction, TypedActionRef, ActionIdentifier } from '../types';\n\nexport const onAction = <S, T extends ActionIdentifier, P extends ActionPayload>(\n\taction: TypedActionRef<T, P>,\n\treducer: (state: S, action: TypedAction<T, P>) => S\n): ActionReducer<S, TypedAction<T, P>> => {\n\treturn {\n\t\taction: action() as TypedAction<T, P>,\n\t\treducer\n\t};\n};\n","import { createToken } from '../injection';\nimport type { ActionEffectsMap, ActionReducerMap, State } from './types';\n\nexport const RX_INIT_STATE = createToken<State<{ [key: string]: unknown }>>('RX_INIT_STATE');\nexport const RX_ACTION_PROVIDERS = createToken<ActionReducerMap<{ [key: string]: unknown }>>('RX_ACTION_PROVIDERS');\nexport const RX_EFFECTS_PROVIDERS = createToken<ActionEffectsMap<{ [key: string]: unknown }>>('RX_EFFECTS_PROVIDERS');\nexport const RX_STATE_DEBUG = createToken<boolean>('RX_STATE_DEBUG');\n","import type { ActionEffect, ActionEffects } from '../types/action-effect.type';\nimport type { Action, ActionIdentifier, ActionPayload, ActionRef, TypedAction, TypedActionRef } from '../types/action.type';\n\nexport abstract class EffectsBase implements ActionEffects {\n\tprivate readonly _effects: ActionEffect[] = [];\n\n\tprotected addEffect<T extends ActionIdentifier, P extends ActionPayload>(\n\t\tactions: TypedActionRef<T, P>[],\n\t\teffect: (action: TypedAction<T, P>) => Promise<Action | Action[] | void>\n\t): void {\n\t\tthis._effects.push({\n\t\t\tactions: actions as ActionRef[],\n\t\t\teffect: effect as (action: Action) => Promise<Action | Action[] | void>\n\t\t});\n\t}\n\n\tpublic getEffects(): ActionEffect[] {\n\t\treturn this._effects;\n\t}\n}\n","import type { ActionPayload, TypedAction, ActionEffect, ReducerConfig, Action, ActionIdentifier } from '../types';\nimport { EffectsBase } from './effects.base.class';\nimport { type Signal, signal, computed } from '../../signals';\n\nexport abstract class ComponentStateBaseService<S extends object> extends EffectsBase {\n\tprivate readonly _state: Signal<S>;\n\n\tconstructor(\n\t\tprivate readonly _initState: S,\n\t\tprivate readonly _reducerConfig: ReducerConfig<S, Action> = { reducers: [] },\n\t\tprivate readonly _debug: boolean = false\n\t) {\n\t\tsuper();\n\t\tthis._state = signal(_initState);\n\t}\n\n\tprotected get state(): S {\n\t\treturn this._state();\n\t}\n\n\tresetState(): void {\n\t\tthis._state.set(this._initState);\n\t}\n\n\tselect<T>(selectFn: (state: S) => T): Signal<T> {\n\t\treturn computed(() => selectFn(this._state()));\n\t}\n\n\tdispatch<T extends ActionIdentifier, P extends ActionPayload>(action: TypedAction<T, P>): void {\n\t\tif (this._debug) {\n\t\t\tconsole.log(`[ComponentState] Action: ${action.type}`);\n\t\t\tconsole.log(`[ComponentState] Payload:`, action.payload);\n\t\t\tconsole.log(`[ComponentState] Before:`, this._state());\n\t\t}\n\n\t\t// Find and execute reducer\n\t\tconst reducer = this._reducerConfig.reducers.find((r) => r.action.type === action.type);\n\t\tif (reducer) {\n\t\t\tthis._state.update((state) => reducer.reducer(state, action));\n\n\t\t\tif (this._debug) {\n\t\t\t\tconsole.log(`[ComponentState] After:`, this._state());\n\t\t\t}\n\t\t}\n\n\t\t// Execute effects\n\t\tthis.executeEffects(action);\n\t}\n\n\tprotected patchState(partial: Partial<S>): void {\n\t\tthis._state.update((state) => ({ ...state, ...partial }));\n\t}\n\n\tprivate executeEffects<T extends ActionIdentifier, P extends ActionPayload>(action: TypedAction<T, P>): void {\n\t\tconst actionEffects: ActionEffect[] = this.getEffects().filter((effect) => effect.actions.some((a) => a().type === action.type));\n\n\t\tactionEffects.forEach((effect) => {\n\t\t\teffect.effect(action).then((newAction) => {\n\t\t\t\tif (newAction === undefined) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst actions = Array.isArray(newAction) ? newAction : [newAction];\n\t\t\t\tactions.forEach((na) => this.dispatch(na as TypedAction<T, P>));\n\t\t\t});\n\t\t});\n\t}\n}\n","import type { State } from '../types/state.type';\nimport type { Action, ActionIdentifier, ActionPayload, TypedAction } from '../types/action.type';\nimport type { ActionEffect, ActionEffects, ActionEffectsMap } from '../types/action-effect.type';\nimport type { ActionReducerMap } from '../types/reducer-config.type';\nimport { RX_INIT_STATE, RX_ACTION_PROVIDERS, RX_EFFECTS_PROVIDERS, RX_STATE_DEBUG } from '../injection.tokens';\nimport type { ActionReducer } from '../types/action-reducer.type';\nimport { Injectable, Injector, Service } from '../../injection';\nimport { type Signal, computed } from '../../signals';\n\n@Injectable()\nexport class SignalStoreService<S> {\n\t@Service(RX_INIT_STATE) private readonly _state!: State<S>;\n\t@Service(RX_ACTION_PROVIDERS) private readonly _reducerMap!: ActionReducerMap<S>;\n\t@Service(RX_EFFECTS_PROVIDERS) private readonly _effectMap!: ActionEffectsMap<S>;\n\t@Service(RX_STATE_DEBUG) private readonly _debug!: boolean;\n\n\tconstructor() {\n\t\tif (this._debug) {\n\t\t\tconsole.info('RX State Debugging: Enabled');\n\t\t}\n\t}\n\n\tselect<T, K extends keyof S>(key: K, selectFn: (state: S[K]) => T): Signal<T> {\n\t\treturn computed(() => {\n\t\t\treturn selectFn(this._state[key]());\n\t\t});\n\t}\n\n\tlogState(): void {\n\t\tconsole.log(this.getCurrentState());\n\t}\n\n\tdispatch<T extends ActionIdentifier, P extends ActionPayload>(action: TypedAction<T, P>): void;\n\tdispatch<K extends keyof S, T extends ActionIdentifier, P extends ActionPayload>(key: K, action: TypedAction<T, P>): void;\n\tdispatch<K extends keyof S, T extends ActionIdentifier, P extends ActionPayload>(x: K | TypedAction<T, P>, y?: TypedAction<T, P>): void {\n\t\tconst key = typeof x === 'string' ? x : undefined;\n\t\tconst action: TypedAction<T, P> = (typeof x === 'string' ? y : x) as TypedAction<T, P>;\n\n\t\tif (this._debug) {\n\t\t\tconsole.log(`Action: ${action.type}`);\n\t\t\tconsole.log(`Payload:`, action.payload);\n\t\t\tconsole.log(`Current State:`, this.getCurrentState());\n\t\t}\n\n\t\tif (key) {\n\t\t\tthis.dispatchWithKey(key, action);\n\t\t} else {\n\t\t\tthis.dispatchWithoutKey(action);\n\t\t}\n\t}\n\n\tprivate dispatchWithKey<K extends keyof S, T extends ActionIdentifier, P extends ActionPayload>(key: K, action: TypedAction<T, P>): void {\n\t\tif (!this._reducerMap[key]) {\n\t\t\tthrow new Error(`Reducer not found for key: ${key as string}`);\n\t\t}\n\n\t\tconst reducers = this._reducerMap[key].reducers;\n\n\t\tconst reducer = reducers.find((reducer) => reducer.action.type === action.type);\n\t\tif (reducer !== undefined) {\n\t\t\tconst newState = reducer.reducer(this._state[key](), action);\n\t\t\t(this._state[key] as Signal<S[K]>).set(newState);\n\n\t\t\tif (this._debug) {\n\t\t\t\tconsole.log(`New State:`, this.getCurrentState());\n\t\t\t}\n\t\t}\n\n\t\tconst actionEffects: ActionEffect[] = this.getEffectsForAction(key, action);\n\t\tactionEffects.forEach((effect) => {\n\t\t\teffect.effect(action).then((newAction) => {\n\t\t\t\tif (newAction === undefined) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!Array.isArray(newAction)) {\n\t\t\t\t\tnewAction = [newAction];\n\t\t\t\t}\n\n\t\t\t\tnewAction.forEach((na) => {\n\t\t\t\t\tthis.dispatch(na as TypedAction<T, P>);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate dispatchWithoutKey<T extends ActionIdentifier, P extends ActionPayload>(action: TypedAction<T, P>): void {\n\t\tconst reducerWithKey = this.getReducerForAction(action);\n\t\tif (reducerWithKey !== undefined) {\n\t\t\tconst newState = reducerWithKey.actionReducer.reducer(this._state[reducerWithKey.key](), action);\n\t\t\t(this._state[reducerWithKey.key] as Signal<S[keyof S]>).set(newState);\n\n\t\t\tif (this._debug) {\n\t\t\t\tconsole.log(`New State:`, this.getCurrentState());\n\t\t\t}\n\t\t}\n\n\t\tconst effectsWithKey = this.getEffectsForAction(action);\n\t\tif (effectsWithKey !== undefined) {\n\t\t\teffectsWithKey.actionEffects.forEach((effect) => {\n\t\t\t\teffect.effect(action).then((newAction) => {\n\t\t\t\t\tif (newAction === undefined) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!Array.isArray(newAction)) {\n\t\t\t\t\t\tnewAction = [newAction];\n\t\t\t\t\t}\n\n\t\t\t\t\tnewAction.forEach((na) => {\n\t\t\t\t\t\tthis.dispatch(na as TypedAction<T, P>);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate getReducerForAction<T extends ActionIdentifier, P extends ActionPayload>(\n\t\taction: TypedAction<T, P>\n\t): { key: keyof S; actionReducer: ActionReducer<S[keyof S], Action> } | undefined {\n\t\tconst keys: (keyof S)[] = Object.keys(this._reducerMap) as (keyof S)[];\n\n\t\tfor (const key of keys) {\n\t\t\tconst reducers = this._reducerMap[key]?.reducers || [];\n\t\t\tconst reducer = reducers.find((reducer) => reducer.action.type === action.type);\n\n\t\t\tif (reducer) {\n\t\t\t\treturn { key, actionReducer: reducer };\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate getEffectsForAction<T extends ActionIdentifier, P extends ActionPayload>(\n\t\taction: TypedAction<T, P>\n\t): { key: keyof S; actionEffects: ActionEffect[] } | undefined;\n\tprivate getEffectsForAction<K extends keyof S, T extends ActionIdentifier, P extends ActionPayload>(key: K, action: TypedAction<T, P>): ActionEffect[];\n\tprivate getEffectsForAction<K extends keyof S, T extends ActionIdentifier, P extends ActionPayload>(\n\t\tkey: K | TypedAction<T, P>,\n\t\taction?: TypedAction<T, P>\n\t): ActionEffect[] | { key: keyof S; actionEffects: ActionEffect[] } | undefined {\n\t\tif (typeof key === 'string') {\n\t\t\treturn this.getEffectsForActionWithKey(key as K, action as TypedAction<T, P>);\n\t\t} else {\n\t\t\treturn this.getEffectsForActionWithoutKey(key as TypedAction<T, P>);\n\t\t}\n\t}\n\n\tprivate getEffectsForActionWithoutKey<T extends ActionIdentifier, P extends ActionPayload>(\n\t\taction: TypedAction<T, P>\n\t): { key: keyof S; actionEffects: ActionEffect[] } | undefined {\n\t\tconst keys: (keyof S)[] = Object.keys(this._reducerMap) as (keyof S)[];\n\n\t\tfor (const key of keys) {\n\t\t\tconst effectClass = this._effectMap[key];\n\n\t\t\tif (effectClass) {\n\t\t\t\tconst effectService: ActionEffects = Injector.get(effectClass);\n\t\t\t\tconst effects = effectService.getEffects().filter((effect) => effect.actions.some((a) => a().type === action.type));\n\n\t\t\t\tif (effects.length > 0) {\n\t\t\t\t\treturn { key, actionEffects: effects };\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate getEffectsForActionWithKey<K extends keyof S, T extends ActionIdentifier, P extends ActionPayload>(\n\t\tkey: K,\n\t\taction: TypedAction<T, P>\n\t): ActionEffect[] {\n\t\tconst effectClass = this._effectMap[key as keyof S];\n\t\tif (effectClass) {\n\t\t\tconst effectService: ActionEffects = Injector.get(effectClass);\n\t\t\treturn effectService.getEffects().filter((effect) => effect.actions.some((a) => a().type === action.type));\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tprivate getCurrentState(): S {\n\t\treturn Object.keys(this._state).reduce((acc, key) => {\n\t\t\tacc[key as keyof S] = this._state[key as keyof S]();\n\t\t\treturn acc;\n\t\t}, {} as S);\n\t}\n}\n","import type { Provider } from '../../bootstrap/types/provider.type';\nimport type { InjectionEngine } from '../../injection';\nimport { RX_INIT_STATE, RX_ACTION_PROVIDERS, RX_EFFECTS_PROVIDERS, RX_STATE_DEBUG } from '../injection.tokens';\nimport { SignalStoreService } from '../services';\nimport type { State, ActionReducerMap, ActionEffectsMap } from '../types';\n\nexport function provideRX<S>(initState: State<S>, actionReducers: ActionReducerMap<S>, effects: ActionEffectsMap<S>, debug: boolean = false): Provider {\n\treturn (injector: InjectionEngine) => {\n\t\tinjector.bindValue(RX_INIT_STATE, initState);\n\t\tinjector.bindValue(RX_ACTION_PROVIDERS, actionReducers);\n\t\tinjector.bindValue(RX_EFFECTS_PROVIDERS, effects);\n\t\tinjector.bindValue(RX_STATE_DEBUG, debug);\n\t\tinjector.bind(SignalStoreService, SignalStoreService, { dependencies: [RX_INIT_STATE, RX_ACTION_PROVIDERS, RX_EFFECTS_PROVIDERS] });\n\t};\n}\n","/**\n * Compiled Template - Fast DOM creation using createElement instead of cloneNode\n *\n * For simple single-element templates (like repeat items), generates an optimized\n * factory function that creates DOM directly without any parsing overhead.\n */\n\n// Cache compiled factories by template strings identity\nconst compiledCache = new WeakMap<TemplateStringsArray, CompiledTemplate>();\n\ntype FastFactory = (values: unknown[]) => Node;\n\ninterface CompiledResult {\n\tnodes: Node[];\n\teventTargets: Array<{ element: Element; event: string; valueIndex: number }>;\n}\n\nexport class CompiledTemplate {\n\tprivate _factory: FastFactory | null = null;\n\tprivate _hasEvents: boolean = false;\n\tprivate _canCompile: boolean = false;\n\n\tprivate constructor(strings: TemplateStringsArray) {\n\t\tthis.analyzeAndCompile(strings);\n\t}\n\n\tstatic compile(strings: TemplateStringsArray): CompiledTemplate {\n\t\tlet compiled = compiledCache.get(strings);\n\t\tif (!compiled) {\n\t\t\tcompiled = new CompiledTemplate(strings);\n\t\t\tcompiledCache.set(strings, compiled);\n\t\t}\n\t\treturn compiled;\n\t}\n\n\t/**\n\t * Check if this template can use the fast path\n\t */\n\tcanUseFastPath(): boolean {\n\t\treturn this._canCompile && !this._hasEvents;\n\t}\n\n\t/**\n\t * Create DOM nodes using the compiled factory\n\t */\n\tcreate(values: unknown[]): CompiledResult {\n\t\tif (this._factory) {\n\t\t\treturn { nodes: [this._factory(values)], eventTargets: [] };\n\t\t}\n\t\treturn { nodes: [], eventTargets: [] };\n\t}\n\n\t/**\n\t * Directly create a single node - faster than create() for single-element templates\n\t */\n\tcreateDirect(values: unknown[]): Node | null {\n\t\treturn this._factory ? this._factory(values) : null;\n\t}\n\n\t/**\n\t * Analyze template and generate optimized factory for simple cases\n\t *\n\t * Template strings format for: html`<li class=\"${val}\">${text}</li>`\n\t * strings = ['<li class=\"', '\">', '</li>']\n\t * values[0] goes between strings[0] and strings[1]\n\t * values[1] goes between strings[1] and strings[2]\n\t */\n\tprivate analyzeAndCompile(strings: TemplateStringsArray): void {\n\t\tif (strings.length < 2) return;\n\n\t\t// Check for events\n\t\tfor (const s of strings) {\n\t\t\tif (s.includes('@')) {\n\t\t\t\tthis._hasEvents = true;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// Join strings with placeholders to analyze structure\n\t\tlet html = strings[0];\n\t\tfor (let i = 1; i < strings.length; i++) {\n\t\t\thtml += `\\${${i - 1}}` + strings[i];\n\t\t}\n\n\t\t// Must be a simple single element: <tag ...>...</tag>\n\t\tconst fullMatch = html.match(/^<([\\w-]+)([^>]*)>(.*)$/s);\n\t\tif (!fullMatch) return;\n\n\t\tconst [, tag, attrString, rest] = fullMatch;\n\n\t\t// Must end with closing tag\n\t\tconst closingTag = `</${tag}>`;\n\t\tif (!rest.endsWith(closingTag)) return;\n\n\t\tconst textContent = rest.slice(0, -closingTag.length);\n\n\t\t// Parse attributes - both static and dynamic\n\t\tconst attrs: Array<{ name: string; valueIndex: number | null; staticValue?: string }> = [];\n\n\t\t// Match all attributes including dynamic ones\n\t\tconst attrRegex = /([\\w-]+)\\s*=\\s*(?:\"([^\"]*)\"|'([^']*)'|\\$\\{(\\d+)\\})/g;\n\t\tlet attrMatch;\n\t\twhile ((attrMatch = attrRegex.exec(attrString)) !== null) {\n\t\t\tconst name = attrMatch[1];\n\t\t\tconst staticVal = attrMatch[2] ?? attrMatch[3];\n\t\t\tconst dynamicIndex = attrMatch[4];\n\n\t\t\tif (dynamicIndex !== undefined) {\n\t\t\t\tattrs.push({ name, valueIndex: parseInt(dynamicIndex, 10) });\n\t\t\t} else if (staticVal !== undefined) {\n\t\t\t\t// Check if static value contains a placeholder\n\t\t\t\tconst placeholderMatch = staticVal.match(/\\$\\{(\\d+)\\}/);\n\t\t\t\tif (placeholderMatch) {\n\t\t\t\t\tattrs.push({ name, valueIndex: parseInt(placeholderMatch[1], 10) });\n\t\t\t\t} else {\n\t\t\t\t\tattrs.push({ name, valueIndex: null, staticValue: staticVal });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Parse text content for placeholders\n\t\tconst textParts: Array<{ static: string } | { valueIndex: number }> = [];\n\t\tconst remaining = textContent;\n\t\tconst placeholderRegex = /\\$\\{(\\d+)\\}/g;\n\t\tlet lastIndex = 0;\n\t\tlet textMatch;\n\n\t\tplaceholderRegex.lastIndex = 0;\n\t\twhile ((textMatch = placeholderRegex.exec(remaining)) !== null) {\n\t\t\tif (textMatch.index > lastIndex) {\n\t\t\t\ttextParts.push({ static: remaining.slice(lastIndex, textMatch.index) });\n\t\t\t}\n\t\t\ttextParts.push({ valueIndex: parseInt(textMatch[1], 10) });\n\t\t\tlastIndex = textMatch.index + textMatch[0].length;\n\t\t}\n\t\tif (lastIndex < remaining.length) {\n\t\t\ttextParts.push({ static: remaining.slice(lastIndex) });\n\t\t}\n\n\t\t// Generate factory function\n\t\tthis._factory = (values: unknown[]): Node => {\n\t\t\tconst el = document.createElement(tag);\n\n\t\t\t// Set attributes\n\t\t\tfor (const attr of attrs) {\n\t\t\t\tif (attr.valueIndex !== null) {\n\t\t\t\t\tconst value = values[attr.valueIndex];\n\t\t\t\t\tif (value !== null && value !== undefined && value !== false) {\n\t\t\t\t\t\tel.setAttribute(attr.name, value === true ? '' : String(value));\n\t\t\t\t\t}\n\t\t\t\t} else if (attr.staticValue !== undefined) {\n\t\t\t\t\tel.setAttribute(attr.name, attr.staticValue);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Build text content\n\t\t\tlet text = '';\n\t\t\tfor (const part of textParts) {\n\t\t\t\tif ('static' in part) {\n\t\t\t\t\ttext += part.static;\n\t\t\t\t} else {\n\t\t\t\t\ttext += values[part.valueIndex] ?? '';\n\t\t\t\t}\n\t\t\t}\n\t\t\tel.textContent = text;\n\n\t\t\treturn el;\n\t\t};\n\n\t\tthis._canCompile = true;\n\t}\n}\n","import type { IDirectiveResult } from '../interfaces/idirective-result.interface';\n\n/**\n * Helper function to create a simple directive without a class.\n *\n * Example:\n * ```typescript\n * const myDirective = directive((container, previousState) => {\n *   container.textContent = 'Hello!';\n *   return null;\n * });\n * ```\n *\n * @param renderFn - Function that handles rendering\n */\n\nexport function directive(renderFn: (container: Node, previousState?: any) => any): IDirectiveResult {\n\treturn {\n\t\t__directive: true,\n\t\trender: renderFn\n\t};\n}\n","/**\n * Repeat directive - Efficient keyed list rendering\n */\n\nimport type { TemplateResult } from '../../classes/template-result.class';\nimport { CompiledTemplate } from '../../classes/compiled-template.class';\nimport { directive } from '../functions/directive.function';\nimport type { IDirectiveResult } from '../interfaces/idirective-result.interface';\n\ninterface RepeatState {\n\tkeyToIndex: Map<unknown, number>;\n\titems: RepeatItem[];\n\tstartMarker: Comment;\n\tendMarker: Comment;\n\tcompiledTemplate?: CompiledTemplate;\n\tuseCompiledPath?: boolean;\n}\n\ninterface RepeatItem {\n\tkey: unknown;\n\tvalue: any;\n\tcontainer: DocumentFragment;\n\tnodes: Node[];\n\tstart: Comment;\n\tend: Comment;\n}\n\n/**\n * Efficiently renders lists with minimal DOM operations\n *\n * Usage:\n *   repeat(items, item => item.id, item => html`<li>${item.name}</li>`)\n *\n * @param items - Array of items to render\n * @param keyFn - Function to extract unique key from each item\n * @param template - Template function to render each item\n */\nexport function repeat<T>(items: T[], keyFn: (item: T, index: number) => unknown, template: (item: T, index: number) => TemplateResult): IDirectiveResult {\n\treturn directive((container: Node, previousState?: RepeatState): RepeatState => {\n\t\t// First render - setup markers\n\t\tif (!previousState) {\n\t\t\tconst parent = container.parentNode;\n\t\t\tif (!parent) {\n\t\t\t\tthrow new Error('repeat() directive: container must be attached to a parent node');\n\t\t\t}\n\n\t\t\tconst startMarker = document.createComment('repeat-start');\n\t\t\tconst endMarker = document.createComment('repeat-end');\n\n\t\t\tparent.replaceChild(startMarker, container);\n\t\t\tparent.insertBefore(endMarker, startMarker.nextSibling);\n\n\t\t\tconst state: RepeatState = {\n\t\t\t\tkeyToIndex: new Map(),\n\t\t\t\titems: [],\n\t\t\t\tstartMarker,\n\t\t\t\tendMarker\n\t\t\t};\n\n\t\t\t// Initial render\n\t\t\tupdateList(items, keyFn, template, state);\n\t\t\treturn state;\n\t\t}\n\n\t\t// Update existing list\n\t\tupdateList(items, keyFn, template, previousState);\n\t\treturn previousState;\n\t});\n}\n\nfunction updateList<T>(\n\tnewItems: T[],\n\tkeyFn: (item: T, index: number) => unknown,\n\ttemplate: (item: T, index: number) => TemplateResult,\n\tstate: RepeatState\n): void {\n\tconst oldItems = state.items;\n\tconst newKeyToIndex = new Map<unknown, number>();\n\tconst newEntries: {\n\t\titem: RepeatItem;\n\t\toldIndex: number;\n\t\tisNew: boolean;\n\t}[] = [];\n\n\t// Build new key map\n\tfor (let i = 0; i < newItems.length; i++) {\n\t\tconst key = keyFn(newItems[i], i);\n\t\tnewKeyToIndex.set(key, i);\n\t}\n\n\t// Quick check: if length and all keys are the same, skip expensive reconciliation\n\tif (oldItems.length === newItems.length) {\n\t\tlet allKeysMatch = true;\n\t\tfor (let i = 0; i < newItems.length; i++) {\n\t\t\tconst key = keyFn(newItems[i], i);\n\t\t\tif (i >= oldItems.length || oldItems[i].key !== key) {\n\t\t\t\tallKeysMatch = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (allKeysMatch) {\n\t\t\t// Items are in same order with same keys - just update templates in place\n\t\t\tfor (let i = 0; i < newItems.length; i++) {\n\t\t\t\tconst templateResult = template(newItems[i], i);\n\t\t\t\ttemplateResult.renderInto(oldItems[i].container);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t}\n\n\t// On first render, check if we can use compiled fast path\n\tif (state.useCompiledPath === undefined && newItems.length > 0) {\n\t\tconst sampleTemplate = template(newItems[0], 0);\n\t\tconst compiled = CompiledTemplate.compile(sampleTemplate.strings);\n\t\tstate.useCompiledPath = compiled.canUseFastPath();\n\t\tif (state.useCompiledPath) {\n\t\t\tstate.compiledTemplate = compiled;\n\t\t}\n\t}\n\n\t// Track old items by key so we can reuse and remove efficiently\n\tconst oldItemsByKey = new Map<unknown, RepeatItem>();\n\tconst oldIndexByKey = new Map<unknown, number>();\n\tfor (const oldItem of oldItems) {\n\t\toldItemsByKey.set(oldItem.key, oldItem);\n\t\toldIndexByKey.set(oldItem.key, oldIndexByKey.size);\n\t}\n\n\t// Build new items list, reusing when possible\n\tfor (let i = 0; i < newItems.length; i++) {\n\t\tconst item = newItems[i];\n\t\tconst key = keyFn(item, i);\n\n\t\tif (oldItemsByKey.has(key)) {\n\t\t\t// Reuse existing item\n\t\t\tconst oldItem = oldItemsByKey.get(key)!;\n\t\t\toldItemsByKey.delete(key); // Mark as used\n\n\t\t\t// Re-render with new data\n\t\t\tconst templateResult = template(item, i);\n\t\t\ttemplateResult.renderInto(oldItem.container);\n\n\t\t\tnewEntries.push({\n\t\t\t\titem: oldItem,\n\t\t\t\toldIndex: oldIndexByKey.get(key) ?? -1,\n\t\t\t\tisNew: false\n\t\t\t});\n\t\t} else {\n\t\t\t// Create new item\n\t\t\tconst repeatItem = createRepeatItem(item, i, key, template, state);\n\t\t\tnewEntries.push({\n\t\t\t\titem: repeatItem,\n\t\t\t\toldIndex: -1,\n\t\t\t\tisNew: true\n\t\t\t});\n\t\t}\n\t}\n\n\t// Remove old items that are no longer needed\n\tfor (const oldItem of oldItemsByKey.values()) {\n\t\tremoveItemRange(oldItem);\n\t}\n\n\tif (newEntries.length === 0) {\n\t\tstate.keyToIndex = newKeyToIndex;\n\t\tstate.items = [];\n\t\treturn;\n\t}\n\n\tconst lisPositions = getLisPositions(newEntries);\n\tconst parent = state.startMarker.parentElement!;\n\tlet nextSibling: Node = state.endMarker;\n\n\tfor (let i = newEntries.length - 1; i >= 0; i--) {\n\t\tconst entry = newEntries[i];\n\t\tif (entry.isNew) {\n\t\t\tinsertItemRange(entry.item, parent, nextSibling);\n\t\t} else if (!lisPositions.has(i)) {\n\t\t\tmoveItemRange(entry.item, nextSibling);\n\t\t}\n\t\tnextSibling = entry.item.start;\n\t}\n\n\t// Update state\n\tstate.keyToIndex = newKeyToIndex;\n\tstate.items = newEntries.map((entry) => entry.item);\n}\n\nfunction createRepeatItem<T>(item: T, index: number, key: unknown, template: (item: T, index: number) => TemplateResult, state: RepeatState): RepeatItem {\n\tconst templateResult = template(item, index);\n\n\tlet nodes: Node[];\n\tlet container: DocumentFragment;\n\n\t// Use compiled fast path if available\n\tif (state.useCompiledPath && state.compiledTemplate) {\n\t\t// Fast path: directly create element without DocumentFragment overhead\n\t\tconst node = state.compiledTemplate.createDirect(templateResult.values);\n\t\tif (node) {\n\t\t\tnodes = [node];\n\t\t\tcontainer = document.createDocumentFragment();\n\t\t\tcontainer.appendChild(node);\n\t\t} else {\n\t\t\t// Fallback if createDirect fails\n\t\t\tcontainer = document.createDocumentFragment();\n\t\t\tnodes = templateResult.renderOnce(container);\n\t\t}\n\t} else {\n\t\tcontainer = document.createDocumentFragment();\n\t\tnodes = templateResult.renderOnce(container);\n\t}\n\n\treturn {\n\t\tkey,\n\t\tvalue: item,\n\t\tcontainer,\n\t\tnodes,\n\t\tstart: document.createComment('repeat-item-start'),\n\t\tend: document.createComment('repeat-item-end')\n\t};\n}\n\nfunction insertItemRange(item: RepeatItem, parent: Node, referenceNode: Node): void {\n\tconst fragment = document.createDocumentFragment();\n\tfragment.appendChild(item.start);\n\tfor (const node of item.nodes) {\n\t\tfragment.appendChild(node);\n\t}\n\tfragment.appendChild(item.end);\n\tparent.insertBefore(fragment, referenceNode);\n}\n\nfunction moveItemRange(item: RepeatItem, referenceNode: Node): void {\n\tconst parent = referenceNode.parentNode;\n\tif (!parent) {\n\t\treturn;\n\t}\n\n\tconst fragment = document.createDocumentFragment();\n\tlet node: Node | null = item.start;\n\tconst end = item.end;\n\n\twhile (node) {\n\t\tconst nextNode: Node | null = node.nextSibling;\n\t\tfragment.appendChild(node);\n\t\tif (node === end) {\n\t\t\tbreak;\n\t\t}\n\t\tnode = nextNode;\n\t}\n\n\tparent.insertBefore(fragment, referenceNode);\n}\n\nfunction removeItemRange(item: RepeatItem): void {\n\tlet node: Node | null = item.start;\n\tconst end = item.end;\n\n\twhile (node) {\n\t\tconst nextNode: Node | null = node.nextSibling;\n\t\tnode.parentNode?.removeChild(node);\n\t\tif (node === end) {\n\t\t\tbreak;\n\t\t}\n\t\tnode = nextNode;\n\t}\n}\n\nfunction getLisPositions(\n\tentries: {\n\t\titem: RepeatItem;\n\t\toldIndex: number;\n\t\tisNew: boolean;\n\t}[]\n): Set<number> {\n\tconst oldIndexSequence: number[] = [];\n\tconst sequencePositions: number[] = [];\n\n\tfor (let i = 0; i < entries.length; i++) {\n\t\tif (entries[i].oldIndex >= 0) {\n\t\t\toldIndexSequence.push(entries[i].oldIndex);\n\t\t\tsequencePositions.push(i);\n\t\t}\n\t}\n\n\tconst lisIndices = longestIncreasingSubsequence(oldIndexSequence);\n\tconst lisPositions = new Set<number>();\n\n\tfor (const seqIndex of lisIndices) {\n\t\tconst position = sequencePositions[seqIndex];\n\t\tif (position !== undefined) {\n\t\t\tlisPositions.add(position);\n\t\t}\n\t}\n\n\treturn lisPositions;\n}\n\nfunction longestIncreasingSubsequence(sequence: number[]): number[] {\n\tif (sequence.length === 0) {\n\t\treturn [];\n\t}\n\n\tconst predecessors = new Array<number>(sequence.length).fill(-1);\n\tconst positions = new Array<number>(sequence.length).fill(0);\n\tlet length = 0;\n\n\tfor (let i = 0; i < sequence.length; i++) {\n\t\tconst value = sequence[i];\n\t\tlet low = 0;\n\t\tlet high = length;\n\n\t\twhile (low < high) {\n\t\t\tconst mid = (low + high) >> 1;\n\t\t\tif (sequence[positions[mid]] < value) {\n\t\t\t\tlow = mid + 1;\n\t\t\t} else {\n\t\t\t\thigh = mid;\n\t\t\t}\n\t\t}\n\n\t\tif (low > 0) {\n\t\t\tpredecessors[i] = positions[low - 1];\n\t\t}\n\n\t\tpositions[low] = i;\n\n\t\tif (low === length) {\n\t\t\tlength++;\n\t\t}\n\t}\n\n\tconst result = new Array<number>(length);\n\tlet k = positions[length - 1];\n\tfor (let i = length - 1; i >= 0; i--) {\n\t\tresult[i] = k;\n\t\tk = predecessors[k];\n\t}\n\n\treturn result;\n}\n","/**\n * RepeatRaw directive - Maximum performance list rendering\n *\n * Bypasses the template system entirely for cases where raw DOM\n * performance is critical. Uses createElement instead of template cloning.\n */\n\nimport { directive } from '../functions/directive.function';\nimport type { IDirectiveResult } from '../interfaces/idirective-result.interface';\n\ninterface RepeatRawState {\n\tkeyToItem: Map<unknown, { key: unknown; element: Element }>;\n\tstartMarker: Comment;\n\tendMarker: Comment;\n}\n\n/**\n * High-performance list rendering using raw DOM APIs\n *\n * Usage:\n *   repeatRaw(items, item => item.id, item => {\n *     const li = document.createElement('li');\n *     li.className = item.active ? 'active' : '';\n *     li.textContent = `${item.text}: ${item.value}`;\n *     return li;\n *   })\n *\n * @param items - Array of items to render\n * @param keyFn - Function to extract unique key from each item\n * @param factory - Factory function that creates a DOM element for each item\n */\nexport function repeatRaw<T>(\n\titems: T[],\n\tkeyFn: (item: T, index: number) => unknown,\n\tfactory: (item: T, index: number) => Element\n): IDirectiveResult {\n\treturn directive((container: Node, previousState?: RepeatRawState): RepeatRawState => {\n\t\t// First render - setup markers\n\t\tif (!previousState) {\n\t\t\tconst parent = container.parentNode;\n\t\t\tif (!parent) {\n\t\t\t\tthrow new Error('repeatRaw() directive: container must be attached to a parent node');\n\t\t\t}\n\n\t\t\tconst startMarker = document.createComment('repeat-raw-start');\n\t\t\tconst endMarker = document.createComment('repeat-raw-end');\n\n\t\t\tparent.replaceChild(startMarker, container);\n\t\t\tparent.insertBefore(endMarker, startMarker.nextSibling);\n\n\t\t\tconst state: RepeatRawState = {\n\t\t\t\tkeyToItem: new Map(),\n\t\t\t\tstartMarker,\n\t\t\t\tendMarker\n\t\t\t};\n\n\t\t\t// Initial render - create all elements\n\t\t\tconst fragment = document.createDocumentFragment();\n\t\t\tfor (let i = 0; i < items.length; i++) {\n\t\t\t\tconst item = items[i];\n\t\t\t\tconst key = keyFn(item, i);\n\t\t\t\tconst element = factory(item, i);\n\t\t\t\tstate.keyToItem.set(key, { key, element });\n\t\t\t\tfragment.appendChild(element);\n\t\t\t}\n\t\t\tparent.insertBefore(fragment, endMarker);\n\n\t\t\treturn state;\n\t\t}\n\n\t\t// Update existing list\n\t\tupdateList(items, keyFn, factory, previousState);\n\t\treturn previousState;\n\t});\n}\n\nfunction updateList<T>(\n\tnewItems: T[],\n\tkeyFn: (item: T, index: number) => unknown,\n\tfactory: (item: T, index: number) => Element,\n\tstate: RepeatRawState\n): void {\n\tconst oldItems = state.keyToItem;\n\tconst newKeyToItem = new Map<unknown, { key: unknown; element: Element }>();\n\tconst parent = state.startMarker.parentElement!;\n\tconst endMarker = state.endMarker;\n\n\t// Quick path: same length, same keys in order - just update in place\n\tif (oldItems.size === newItems.length) {\n\t\tlet allMatch = true;\n\t\tlet i = 0;\n\t\tfor (const [key] of oldItems) {\n\t\t\tif (key !== keyFn(newItems[i], i)) {\n\t\t\t\tallMatch = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\n\t\tif (allMatch) {\n\t\t\t// Update elements in place\n\t\t\ti = 0;\n\t\t\tfor (const [key, { element }] of oldItems) {\n\t\t\t\tconst item = newItems[i];\n\t\t\t\t// Re-create element with new data (factory handles updates)\n\t\t\t\tconst newElement = factory(item, i);\n\t\t\t\tif (element !== newElement) {\n\t\t\t\t\telement.replaceWith(newElement);\n\t\t\t\t\tnewKeyToItem.set(key, { key, element: newElement });\n\t\t\t\t} else {\n\t\t\t\t\tnewKeyToItem.set(key, { key, element });\n\t\t\t\t}\n\t\t\t\ti++;\n\t\t\t}\n\t\t\tstate.keyToItem = newKeyToItem;\n\t\t\treturn;\n\t\t}\n\t}\n\n\t// Full reconciliation\n\tconst fragment = document.createDocumentFragment();\n\tconst usedKeys = new Set<unknown>();\n\n\tfor (let i = 0; i < newItems.length; i++) {\n\t\tconst item = newItems[i];\n\t\tconst key = keyFn(item, i);\n\t\tusedKeys.add(key);\n\n\t\tconst existing = oldItems.get(key);\n\t\tif (existing) {\n\t\t\t// Update existing element\n\t\t\tconst newElement = factory(item, i);\n\t\t\tif (existing.element !== newElement) {\n\t\t\t\t// Factory returned a new element, use it\n\t\t\t\tnewKeyToItem.set(key, { key, element: newElement });\n\t\t\t\tfragment.appendChild(newElement);\n\t\t\t} else {\n\t\t\t\tnewKeyToItem.set(key, existing);\n\t\t\t\tfragment.appendChild(existing.element);\n\t\t\t}\n\t\t} else {\n\t\t\t// Create new element\n\t\t\tconst element = factory(item, i);\n\t\t\tnewKeyToItem.set(key, { key, element });\n\t\t\tfragment.appendChild(element);\n\t\t}\n\t}\n\n\t// Remove unused elements\n\tfor (const [key, { element }] of oldItems) {\n\t\tif (!usedKeys.has(key)) {\n\t\t\telement.remove();\n\t\t}\n\t}\n\n\t// Replace all content\n\tparent.insertBefore(fragment, endMarker);\n\n\tstate.keyToItem = newKeyToItem;\n}\n","/**\n * When directive - Conditional rendering\n *\n * Efficiently shows/hides content based on a condition.\n * Removes from DOM when false, adds back when true.\n */\n\nimport type { TemplateResult } from '../../classes/template-result.class';\nimport { directive } from '../functions/directive.function';\nimport { type IDirectiveResult } from '../interfaces/idirective-result.interface';\n\ninterface WhenState {\n\tcondition: boolean;\n\ttemplate: TemplateResult;\n\tfalseTemplate: TemplateResult | null;\n\tcontainer: DocumentFragment | null;\n\tstartMarker: Comment;\n\tendMarker: Comment;\n\tnodes: Node[];\n}\n\n/**\n * Conditionally renders a template.\n *\n * Usage:\n *   when(isLoggedIn, () => html`<div>Welcome!</div>`)\n *   when(isLoggedIn, () => html`<div>Welcome!</div>`, () => html`<div>Please log in</div>`)\n *\n * @param condition - When true, renders the template. When false, removes from DOM (or renders falseTemplate if provided).\n * @param template - Template function to render when condition is true\n * @param falseTemplate - Optional template function to render when condition is false\n */\nexport function when(\n\tcondition: boolean,\n\ttemplate: () => TemplateResult,\n\tfalseTemplate?: () => TemplateResult\n): IDirectiveResult {\n\treturn directive((container: Node, previousState?: WhenState): WhenState => {\n\t\t// First render - setup markers\n\t\tif (!previousState) {\n\t\t\tconst parent = container.parentNode;\n\t\t\tif (!parent) {\n\t\t\t\tthrow new Error('when() directive: container must be attached to a parent node');\n\t\t\t}\n\n\t\t\tconst startMarker = document.createComment('when-start');\n\t\t\tconst endMarker = document.createComment('when-end');\n\n\t\t\tparent.replaceChild(startMarker, container);\n\t\t\tparent.insertBefore(endMarker, startMarker.nextSibling);\n\n\t\t\tconst state: WhenState = {\n\t\t\t\tcondition: false,\n\t\t\t\ttemplate: template(),\n\t\t\t\tfalseTemplate: falseTemplate ? falseTemplate() : null,\n\t\t\t\tcontainer: null,\n\t\t\t\tstartMarker,\n\t\t\t\tendMarker,\n\t\t\t\tnodes: []\n\t\t\t};\n\n\t\t\tif (condition) {\n\t\t\t\trenderContent(state, true);\n\t\t\t} else if (state.falseTemplate) {\n\t\t\t\trenderContent(state, false);\n\t\t\t}\n\n\t\t\tstate.condition = condition;\n\t\t\treturn state;\n\t\t}\n\n\t\t// Get parent from the markers (which are still in the DOM)\n\t\tconst parent = previousState.startMarker.parentNode;\n\t\tif (!parent) {\n\t\t\tthrow new Error('when() directive: markers were removed from DOM');\n\t\t}\n\n\t\t// Condition changed from false to true\n\t\tif (condition && !previousState.condition) {\n\t\t\tremoveContent(previousState);\n\t\t\tpreviousState.template = template();\n\t\t\trenderContent(previousState, true);\n\t\t}\n\t\t// Condition changed from true to false\n\t\telse if (!condition && previousState.condition) {\n\t\t\tremoveContent(previousState);\n\t\t\tif (falseTemplate) {\n\t\t\t\tpreviousState.falseTemplate = falseTemplate();\n\t\t\t\trenderContent(previousState, false);\n\t\t\t}\n\t\t}\n\t\t// Condition still true - update template\n\t\telse if (condition && previousState.condition) {\n\t\t\tconst newTemplate = template();\n\t\t\tif (previousState.container) {\n\t\t\t\tnewTemplate.renderInto(previousState.container);\n\t\t\t}\n\t\t\tpreviousState.template = newTemplate;\n\t\t}\n\t\t// Condition still false - update false template if provided\n\t\telse if (!condition && !previousState.condition && falseTemplate) {\n\t\t\tconst newFalseTemplate = falseTemplate();\n\t\t\tif (previousState.container) {\n\t\t\t\tnewFalseTemplate.renderInto(previousState.container);\n\t\t\t}\n\t\t\tpreviousState.falseTemplate = newFalseTemplate;\n\t\t}\n\n\t\tpreviousState.condition = condition;\n\t\treturn previousState;\n\t});\n}\n\nfunction renderContent(state: WhenState, useTrueTemplate: boolean): void {\n\tconst parent = state.startMarker.parentNode;\n\tif (!parent) {\n\t\tthrow new Error('when() directive: markers not in DOM');\n\t}\n\n\tconst templateToRender = useTrueTemplate ? state.template : state.falseTemplate;\n\tif (!templateToRender) return;\n\n\tconst container = document.createDocumentFragment();\n\ttemplateToRender.renderInto(container);\n\tstate.container = container;\n\n\t// Insert nodes between markers\n\tstate.nodes = Array.from(container.childNodes);\n\tfor (const node of state.nodes) {\n\t\tparent.insertBefore(node, state.endMarker);\n\t}\n}\n\nfunction removeContent(state: WhenState): void {\n\tfor (const node of state.nodes) {\n\t\tnode.parentNode?.removeChild(node);\n\t}\n\tstate.nodes = [];\n\tstate.container = null;\n}\n","/**\n * ClassMap directive - Conditional CSS classes\n *\n * Efficiently applies CSS classes based on an object of conditions.\n */\n\nimport { directive } from '../functions/directive.function';\nimport type { IDirectiveResult } from '../interfaces/idirective-result.interface';\n\n/**\n * Applies CSS classes based on an object mapping.\n *\n * Usage:\n *   <div class=${classMap({ active: isActive, disabled: isDisabled })}></div>\n *\n * Only classes with truthy values are applied.\n *\n * @param classes - Object mapping class names to boolean conditions\n */\nexport function classMap(classes: Record<string, boolean | undefined>): IDirectiveResult {\n\treturn directive((container: Node, previousClasses?: Set<string>) => {\n\t\tconst element = container as Element;\n\t\tconst currentClasses = new Set<string>();\n\n\t\t// Apply new classes\n\t\tfor (const [className, shouldApply] of Object.entries(classes)) {\n\t\t\tif (shouldApply) {\n\t\t\t\telement.classList.add(className);\n\t\t\t\tcurrentClasses.add(className);\n\t\t\t}\n\t\t}\n\n\t\t// Remove old classes that are no longer present\n\t\tif (previousClasses) {\n\t\t\tfor (const className of previousClasses) {\n\t\t\t\tif (!currentClasses.has(className)) {\n\t\t\t\t\telement.classList.remove(className);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn currentClasses;\n\t});\n}\n","/**\n * StyleMap directive - Dynamic inline styles\n *\n * Efficiently applies inline styles based on an object.\n */\n\nimport { directive } from '../functions/directive.function';\nimport type { IDirectiveResult } from '../interfaces/idirective-result.interface';\n\n/**\n * Applies inline styles based on an object mapping.\n *\n * Usage:\n *   <div style=${styleMap({ color: 'red', fontSize: '16px' })}></div>\n *\n * @param styles - Object mapping CSS property names to values\n */\nexport function styleMap(styles: Record<string, string | number | undefined>): IDirectiveResult {\n\treturn directive((container: Node, previousStyles?: Set<string>) => {\n\t\tconst element = container as HTMLElement;\n\t\tconst currentStyles = new Set<string>();\n\n\t\t// Apply new styles\n\t\tfor (const [property, value] of Object.entries(styles)) {\n\t\t\tif (value !== undefined) {\n\t\t\t\telement.style.setProperty(\n\t\t\t\t\t// Convert camelCase to kebab-case\n\t\t\t\t\tproperty.replace(/([A-Z])/g, '-$1').toLowerCase(),\n\t\t\t\t\tString(value)\n\t\t\t\t);\n\t\t\t\tcurrentStyles.add(property);\n\t\t\t}\n\t\t}\n\n\t\t// Remove old styles that are no longer present\n\t\tif (previousStyles) {\n\t\t\tfor (const property of previousStyles) {\n\t\t\t\tif (!currentStyles.has(property)) {\n\t\t\t\t\telement.style.removeProperty(property.replace(/([A-Z])/g, '-$1').toLowerCase());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn currentStyles;\n\t});\n}\n","/**\n * UnsafeHTML directive - Render raw HTML\n *\n *  WARNING: Only use with trusted content! This can expose you to XSS attacks.\n */\n\nimport { directive } from '../functions/directive.function';\nimport type { IDirectiveResult } from '../interfaces/idirective-result.interface';\n\n/**\n * Renders raw HTML string into the DOM.\n *\n *  SECURITY WARNING: Only use with trusted, sanitized HTML!\n * Never use with user-generated content without sanitization.\n *\n * Usage:\n *   <div>${unsafeHTML('<strong>Bold text</strong>')}</div>\n *\n * @param html - Raw HTML string to render\n */\ninterface UnsafeHTMLState {\n\thtml: string;\n\tstartMarker: Comment;\n\tendMarker: Comment;\n\tnodes: Node[];\n}\n\nexport function unsafeHTML(html: string): IDirectiveResult {\n\treturn directive((container: Node, previousState?: UnsafeHTMLState) => {\n\t\t// First render - setup markers\n\t\tif (!previousState) {\n\t\t\tconst parent = container.parentNode;\n\t\t\tif (!parent) {\n\t\t\t\tthrow new Error('unsafeHTML() directive: container must be attached to a parent node');\n\t\t\t}\n\n\t\t\tconst startMarker = document.createComment('unsafeHTML-start');\n\t\t\tconst endMarker = document.createComment('unsafeHTML-end');\n\n\t\t\tparent.replaceChild(startMarker, container);\n\t\t\tparent.insertBefore(endMarker, startMarker.nextSibling);\n\n\t\t\tconst state: UnsafeHTMLState = {\n\t\t\t\thtml: '',\n\t\t\t\tstartMarker,\n\t\t\t\tendMarker,\n\t\t\t\tnodes: []\n\t\t\t};\n\n\t\t\trenderHTML(html, state);\n\t\t\treturn state;\n\t\t}\n\n\t\t// Skip if HTML hasn't changed\n\t\tif (previousState.html === html) {\n\t\t\treturn previousState;\n\t\t}\n\n\t\t// Update HTML\n\t\trenderHTML(html, previousState);\n\t\treturn previousState;\n\t});\n}\n\nfunction renderHTML(html: string, state: UnsafeHTMLState): void {\n\tconst parent = state.startMarker.parentNode;\n\tif (!parent) {\n\t\tthrow new Error('unsafeHTML() directive: markers not in DOM');\n\t}\n\n\t// Remove old nodes\n\tfor (const node of state.nodes) {\n\t\tnode.parentNode?.removeChild(node);\n\t}\n\n\t// Create new nodes from HTML\n\tconst temp = document.createElement('div');\n\ttemp.innerHTML = html;\n\n\tconst fragment = document.createDocumentFragment();\n\twhile (temp.firstChild) {\n\t\tfragment.appendChild(temp.firstChild);\n\t}\n\n\t// Insert new nodes between markers\n\tstate.nodes = Array.from(fragment.childNodes);\n\tfor (const node of state.nodes) {\n\t\tparent.insertBefore(node, state.endMarker);\n\t}\n\n\tstate.html = html;\n}\n","import { registerAttributeDirective } from '../functions/attribute-directive.functions';\nimport type { AttributeDirectiveCleanupFunction } from '../types/attribute-directive-cleanup-function.type';\n\n/**\n * Options for the portal directive when using object syntax\n */\nexport interface PortalOptions {\n\t/** Target element or selector where content will be teleported */\n\ttarget: string | Element;\n\n\t/** Keep content in target after source component unmounts (default: false) */\n\tpersist?: boolean;\n}\n\n/**\n * Portal directive value - can be string selector, Element, or options object\n */\nexport type PortalValue = string | Element | PortalOptions;\n\n/**\n * Resolve target from string selector or Element\n */\nfunction resolveTarget(target: string | Element): Element | null {\n\tif (typeof target === 'string') {\n\t\treturn document.querySelector(target);\n\t}\n\treturn target;\n}\n\n/**\n * Parse portal value into normalized options\n */\nfunction parsePortalValue(value: PortalValue): PortalOptions {\n\tif (typeof value === 'string') {\n\t\treturn { target: value, persist: false };\n\t}\n\n\tif (value instanceof Element) {\n\t\treturn { target: value, persist: false };\n\t}\n\n\treturn {\n\t\ttarget: value.target,\n\t\tpersist: value.persist ?? false\n\t};\n}\n\n/**\n * Portal attribute directive - Teleports an element to a different location in the DOM\n *\n * Usage:\n * ```html\n * <!-- Basic - teleport to body -->\n * <div class=\"modal\" :portal=\"body\">...</div>\n *\n * <!-- Teleport to specific container -->\n * <div class=\"tooltip\" :portal=\"#tooltip-root\">...</div>\n *\n * <!-- Dynamic target -->\n * <div class=\"dropdown\" :portal=${this.container}>...</div>\n *\n * <!-- With options (persist after unmount) -->\n * <div class=\"toast\" :portal=${{ target: '#notifications', persist: true }}>...</div>\n * ```\n */\nfunction portalDirective(element: Element, value: unknown, _: string): AttributeDirectiveCleanupFunction | void {\n\tif (!value) {\n\t\tconsole.warn('portal directive: value is required');\n\t\treturn;\n\t}\n\n\tconst options = parsePortalValue(value as PortalValue);\n\tconst targetElement = resolveTarget(options.target);\n\n\tif (!targetElement) {\n\t\tconsole.warn(`portal directive: target \"${options.target}\" not found`);\n\t\treturn;\n\t}\n\n\t// Don't teleport if already in target\n\tif (element.parentNode === targetElement) {\n\t\treturn;\n\t}\n\n\t// Create placeholder comment at original position\n\tconst placeholder = document.createComment('portal-placeholder');\n\telement.parentNode?.insertBefore(placeholder, element);\n\n\t// Remove portal attribute to avoid re-processing\n\telement.removeAttribute(':portal');\n\n\t// Move element to target\n\ttargetElement.appendChild(element);\n\n\t// Return cleanup function\n\treturn () => {\n\t\tif (!options.persist) {\n\t\t\t// Remove from target\n\t\t\telement.remove();\n\t\t}\n\n\t\t// Remove placeholder\n\t\tplaceholder.remove();\n\t};\n}\n\n// Register the directive\nregisterAttributeDirective('portal', portalDirective);\n\nexport { portalDirective };\n","import type { IDirectiveResult } from './interfaces/idirective-result.interface';\n\nexport abstract class Directive implements IDirectiveResult {\n\tabstract render(container: Node, previousState?: any): any;\n\n\t__directive = true as const;\n}\n"],"mappings":"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"}